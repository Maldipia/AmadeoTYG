<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Amadeo Marketplace - Products, Services & Stays</title>
    <meta name="description" content="Shop local products, book services, find stays in Amadeo, Cavite">
    <link rel="preconnect" href="https://script.google.com" crossorigin>
    <style>
        :root{--p:#0f766e;--pd:#134e4a;--pl:#14b8a6;--r:#ef4444;--g:#22c55e;--o:#f97316;--y:#eab308;--v:#7c3aed;--g1:#f9fafb;--g2:#e5e7eb;--g5:#6b7280;--g7:#374151;--g9:#111827;--sh:0 4px 6px -1px rgba(0,0,0,0.1);--rd:12px}
        *{margin:0;padding:0;box-sizing:border-box}
        html{scroll-behavior:smooth}
        body{font-family:system-ui,-apple-system,sans-serif;background:var(--g1);color:var(--g9);line-height:1.5}
        .hide{display:none!important}
        .hdr{background:linear-gradient(135deg,var(--p),var(--pl));color:#fff;padding:12px 20px;position:sticky;top:0;z-index:100;box-shadow:var(--sh)}
        .hdr-in{max-width:1400px;margin:0 auto;display:flex;justify-content:space-between;align-items:center;gap:15px;flex-wrap:wrap}
        .logo{font-size:20px;font-weight:700}
        .logo a{color:#fff;text-decoration:none}
        .srch{flex:1;max-width:450px;position:relative}
        .srch input{width:100%;padding:10px 15px 10px 40px;border:none;border-radius:25px;font-size:14px}
        .srch::before{content:"üîç";position:absolute;left:14px;top:50%;transform:translateY(-50%);font-size:14px}
        .nav{display:flex;gap:8px;align-items:center}
        .nav a{color:#fff;text-decoration:none;padding:8px 14px;border-radius:20px;font-size:13px;font-weight:500}
        .nav a:hover{background:rgba(255,255,255,.2)}
        .cart-btn{background:var(--pd)!important;position:relative}
        .cart-c{position:absolute;top:-5px;right:-5px;background:var(--r);width:18px;height:18px;border-radius:50%;font-size:10px;display:flex;align-items:center;justify-content:center}
        .tabs{background:#fff;border-bottom:1px solid var(--g2);position:sticky;top:52px;z-index:90}
        .tabs-in{max-width:1400px;margin:0 auto;display:flex;overflow-x:auto;scrollbar-width:none}
        .tabs-in::-webkit-scrollbar{display:none}
        .tab{padding:14px 24px;font-size:14px;font-weight:600;color:var(--g5);border:none;background:none;cursor:pointer;border-bottom:3px solid transparent;white-space:nowrap;display:flex;align-items:center;gap:6px}
        .tab:hover{color:var(--p)}
        .tab.on{color:var(--p);border-bottom-color:var(--p)}
        .tab .i{font-size:18px}
        .badge{background:var(--p);color:#fff;padding:2px 7px;border-radius:10px;font-size:10px;margin-left:4px}
        .hero{padding:40px 20px;text-align:center;color:#fff}
        .hero.prod{background:linear-gradient(135deg,var(--pd),var(--p),var(--pl))}
        .hero.svc{background:linear-gradient(135deg,#5b21b6,var(--v),#a855f7)}
        .hero.stay{background:linear-gradient(135deg,#c2410c,var(--o),#fb923c)}
        .hero h1{font-size:32px;margin-bottom:10px}
        .hero p{font-size:15px;opacity:.9;max-width:500px;margin:0 auto}
        .stats{display:flex;justify-content:center;gap:35px;margin-top:25px}
        .stat .n{font-size:28px;font-weight:700}
        .stat .l{font-size:12px;opacity:.8}
        .cats{background:#fff;padding:12px 20px;overflow-x:auto;scrollbar-width:none;box-shadow:0 1px 3px rgba(0,0,0,.05)}
        .cats::-webkit-scrollbar{display:none}
        .cats-in{max-width:1400px;margin:0 auto;display:flex;gap:8px}
        .cat{padding:8px 16px;background:var(--g1);border:none;border-radius:20px;cursor:pointer;font-size:13px;font-weight:500;white-space:nowrap;display:flex;align-items:center;gap:5px;transition:all .2s}
        .cat:hover,.cat.on{background:var(--p);color:#fff}
        .wrap{max-width:1400px;margin:0 auto;padding:20px}
        .grid{display:grid;gap:16px;grid-template-columns:repeat(auto-fill,minmax(240px,1fr))}
        .grid.svc{grid-template-columns:repeat(auto-fill,minmax(260px,1fr))}
        .grid.stay{grid-template-columns:repeat(auto-fill,minmax(300px,1fr))}
        .card{background:#fff;border-radius:var(--rd);overflow:hidden;box-shadow:var(--sh);transition:transform .2s;contain:layout style paint}
        .card:hover{transform:translateY(-4px)}
        .card-img{height:140px;background:linear-gradient(135deg,#ccfbf1,#99f6e4);position:relative;overflow:hidden}
        .card-img img{width:100%;height:100%;object-fit:cover}
        .card-img .ph{width:100%;height:100%;display:flex;align-items:center;justify-content:center;font-size:42px}
        .card-badge{position:absolute;top:8px;left:8px;background:var(--r);color:#fff;padding:3px 8px;border-radius:12px;font-size:10px;font-weight:600}
        .card-body{padding:12px}
        .card-shop{font-size:11px;color:var(--p);margin-bottom:2px;font-weight:500}
        .card-name{font-weight:600;font-size:14px;margin-bottom:4px;height:38px;overflow:hidden;line-height:1.35}
        .card-meta{font-size:11px;color:var(--g5);margin-bottom:4px;display:flex;align-items:center;gap:8px}
        .stars{color:var(--y)}
        .card-price{font-size:17px;font-weight:700;color:var(--p);margin-bottom:8px}
        .card-price .unit{font-size:11px;font-weight:400;color:var(--g5)}
        .btn{width:100%;padding:10px;border:none;border-radius:8px;cursor:pointer;font-weight:600;font-size:13px;transition:opacity .2s}
        .btn:active{transform:scale(.98)}
        .btn-p{background:linear-gradient(135deg,var(--p),var(--pl));color:#fff}
        .btn-p:hover{opacity:.9}
        .btn:disabled{background:var(--g2);color:var(--g5);cursor:not-allowed}
        .svc-info{display:flex;justify-content:space-between;align-items:center;margin-bottom:6px}
        .svc-dur{font-size:11px;color:var(--g5)}
        .svc-type{display:flex;gap:4px;margin-bottom:8px}
        .svc-type span{font-size:10px;padding:2px 6px;background:var(--g1);border-radius:10px}
        .svc-type .home{background:#dbeafe;color:#1d4ed8}
        .svc-type .shop{background:#fce7f3;color:#be185d}
        .stay-feat{display:flex;gap:10px;font-size:11px;color:var(--g5);margin-bottom:6px}
        .stay-amen{font-size:10px;color:var(--g5);margin-bottom:6px}
        .fulfill-opts{display:flex;gap:4px;margin-bottom:6px;flex-wrap:wrap}
        .f-badge{font-size:10px;padding:3px 8px;border-radius:12px;font-weight:600}
        .f-badge.pickup{background:#dbeafe;color:#1d4ed8}
        .f-badge.delivery{background:#dcfce7;color:#16a34a}
        .loading{text-align:center;padding:50px;color:var(--g5)}
        .spinner{width:36px;height:36px;border:3px solid var(--g2);border-top-color:var(--p);border-radius:50%;animation:spin .7s linear infinite;margin:0 auto 12px}
        @keyframes spin{to{transform:rotate(360deg)}}
        .empty{text-align:center;padding:50px}
        .empty .i{font-size:50px;margin-bottom:12px}
        .overlay{position:fixed;inset:0;background:rgba(0,0,0,.5);z-index:200;opacity:0;visibility:hidden;transition:opacity .3s}
        .overlay.on{opacity:1;visibility:visible}
        .cart-side{position:fixed;top:0;right:0;width:380px;max-width:100%;height:100vh;background:#fff;z-index:201;display:flex;flex-direction:column;transform:translateX(100%);transition:transform .3s}
        .cart-side.on{transform:translateX(0)}
        .cart-hdr{padding:16px;border-bottom:1px solid var(--g2);display:flex;justify-content:space-between;align-items:center}
        .cart-hdr h3{color:var(--p);font-size:16px}
        .close{background:none;border:none;font-size:26px;cursor:pointer;color:var(--g5);line-height:1}
        .cart-items{flex:1;overflow-y:auto;padding:12px}
        .cart-item{display:flex;gap:10px;padding:10px 0;border-bottom:1px solid var(--g1)}
        .cart-item-img{width:50px;height:50px;background:var(--g1);border-radius:6px;display:flex;align-items:center;justify-content:center;font-size:18px;flex-shrink:0}
        .cart-item-img img{width:100%;height:100%;object-fit:cover;border-radius:6px}
        .cart-item-info{flex:1}
        .cart-item-name{font-weight:600;font-size:12px;margin-bottom:2px}
        .cart-item-price{color:var(--p);font-weight:600;font-size:13px}
        .cart-item-qty{display:flex;align-items:center;gap:6px;margin-top:4px}
        .qty-btn{width:24px;height:24px;border:1px solid var(--g2);background:#fff;border-radius:4px;cursor:pointer;font-size:13px}
        .cart-item-rm{background:none;border:none;color:var(--r);cursor:pointer;font-size:16px;padding:4px}
        .cart-empty{text-align:center;padding:40px;color:var(--g5)}
        .cart-empty .i{font-size:40px;margin-bottom:8px}
        .cart-ft{padding:14px;border-top:1px solid var(--g2);background:var(--g1)}
        .cart-row{display:flex;justify-content:space-between;padding:4px 0;font-size:13px}
        .cart-row.total{font-weight:700;font-size:15px;color:var(--p);border-top:1px solid var(--g2);padding-top:10px;margin-top:5px}
        .modal-bg{position:fixed;inset:0;background:rgba(0,0,0,.6);z-index:300;display:flex;align-items:center;justify-content:center;opacity:0;visibility:hidden;transition:all .3s;padding:15px}
        .modal-bg.on{opacity:1;visibility:visible}
        .modal{background:#fff;border-radius:16px;width:100%;max-width:450px;max-height:90vh;overflow:hidden;transform:scale(.9);transition:transform .3s}
        .modal-bg.on .modal{transform:scale(1)}
        .modal-hdr{padding:14px;border-bottom:1px solid var(--g2);display:flex;justify-content:space-between;align-items:center}
        .modal-hdr h2{color:var(--p);font-size:17px}
        .modal-body{padding:14px;max-height:70vh;overflow-y:auto}
        .fg{margin-bottom:12px}
        .fg label{display:block;margin-bottom:3px;font-weight:600;color:var(--g7);font-size:12px}
        .fg input,.fg select,.fg textarea{width:100%;padding:9px 11px;border:1px solid var(--g2);border-radius:8px;font-size:13px;font-family:inherit}
        .fg input:focus,.fg select:focus{outline:none;border-color:var(--p)}
        .fg-row{display:grid;grid-template-columns:1fr 1fr;gap:10px}
        .pay-opts{display:grid;grid-template-columns:repeat(4,1fr);gap:6px;margin-bottom:10px}
        .pay-opt{padding:10px 6px;border:2px solid var(--g2);border-radius:8px;cursor:pointer;text-align:center;transition:all .2s}
        .pay-opt:hover{border-color:var(--p)}
        .pay-opt.sel{border-color:var(--p);background:rgba(15,118,110,.05)}
        .pay-opt .i{font-size:18px;margin-bottom:2px}
        .pay-opt .nm{font-weight:600;font-size:11px}
        .pay-opt .fee{font-size:9px;color:var(--g5)}
        .summary{background:var(--g1);padding:10px;border-radius:8px;margin-bottom:12px}
        .summary h4{margin-bottom:8px;color:var(--g7);font-size:13px}
        .sum-row{display:flex;justify-content:space-between;padding:3px 0;font-size:12px}
        .sum-row.total{font-weight:700;font-size:14px;color:var(--p);border-top:1px solid var(--g2);padding-top:8px;margin-top:5px}
        .upload{border:2px dashed var(--g2);border-radius:8px;padding:16px;text-align:center;cursor:pointer}
        .upload:hover{border-color:var(--p)}
        .upload .i{font-size:24px;margin-bottom:4px}
        .upload input{display:none}
        .time-slots{display:grid;grid-template-columns:repeat(4,1fr);gap:5px;margin-top:6px}
        .time-slot{padding:7px;border:1px solid var(--g2);border-radius:6px;text-align:center;cursor:pointer;font-size:11px}
        .time-slot:hover{border-color:var(--p)}
        .time-slot.sel{background:var(--p);color:#fff;border-color:var(--p)}
        .pay-section{background:#f0fdf4;border:1px solid #bbf7d0;border-radius:10px;padding:12px;margin:12px 0}
        .pay-section.gcash{background:#e0f2fe;border-color:#7dd3fc}
        .pay-section.maya{background:#e0f7fa;border-color:#80deea}
        .pay-section.bank{background:#fef3c7;border-color:#fcd34d}
        .order-ref-box{background:linear-gradient(135deg,var(--p),var(--pl));color:#fff;padding:12px;border-radius:8px;text-align:center;margin-bottom:12px}
        .order-ref-box .lbl{font-size:11px;opacity:.9;margin-bottom:2px}
        .order-ref-box .ref{font-size:18px;font-weight:700;letter-spacing:1px}
        .order-ref-box .note{font-size:10px;opacity:.8;margin-top:4px}
        .qr-container{text-align:center;padding:10px}
        .qr-container img{max-width:200px;height:auto;border-radius:8px;border:2px solid #fff;box-shadow:0 2px 8px rgba(0,0,0,.1)}
        .qr-container .acc-name{font-weight:600;font-size:13px;margin-top:8px;color:var(--g7)}
        .qr-container .acc-num{font-size:14px;color:var(--p);font-weight:600;margin:4px 0}
        .copy-btn{background:var(--p);color:#fff;border:none;padding:4px 12px;border-radius:15px;font-size:11px;cursor:pointer;margin-top:4px}
        .copy-btn:hover{opacity:.9}
        .bank-tabs{display:flex;gap:4px;margin-bottom:10px}
        .bank-tab{flex:1;padding:8px;border:1px solid var(--g2);background:#fff;border-radius:6px;cursor:pointer;text-align:center;font-size:11px;font-weight:600}
        .bank-tab:hover{border-color:var(--p)}
        .bank-tab.sel{background:var(--p);color:#fff;border-color:var(--p)}
        .bank-content{display:none}
        .bank-content.show{display:block}
        .pay-instruct{font-size:11px;color:var(--g5);text-align:center;margin:8px 0}
        .screenshot-preview{max-width:100%;max-height:150px;border-radius:8px;margin-top:8px;border:2px solid var(--g)}
        .upload-success{color:var(--g);font-size:12px;margin-top:6px}
        .ftr{background:var(--pd);color:#fff;padding:35px 20px 20px;margin-top:40px}
        .ftr-in{max-width:1400px;margin:0 auto}
        .ftr-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(160px,1fr));gap:25px;margin-bottom:25px}
        .ftr-col h4{font-size:13px;margin-bottom:12px}
        .ftr-col a{display:block;color:rgba(255,255,255,.8);text-decoration:none;padding:3px 0;font-size:12px}
        .ftr-col a:hover{color:#fff}
        .partners{display:flex;gap:10px;flex-wrap:wrap;margin-bottom:20px}
        .partners a{background:rgba(255,255,255,.1);padding:5px 10px;border-radius:12px;font-size:11px;color:#fff;text-decoration:none}
        .ftr-btm{border-top:1px solid rgba(255,255,255,.1);padding-top:15px;font-size:11px;opacity:.8}
        @media(max-width:768px){
            .hdr-in{flex-wrap:wrap}.srch{order:3;flex:100%;margin-top:8px}
            .hero h1{font-size:24px}.stats{gap:20px}.stat .n{font-size:22px}
            .tab{padding:12px 14px;font-size:12px}.tab span:not(.i){display:none}
            .grid{grid-template-columns:repeat(auto-fill,minmax(155px,1fr));gap:10px}
            .card-img{height:110px}.card-body{padding:10px}.card-name{font-size:12px;height:32px}.card-price{font-size:15px}
            .fg-row{grid-template-columns:1fr}.pay-opts{grid-template-columns:repeat(2,1fr)}.ftr-grid{grid-template-columns:1fr 1fr}
        }
        @media(max-width:480px){.nav a:not(.cart-btn){display:none}.grid{grid-template-columns:1fr 1fr}}
    </style>
</head>
<body>
    <header class="hdr"><div class="hdr-in"><div class="logo"><a href="/">üè™ Amadeo Market</a></div><div class="srch"><input type="text" id="search" placeholder="Search products, services, stays..." oninput="debounceSearch(this.value)"></div><nav class="nav"><a href="/merchant-register">Sell</a><a href="#" class="cart-btn" onclick="toggleCart()">üõí <span class="cart-c" id="cartCount">0</span></a><a href="/login" id="loginLink">Login</a></nav></div></header>
    <div class="tabs"><div class="tabs-in"><button class="tab on" data-tab="products"><span class="i">üõçÔ∏è</span><span>Products</span></button><button class="tab" data-tab="services"><span class="i">üîß</span><span>Services</span><span class="badge">50+</span></button><button class="tab" data-tab="stays"><span class="i">üè°</span><span>Stays</span><span class="badge">NEW</span></button></div></div>
    
    <section id="products" class="section">
        <div class="hero prod"><h1>Shop Local, Support Amadeo</h1><p>Fresh products from your neighbors. Fast delivery within Amadeo.</p><div class="stats"><div class="stat"><div class="n" id="prodCount">0</div><div class="l">Products</div></div><div class="stat"><div class="n" id="shopCount">0</div><div class="l">Shops</div></div><div class="stat"><div class="n">24</div><div class="l">Barangays</div></div></div></div>
        <div class="cats"><div class="cats-in" id="prodCats"></div></div>
        <div class="wrap"><div class="grid" id="prodGrid"><div class="loading"><div class="spinner"></div><p>Loading...</p></div></div></div>
    </section>
    
    <section id="services" class="section hide">
        <div class="hero svc"><h1>Book Local Services</h1><p>Professional services from trusted Amadeo providers.</p><div class="stats"><div class="stat"><div class="n">50+</div><div class="l">Services</div></div><div class="stat"><div class="n">30+</div><div class="l">Providers</div></div><div class="stat"><div class="n">11</div><div class="l">Categories</div></div></div></div>
        <div class="cats"><div class="cats-in" id="svcCats"></div></div>
        <div class="wrap"><div class="grid svc" id="svcGrid"></div></div>
    </section>
    
    <section id="stays" class="section hide">
        <div class="hero stay"><h1>Find Unique Stays</h1><p>Private pools, rest houses, resorts in beautiful Amadeo.</p><div class="stats"><div class="stat"><div class="n">8</div><div class="l">Properties</div></div><div class="stat"><div class="n">8</div><div class="l">Hosts</div></div><div class="stat"><div class="n">5‚òÖ</div><div class="l">Top Rated</div></div></div></div>
        <div class="cats"><div class="cats-in" id="stayCats"></div></div>
        <div class="wrap"><div class="grid stay" id="stayGrid"></div></div>
    </section>
    
    <div class="overlay" id="overlay" onclick="toggleCart()"></div>
    <div class="cart-side" id="cartSide"><div class="cart-hdr"><h3>üõí Your Cart</h3><button class="close" onclick="toggleCart()">√ó</button></div><div class="cart-items" id="cartItems"><div class="cart-empty"><div class="i">üõí</div><p>Empty</p></div></div><div class="cart-ft hide" id="cartFt"><div class="cart-row"><span>Subtotal</span><span id="cartSub">‚Ç±0</span></div><div class="cart-row"><span>Delivery</span><span>‚Ç±50</span></div><div class="cart-row total"><span>Total</span><span id="cartTot">‚Ç±0</span></div><button class="btn btn-p" style="margin-top:10px" onclick="checkout()">Checkout</button></div></div>
    
    <!-- CHECKOUT MODAL -->
    <div class="modal-bg" id="checkoutModal"><div class="modal"><div class="modal-hdr"><h2>Checkout</h2><button class="close" onclick="closeModal('checkoutModal')">√ó</button></div><div class="modal-body"><form id="checkoutForm" onsubmit="submitOrder(event)">
        
        <h4 style="margin-bottom:10px;color:var(--g7);font-size:13px">üì¶ Customer Info</h4>
        <div class="fg-row"><div class="fg"><label>Full Name *</label><input type="text" id="custName" required></div><div class="fg"><label>Phone *</label><input type="tel" id="custPhone" required></div></div>
        <div class="fg"><label>Email</label><input type="email" id="custEmail"></div>
        
        <h4 style="margin:14px 0 10px;color:var(--g7);font-size:13px">üöö Delivery</h4>
        <div class="fg"><label>Barangay *</label><select id="custBrgy" required><option value="">Select</option><option>Barangay I (Poblacion)</option><option>Barangay II (Poblacion)</option><option>Barangay III (Poblacion)</option><option>Barangay IV (Poblacion)</option><option>Barangay V (Poblacion)</option><option>Barangay VI (Poblacion)</option><option>Barangay VII (Poblacion)</option><option>Barangay VIII (Poblacion)</option><option>Banaybanay</option><option>Buho</option><option>Dagatan</option><option>Halang</option><option>Loma</option><option>Lucsuhin</option><option>Magallanes</option><option>Maymangga</option><option>Minantok Kanluran</option><option>Minantok Silangan</option><option>Pangil</option><option>Salaban</option><option>Talon</option><option>Tamacan</option><option>Tibig</option><option>Ulo</option></select></div>
        <div class="fg"><label>Complete Address *</label><textarea id="custAddr" rows="2" required></textarea></div>
        
        <h4 style="margin:14px 0 10px;color:var(--g7);font-size:13px">üí≥ Payment Method</h4>
        <div class="pay-opts">
            <div class="pay-opt sel" onclick="selPay('cod')"><div class="i">üíµ</div><div class="nm">COD</div><div class="fee">Cash</div></div>
            <div class="pay-opt" onclick="selPay('gcash')"><div class="i">üì±</div><div class="nm">GCash</div><div class="fee">Instant</div></div>
            <div class="pay-opt" onclick="selPay('maya')"><div class="i">üí≥</div><div class="nm">Maya</div><div class="fee">Instant</div></div>
            <div class="pay-opt" onclick="selPay('bank')"><div class="i">üè¶</div><div class="nm">Bank</div><div class="fee">Transfer</div></div>
        </div>
        
        <!-- PAYMENT SECTION -->
        <div id="paymentSection" class="hide">
            <div class="order-ref-box">
                <div class="lbl">üìã Your Order Reference</div>
                <div class="ref" id="orderRefDisplay">AMV-00000000-0000</div>
                <div class="note">Save this! Include in your payment reference.</div>
            </div>
            
            <!-- GCash Payment -->
            <div id="gcashPay" class="pay-section gcash hide">
                <div class="qr-container">
                    <p class="pay-instruct">Scan QR or send to:</p>
                    <img id="gcashQR" alt="GCash QR">
                    <div class="acc-name">TYG Services</div>
                    <div class="acc-num">0966 960 6060</div>
                    <button type="button" class="copy-btn" onclick="copyNum('09669606060')">üìã Copy Number</button>
                </div>
            </div>
            
            <!-- Maya Payment -->
            <div id="mayaPay" class="pay-section maya hide">
                <div class="qr-container">
                    <p class="pay-instruct">Scan QR or send to:</p>
                    <img id="mayaQR" alt="Maya QR">
                    <div class="acc-name">TYG Services</div>
                    <div class="acc-num">0966 960 6060</div>
                    <button type="button" class="copy-btn" onclick="copyNum('09669606060')">üìã Copy Number</button>
                </div>
            </div>
            
            <!-- Bank Payment -->
            <div id="bankPay" class="pay-section bank hide">
                <div class="bank-tabs">
                    <button type="button" class="bank-tab sel" onclick="showBank('bdo')">BDO</button>
                    <button type="button" class="bank-tab" onclick="showBank('bpi')">BPI</button>
                </div>
                <div id="bdoContent" class="bank-content show">
                    <div class="qr-container">
                        <img id="bdoQR" alt="BDO QR">
                        <div class="acc-name">TYG Services</div>
                        <div class="acc-num">0066 7890 1234</div>
                        <button type="button" class="copy-btn" onclick="copyNum('006678901234')">üìã Copy</button>
                    </div>
                </div>
                <div id="bpiContent" class="bank-content">
                    <div class="qr-container">
                        <img id="bpiQR" alt="BPI QR">
                        <div class="acc-name">TYG Services</div>
                        <div class="acc-num">1234 5678 90</div>
                        <button type="button" class="copy-btn" onclick="copyNum('1234567890')">üìã Copy</button>
                    </div>
                </div>
            </div>
            
            <div class="fg">
                <label>Amount to Pay</label>
                <div style="font-size:24px;font-weight:700;color:var(--p);text-align:center;padding:10px;background:var(--g1);border-radius:8px" id="amountToPay">‚Ç±0</div>
            </div>
            
            <div class="fg">
                <label>Upload Payment Screenshot *</label>
                <label class="upload" id="uploadLabel">
                    <div class="i">üì∑</div>
                    <p style="font-size:12px">Click to upload proof of payment</p>
                    <input type="file" id="screenshot" accept="image/*" onchange="handleUpload(this)">
                </label>
                <div id="screenshotPreview"></div>
            </div>
        </div>
        
        <div class="summary">
            <h4>üìã Order Summary</h4>
            <div id="checkoutItems"></div>
            <div class="sum-row"><span>Subtotal</span><span id="chkSub">‚Ç±0</span></div>
            <div class="sum-row"><span>Delivery Fee</span><span>‚Ç±50</span></div>
            <div class="sum-row total"><span>Total</span><span id="chkTot">‚Ç±0</span></div>
        </div>
        
        <button type="submit" class="btn btn-p" id="orderBtn">Place Order</button>
    </form></div></div></div>
    
    <!-- SERVICE BOOKING MODAL -->
    <div class="modal-bg" id="svcModal"><div class="modal"><div class="modal-hdr"><h2>Book Service</h2><button class="close" onclick="closeModal('svcModal')">√ó</button></div><div class="modal-body"><form onsubmit="submitSvcBooking(event)">
        <div id="svcDetails"></div>
        <div class="fg-row" style="margin-top:12px"><div class="fg"><label>Your Name *</label><input type="text" id="bookName" required></div><div class="fg"><label>Phone *</label><input type="tel" id="bookPhone" required></div></div>
        <div class="fg"><label>Preferred Date *</label><input type="date" id="svcDate" required></div>
        <div class="fg"><label>Preferred Time *</label><input type="hidden" id="selTime"><div class="time-slots" id="timeSlots"></div></div>
        <div class="fg"><label>Service Location</label><select id="svcLoc" onchange="toggleSvcAddr()"><option value="home">üè† Home Service</option><option value="shop">üè™ Visit Shop</option></select></div>
        <div class="fg" id="svcAddr"><label>Your Address</label><textarea rows="2" placeholder="Complete address for home service"></textarea></div>
        <div class="summary">
            <h4>Booking Summary</h4>
            <div class="sum-row"><span>Service</span><span id="bookSvc">-</span></div>
            <div class="sum-row"><span>Duration</span><span id="bookDur">-</span></div>
            <div class="sum-row total"><span>Total</span><span id="bookTot">‚Ç±0</span></div>
        </div>
        <button type="submit" class="btn btn-p">Confirm Booking</button>
    </form></div></div></div>
    
    <!-- STAY BOOKING MODAL -->
    <div class="modal-bg" id="stayModal"><div class="modal"><div class="modal-hdr"><h2>Book Stay</h2><button class="close" onclick="closeModal('stayModal')">√ó</button></div><div class="modal-body"><form onsubmit="submitStayBooking(event)">
        <div id="stayDetails"></div>
        <div class="fg-row" style="margin-top:12px"><div class="fg"><label>Guest Name *</label><input type="text" id="guestName" required></div><div class="fg"><label>Phone *</label><input type="tel" id="guestPhone" required></div></div>
        <div class="fg"><label>Email</label><input type="email" id="guestEmail"></div>
        <div class="fg"><label>Booking Type</label><select id="stayType" onchange="calcStay()"><option value="overnight">üåô Overnight</option><option value="dayuse">‚òÄÔ∏è Day Use (8AM-5PM)</option></select></div>
        <div class="fg-row"><div class="fg"><label>Check-in *</label><input type="date" id="checkIn" required onchange="calcStay()"></div><div class="fg"><label>Check-out *</label><input type="date" id="checkOut" required onchange="calcStay()"></div></div>
        <div class="fg"><label>Number of Guests</label><select id="numGuests"><option>1-2</option><option>3-5</option><option>6-10</option><option>11-15</option><option>16-20</option><option>21+</option></select></div>
        <div class="summary">
            <h4>Booking Summary</h4>
            <div class="sum-row"><span>Property</span><span id="stayProp">-</span></div>
            <div class="sum-row"><span id="nightsLabel">Nights</span><span id="stayNights">0</span></div>
            <div class="sum-row"><span>Accommodation</span><span id="stayAccom">‚Ç±0</span></div>
            <div class="sum-row"><span>Cleaning Fee</span><span id="stayCln">‚Ç±0</span></div>
            <div class="sum-row"><span>Service Fee (12%)</span><span id="stayFee">‚Ç±0</span></div>
            <div class="sum-row total"><span>Total</span><span id="stayTot">‚Ç±0</span></div>
        </div>
        <button type="submit" class="btn btn-p">Request Booking</button>
    </form></div></div></div>
    
    <footer class="ftr"><div class="ftr-in"><div class="ftr-grid"><div class="ftr-col"><h4>üè™ Amadeo Marketplace</h4><a href="#">About Us</a><a href="#">How It Works</a><a href="#">Become a Seller</a><a href="#">Contact</a></div><div class="ftr-col"><h4>Shop</h4><a href="#">Products</a><a href="#">Services</a><a href="#">Stays</a><a href="#">Deals</a></div><div class="ftr-col"><h4>Support</h4><a href="#">Help Center</a><a href="#">Order Tracking</a><a href="#">Returns</a><a href="#">FAQs</a></div><div class="ftr-col"><h4>Connect</h4><a href="#">üì± 0966 960 6060</a><a href="#">‚úâÔ∏è hello@amadeo.market</a><a href="#">üìç Amadeo, Cavite</a></div></div><div class="partners"><span style="opacity:.6">TYG Family:</span><a href="https://tyg-services.com">TYG Services</a><a href="https://thegoldblessing.com">The Gold Blessing</a><a href="https://soleblessing.com">Sole Blessing</a><a href="https://ast3r.store">AST3R Fashion</a><a href="https://luntian.net">Luntian</a></div><div class="ftr-btm">¬© 2024 Amadeo Marketplace by TYG Services. All rights reserved.</div></div></footer>

<script>
const QR_IMAGES = {
    gcash: 'https://lh3.googleusercontent.com/d/1ABC123',
    maya: 'https://lh3.googleusercontent.com/d/1DEF456',
    bdo: 'https://lh3.googleusercontent.com/d/1GHI789',
    bpi: 'https://lh3.googleusercontent.com/d/1JKL012'
};

const API='https://script.google.com/macros/s/AKfycbwgHmmK1j8a6rqx_Zfk5nPGqdUIRSo1oIUNgGoVr2-in988F3K8Kyp8PN15zHS3InIUgw/exec';
let products=[],merchants={},cart=JSON.parse(localStorage.getItem('cart')||'[]');
let curTab='products',curCat='all',selPayment='cod',screenshot='',screenshotFile=null,selService=null,selStay=null,selTime='',searchTimer=null;
let currentOrderRef='';

const PROD_CATS=[{id:'all',n:'All',i:'üè∑Ô∏è'},{id:'Food & Beverages',n:'Food',i:'üçî'},{id:'Fresh Produce',n:'Fresh',i:'ü•¨'},{id:'Groceries',n:'Groceries',i:'üõí'},{id:'Health & Beauty',n:'Beauty',i:'üíÑ'},{id:'Home & Living',n:'Home',i:'üè†'},{id:'Fashion',n:'Fashion',i:'üëó'},{id:'Electronics',n:'Electronics',i:'üì±'},{id:'Plants',n:'Plants',i:'üå±'}];
const SVC_CATS=[{id:'all',n:'All',i:'üè∑Ô∏è'},{id:'Laundry',n:'Laundry',i:'üß∫'},{id:'Beauty',n:'Beauty',i:'üíÖ'},{id:'Massage',n:'Massage',i:'üíÜ'},{id:'Home Repair',n:'Repairs',i:'üî®'},{id:'Cleaning',n:'Cleaning',i:'üßπ'},{id:'Automotive',n:'Auto',i:'üöó'},{id:'Tech',n:'Tech',i:'üíª'},{id:'Pet',n:'Pet',i:'üêï'},{id:'Events',n:'Events',i:'üéâ'},{id:'Tutoring',n:'Tutoring',i:'üìö'}];
const STAY_CATS=[{id:'all',n:'All',i:'üè∑Ô∏è'},{id:'Private Pool',n:'Pools',i:'üèä'},{id:'Rest House',n:'Rest House',i:'üè°'},{id:'Resort',n:'Resorts',i:'üè®'},{id:'Farm Stay',n:'Farm',i:'üåæ'},{id:'Cabin',n:'Cabins',i:'üõñ'},{id:'Venue',n:'Venues',i:'üé™'}];

const SVCS=[
{id:'L01',n:'Wash & Fold',c:'Laundry',p:45,u:'/kg',d:'1-2 days',h:1,s:1},{id:'L02',n:'Dry Cleaning',c:'Laundry',p:120,u:'/pc',d:'2-3 days',h:1,s:1},{id:'L03',n:'Ironing Only',c:'Laundry',p:25,u:'/pc',d:'1 day',h:1,s:1},{id:'L04',n:'Beddings & Curtains',c:'Laundry',p:150,u:'/set',d:'2-3 days',h:1,s:1},
{id:'B01',n:'Manicure & Pedicure',c:'Beauty',p:250,u:'',d:'60 min',h:1,s:1},{id:'B02',n:'Gel Nails',c:'Beauty',p:450,u:'',d:'90 min',h:1,s:1},{id:'B03',n:'Nail Art',c:'Beauty',p:350,u:'',d:'60 min',h:1,s:1},{id:'B04',n:'Haircut - Women',c:'Beauty',p:150,u:'',d:'45 min',h:0,s:1},{id:'B05',n:'Haircut - Men',c:'Beauty',p:80,u:'',d:'30 min',h:0,s:1},{id:'B06',n:'Hair Color',c:'Beauty',p:800,u:'',d:'2-3 hrs',h:0,s:1},{id:'B07',n:'Hair Treatment',c:'Beauty',p:1200,u:'',d:'2-3 hrs',h:0,s:1},{id:'B08',n:'Keratin/Rebond',c:'Beauty',p:2500,u:'',d:'4-5 hrs',h:0,s:1},{id:'B09',n:'Makeup Service',c:'Beauty',p:1500,u:'',d:'1-2 hrs',h:1,s:1},{id:'B10',n:'Eyebrow Threading',c:'Beauty',p:80,u:'',d:'15 min',h:1,s:1},{id:'B11',n:'Facial Treatment',c:'Beauty',p:500,u:'',d:'60 min',h:1,s:1},{id:'B12',n:'Eyelash Extensions',c:'Beauty',p:800,u:'',d:'90 min',h:1,s:1},
{id:'M01',n:'Full Body Massage',c:'Massage',p:400,u:'/hr',d:'60 min',h:1,s:1},{id:'M02',n:'Hilot Traditional',c:'Massage',p:300,u:'/hr',d:'60 min',h:1,s:0},{id:'M03',n:'Foot Spa & Massage',c:'Massage',p:250,u:'',d:'45 min',h:1,s:1},{id:'M04',n:'Ventosa/Cupping',c:'Massage',p:350,u:'',d:'45 min',h:1,s:1},{id:'M05',n:'Hot Stone Massage',c:'Massage',p:600,u:'',d:'90 min',h:1,s:1},{id:'M06',n:'Prenatal Massage',c:'Massage',p:450,u:'',d:'60 min',h:1,s:1},{id:'M07',n:'Sports Massage',c:'Massage',p:500,u:'/hr',d:'60 min',h:1,s:1},{id:'M08',n:'Shiatsu Massage',c:'Massage',p:450,u:'/hr',d:'60 min',h:1,s:1},
{id:'H01',n:'House Painting',c:'Home Repair',p:80,u:'/sqm',d:'Varies',h:1,s:0},{id:'H02',n:'Plumbing Repair',c:'Home Repair',p:300,u:'/job',d:'1-3 hrs',h:1,s:0},{id:'H03',n:'Electrical Work',c:'Home Repair',p:350,u:'/job',d:'1-4 hrs',h:1,s:0},{id:'H04',n:'Aircon Cleaning',c:'Home Repair',p:400,u:'/unit',d:'1-2 hrs',h:1,s:0},{id:'H05',n:'Aircon Repair',c:'Home Repair',p:500,u:'/job',d:'Varies',h:1,s:0},{id:'H06',n:'Aircon Installation',c:'Home Repair',p:1500,u:'/unit',d:'2-4 hrs',h:1,s:0},{id:'H07',n:'Carpentry',c:'Home Repair',p:500,u:'/day',d:'Varies',h:1,s:0},{id:'H08',n:'Welding',c:'Home Repair',p:400,u:'/job',d:'Varies',h:1,s:0},{id:'H09',n:'Roofing Repair',c:'Home Repair',p:500,u:'/job',d:'Varies',h:1,s:0},{id:'H10',n:'Tile Installation',c:'Home Repair',p:150,u:'/sqm',d:'Varies',h:1,s:0},{id:'H11',n:'Glass Installation',c:'Home Repair',p:300,u:'/job',d:'1-2 hrs',h:1,s:0},{id:'H12',n:'Door/Lock Repair',c:'Home Repair',p:250,u:'/job',d:'1-2 hrs',h:1,s:0},
{id:'C01',n:'House Cleaning',c:'Cleaning',p:500,u:'',d:'3-4 hrs',h:1,s:0},{id:'C02',n:'Deep Cleaning',c:'Cleaning',p:1200,u:'',d:'5-6 hrs',h:1,s:0},{id:'C03',n:'Post-Construction',c:'Cleaning',p:2000,u:'',d:'6-8 hrs',h:1,s:0},{id:'C04',n:'Move-in/Move-out',c:'Cleaning',p:1500,u:'',d:'4-5 hrs',h:1,s:0},{id:'C05',n:'Upholstery Cleaning',c:'Cleaning',p:500,u:'/set',d:'2-3 hrs',h:1,s:0},{id:'C06',n:'Carpet Cleaning',c:'Cleaning',p:300,u:'/sqm',d:'2-3 hrs',h:1,s:0},
{id:'A01',n:'Car Wash',c:'Automotive',p:150,u:'',d:'30 min',h:1,s:1},{id:'A02',n:'Car Detailing',c:'Automotive',p:800,u:'',d:'3-4 hrs',h:1,s:1},{id:'A03',n:'Car Aircon Clean',c:'Automotive',p:500,u:'',d:'1-2 hrs',h:1,s:1},{id:'A04',n:'Oil Change',c:'Automotive',p:350,u:'',d:'30 min',h:0,s:1},{id:'A05',n:'Tire Change',c:'Automotive',p:100,u:'/tire',d:'30 min',h:1,s:1},{id:'A06',n:'Battery Jump Start',c:'Automotive',p:200,u:'',d:'30 min',h:1,s:0},
{id:'T01',n:'Computer Repair',c:'Tech',p:500,u:'/job',d:'Varies',h:1,s:1},{id:'T02',n:'Phone Repair',c:'Tech',p:300,u:'/job',d:'1-2 hrs',h:0,s:1},{id:'T03',n:'Laptop Repair',c:'Tech',p:600,u:'/job',d:'Varies',h:1,s:1},{id:'T04',n:'Printer Repair',c:'Tech',p:400,u:'/job',d:'1-2 hrs',h:1,s:1},{id:'T05',n:'CCTV Installation',c:'Tech',p:1500,u:'/cam',d:'2-4 hrs',h:1,s:0},{id:'T06',n:'WiFi Setup',c:'Tech',p:500,u:'',d:'1-2 hrs',h:1,s:0},
{id:'P01',n:'Dog Grooming',c:'Pet',p:350,u:'',d:'1-2 hrs',h:1,s:1},{id:'P02',n:'Cat Grooming',c:'Pet',p:400,u:'',d:'1-2 hrs',h:1,s:1},{id:'P03',n:'Pet Sitting',c:'Pet',p:300,u:'/day',d:'Daily',h:1,s:0},{id:'P04',n:'Dog Walking',c:'Pet',p:150,u:'/hr',d:'1 hr',h:1,s:0},
{id:'E01',n:'Event Catering',c:'Events',p:350,u:'/head',d:'Event',h:1,s:0},{id:'E02',n:'Event Host/Emcee',c:'Events',p:3000,u:'',d:'Event',h:1,s:0},{id:'E03',n:'Event Photography',c:'Events',p:5000,u:'',d:'Event',h:1,s:0},{id:'E04',n:'Event Videography',c:'Events',p:8000,u:'',d:'Event',h:1,s:0},{id:'E05',n:'Sound System',c:'Events',p:3000,u:'',d:'Event',h:1,s:0},{id:'E06',n:'Event Decoration',c:'Events',p:5000,u:'',d:'Event',h:1,s:0},
{id:'U01',n:'Math Tutoring',c:'Tutoring',p:300,u:'/hr',d:'1-2 hrs',h:1,s:0},{id:'U02',n:'English Tutoring',c:'Tutoring',p:300,u:'/hr',d:'1-2 hrs',h:1,s:0},{id:'U03',n:'Science Tutoring',c:'Tutoring',p:350,u:'/hr',d:'1-2 hrs',h:1,s:0},{id:'U04',n:'Filipino Tutoring',c:'Tutoring',p:250,u:'/hr',d:'1-2 hrs',h:1,s:0},{id:'U05',n:'Piano Lessons',c:'Tutoring',p:400,u:'/hr',d:'1 hr',h:1,s:1},{id:'U06',n:'Guitar Lessons',c:'Tutoring',p:350,u:'/hr',d:'1 hr',h:1,s:1}
];

const STAYS=[
{id:'S01',n:'Mountain View Private Pool',t:'Private Pool',l:'Dagatan',g:15,b:3,ba:2,r:5000,w:7000,cl:500,a:['Pool','WiFi','Parking','BBQ','Karaoke']},
{id:'S02',n:'Hilltop Pool Villa',t:'Private Pool',l:'Halang',g:20,b:4,ba:3,r:6000,w:8000,cl:600,a:['Pool','WiFi','BBQ','View','Parking']},
{id:'S03',n:'Poblacion Rest House',t:'Rest House',l:'Poblacion',g:10,b:3,ba:2,r:3500,w:5000,cl:400,a:['WiFi','Parking','Kitchen','TV']},
{id:'S04',n:'Amadeo Garden Resort',t:'Resort',l:'Maymangga',g:50,b:10,ba:10,r:800,w:1000,cl:0,a:['Pool','Restaurant','Parking','Events']},
{id:'S05',n:'Cozy Farm Cabin',t:'Farm Stay',l:'Halang',g:6,b:2,ba:1,r:2500,w:3500,cl:300,a:['WiFi','Parking','Kitchen','Garden']},
{id:'S06',n:'Bamboo Kubo Retreat',t:'Cabin',l:'Tibig',g:4,b:1,ba:1,r:1500,w:2000,cl:200,a:['Nature','Parking','Breakfast']},
{id:'S07',n:'Luntian Log Cabin',t:'Cabin',l:'Dagatan',g:8,b:2,ba:1,r:3000,w:4000,cl:300,a:['Pool','WiFi','Parking','View']},
{id:'S08',n:'Grand Function Hall',t:'Venue',l:'Poblacion',g:150,b:0,ba:4,r:15000,w:20000,cl:1000,a:['AC','Sound','Parking','Catering']}
];

function generateOrderRef(){const now=new Date();const date=now.toISOString().slice(0,10).replace(/-/g,'');const time=now.getTime().toString().slice(-4);return `AMV-${date}-${time}`;}

document.addEventListener('DOMContentLoaded',()=>{
    initTabs();renderCats();loadProducts();renderServices();renderStays();updateCart();checkLogin();setMinDates();initTimeSlots();
    document.getElementById('gcashQR').src=QR_IMAGES.gcash;
    document.getElementById('mayaQR').src=QR_IMAGES.maya;
    document.getElementById('bdoQR').src=QR_IMAGES.bdo;
    document.getElementById('bpiQR').src=QR_IMAGES.bpi;
});

function setMinDates(){const t=new Date().toISOString().split('T')[0];document.querySelectorAll('input[type="date"]').forEach(i=>i.min=t)}
function initTimeSlots(){document.getElementById('timeSlots').innerHTML=['08:00','09:00','10:00','11:00','13:00','14:00','15:00','16:00'].map(t=>`<div class="time-slot" onclick="pickTime('${t}')">${fmtTime(t)}</div>`).join('')}
function fmtTime(t){const h=+t.split(':')[0];return h<12?`${h} AM`:h===12?'12 PM':`${h-12} PM`}
function initTabs(){document.querySelectorAll('.tab').forEach(t=>t.onclick=()=>switchTab(t.dataset.tab))}
function switchTab(tab){curTab=tab;curCat='all';document.querySelectorAll('.tab').forEach(t=>t.classList.toggle('on',t.dataset.tab===tab));document.querySelectorAll('.section').forEach(s=>s.classList.toggle('hide',s.id!==tab));window.scrollTo({top:0,behavior:'smooth'});renderCats()}
function renderCats(){const c=curTab==='products'?PROD_CATS:curTab==='services'?SVC_CATS:STAY_CATS;const id=curTab==='products'?'prodCats':curTab==='services'?'svcCats':'stayCats';document.getElementById(id).innerHTML=c.map(x=>`<button class="cat${x.id===curCat?' on':''}" onclick="filterCat('${x.id}')">${x.i} ${x.n}</button>`).join('')}
function filterCat(cat){curCat=cat;renderCats();curTab==='products'?renderProducts():curTab==='services'?renderServices():renderStays()}
async function loadProducts(){try{const[p,m]=await Promise.all([fetch(`${API}?action=getAllInventory`),fetch(`${API}?action=getMerchants`)]);const pd=await p.json(),md=await m.json();if(pd.success){products=pd.data||[];document.getElementById('prodCount').textContent=products.length}if(md.success){md.data.forEach(x=>merchants[x.MerchantId]=x);document.getElementById('shopCount').textContent=md.data.length}renderProducts()}catch(e){document.getElementById('prodGrid').innerHTML='<div class="empty"><div class="i">üòï</div><h3>Error</h3></div>'}}
function renderProducts(){const g=document.getElementById('prodGrid');let list=curCat==='all'?products:products.filter(p=>p.Category&&p.Category.includes(curCat));if(!list.length){g.innerHTML='<div class="empty"><div class="i">üì¶</div><h3>No products</h3></div>';return}g.innerHTML=list.map(p=>{const m=merchants[p.MerchantId]||{},img=p.Image||p.ImageUrl||'',stk=p.available||p.StockLevel||999;const pickup=p.offersPickup||m.offersPickup;const delivery=p.offersDelivery||m.offersDelivery;const badges=(pickup?'<span class="f-badge pickup">üè™ Pickup</span>':'')+(delivery?'<span class="f-badge delivery">üöö Delivery</span>':'');return`<div class="card"><div class="card-img">${img?`<img src="${img}" loading="lazy" onerror="this.parentElement.innerHTML='<div class=ph>üì¶</div>'">`:'<div class="ph">üì¶</div>'}${stk>0&&stk<=5?'<span class="card-badge">Low</span>':''}</div><div class="card-body"><div class="card-shop">${m.BusinessName||p.merchantName||'Local Shop'}</div><div class="card-name">${p.Name}</div><div class="fulfill-opts">${badges||'<span class="f-badge pickup">üè™ Pickup</span>'}</div><div class="card-meta"><span class="stars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</span></div><div class="card-price">‚Ç±${(+p.Price).toLocaleString()}</div><button class="btn btn-p" onclick="addCart('${p.ProductId}')" ${stk<=0?'disabled':''}>${stk>0?'Add to Cart':'Out'}</button></div></div>`}).join('')}
function renderServices(){const g=document.getElementById('svcGrid');let list=curCat==='all'?SVCS:SVCS.filter(s=>s.c===curCat);const icons={Laundry:'üß∫',Beauty:'üíÖ',Massage:'üíÜ','Home Repair':'üî®',Cleaning:'üßπ',Automotive:'üöó',Tech:'üíª',Pet:'üêï',Events:'üéâ',Tutoring:'üìö'};g.innerHTML=list.map(s=>`<div class="card"><div class="card-img"><div class="ph">${icons[s.c]||'üîß'}</div></div><div class="card-body"><div class="card-shop">Provider Available</div><div class="card-name">${s.n}</div><div class="svc-info"><span class="svc-dur">‚è±Ô∏è ${s.d}</span><span class="stars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</span></div><div class="svc-type">${s.h?'<span class="home">üè† Home</span>':''}${s.s?'<span class="shop">üè™ Shop</span>':''}</div><div class="card-price">‚Ç±${s.p}<span class="unit">${s.u}</span></div><button class="btn btn-p" onclick="bookSvc('${s.id}')">Book</button></div></div>`).join('')}
function renderStays(){const g=document.getElementById('stayGrid');let list=curCat==='all'?STAYS:STAYS.filter(s=>s.t===curCat);const icons={'Private Pool':'üèä','Rest House':'üè°',Resort:'üè®','Farm Stay':'üåæ',Cabin:'üõñ',Venue:'üé™'};g.innerHTML=list.map(s=>`<div class="card"><div class="card-img"><div class="ph">${icons[s.t]||'üè†'}</div></div><div class="card-body"><div class="card-shop">üìç ${s.l}</div><div class="card-name">${s.n}</div><div class="stay-feat"><span>üë•${s.g}</span><span>üõèÔ∏è${s.b}</span><span>üöø${s.ba}</span></div><div class="card-meta"><span class="stars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</span></div><div class="stay-amen">${s.a.slice(0,3).join(' ‚Ä¢ ')}</div><div class="card-price">‚Ç±${s.r.toLocaleString()}<span class="unit">/night</span></div><button class="btn btn-p" onclick="bookStay('${s.id}')">Book</button></div></div>`).join('')}
function debounceSearch(q){clearTimeout(searchTimer);searchTimer=setTimeout(()=>doSearch(q),300)}
function doSearch(q){q=q.toLowerCase().trim();if(!q){renderProducts();renderServices();renderStays();return}if(curTab==='products'){const tmp=products;products=products.filter(p=>p.Name.toLowerCase().includes(q));renderProducts();products=tmp}else if(curTab==='services'){const list=SVCS.filter(s=>s.n.toLowerCase().includes(q)||s.c.toLowerCase().includes(q));document.getElementById('svcGrid').innerHTML=list.length?list.map(s=>`<div class="card"><div class="card-img"><div class="ph">üîß</div></div><div class="card-body"><div class="card-shop">Provider</div><div class="card-name">${s.n}</div><div class="svc-info"><span class="svc-dur">‚è±Ô∏è ${s.d}</span></div><div class="svc-type">${s.h?'<span class="home">üè†</span>':''}${s.s?'<span class="shop">üè™</span>':''}</div><div class="card-price">‚Ç±${s.p}${s.u}</div><button class="btn btn-p" onclick="bookSvc('${s.id}')">Book</button></div></div>`).join(''):'<div class="empty"><div class="i">üîç</div><h3>No results</h3></div>'}else{const list=STAYS.filter(s=>s.n.toLowerCase().includes(q)||s.l.toLowerCase().includes(q));document.getElementById('stayGrid').innerHTML=list.length?list.map(s=>`<div class="card"><div class="card-img"><div class="ph">üè†</div></div><div class="card-body"><div class="card-shop">üìç ${s.l}</div><div class="card-name">${s.n}</div><div class="stay-feat"><span>üë•${s.g}</span></div><div class="card-price">‚Ç±${s.r.toLocaleString()}/night</div><button class="btn btn-p" onclick="bookStay('${s.id}')">Book</button></div></div>`).join(''):'<div class="empty"><div class="i">üîç</div><h3>No results</h3></div>'}}
function addCart(id){const p=products.find(x=>x.ProductId===id);if(!p)return;const item=cart.find(x=>x.id===id);if(item)item.qty++;else cart.push({id,name:p.Name,price:p.Price,qty:1,mid:p.MerchantId,img:p.Image||p.ImageUrl});saveCart();updateCart();notify('Added!')}
function rmCart(id){cart=cart.filter(x=>x.id!==id);saveCart();updateCart()}
function updQty(id,d){const item=cart.find(x=>x.id===id);if(!item)return;item.qty+=d;if(item.qty<=0){rmCart(id);return}saveCart();updateCart()}
function saveCart(){localStorage.setItem('cart',JSON.stringify(cart))}
function updateCart(){const cnt=cart.reduce((s,i)=>s+i.qty,0);document.getElementById('cartCount').textContent=cnt;const el=document.getElementById('cartItems'),ft=document.getElementById('cartFt');if(!cart.length){el.innerHTML='<div class="cart-empty"><div class="i">üõí</div><p>Empty</p></div>';ft.classList.add('hide');return}ft.classList.remove('hide');el.innerHTML=cart.map(i=>`<div class="cart-item"><div class="cart-item-img">${i.img?`<img src="${i.img}">`:'üì¶'}</div><div class="cart-item-info"><div class="cart-item-name">${i.name}</div><div class="cart-item-price">‚Ç±${(+i.price).toLocaleString()}</div><div class="cart-item-qty"><button class="qty-btn" onclick="updQty('${i.id}',-1)">‚àí</button><span>${i.qty}</span><button class="qty-btn" onclick="updQty('${i.id}',1)">+</button></div></div><button class="cart-item-rm" onclick="rmCart('${i.id}')">√ó</button></div>`).join('');const sub=cart.reduce((s,i)=>s+i.price*i.qty,0);document.getElementById('cartSub').textContent=`‚Ç±${sub.toLocaleString()}`;document.getElementById('cartTot').textContent=`‚Ç±${(sub+50).toLocaleString()}`}
function toggleCart(){document.getElementById('overlay').classList.toggle('on');document.getElementById('cartSide').classList.toggle('on')}
function checkout(){if(!cart.length)return;toggleCart();currentOrderRef=generateOrderRef();document.getElementById('orderRefDisplay').textContent=currentOrderRef;document.getElementById('checkoutModal').classList.add('on');updCheckout();autoFill();selPay('cod');}
function closeModal(id){document.getElementById(id).classList.remove('on')}
function selPay(m){selPayment=m;document.querySelectorAll('.pay-opt').forEach(o=>o.classList.toggle('sel',o.onclick.toString().includes("'"+m+"'")));const paySection=document.getElementById('paymentSection');const gcashPay=document.getElementById('gcashPay');const mayaPay=document.getElementById('mayaPay');const bankPay=document.getElementById('bankPay');gcashPay.classList.add('hide');mayaPay.classList.add('hide');bankPay.classList.add('hide');if(m==='cod'){paySection.classList.add('hide');}else{paySection.classList.remove('hide');if(m==='gcash')gcashPay.classList.remove('hide');if(m==='maya')mayaPay.classList.remove('hide');if(m==='bank')bankPay.classList.remove('hide');}updCheckout();}
function showBank(bank){document.querySelectorAll('.bank-tab').forEach(t=>t.classList.toggle('sel',t.onclick.toString().includes("'"+bank+"'")));document.querySelectorAll('.bank-content').forEach(c=>c.classList.remove('show'));document.getElementById(bank+'Content').classList.add('show');}
function copyNum(num){navigator.clipboard.writeText(num).then(()=>{notify('Copied: '+num);}).catch(()=>{const ta=document.createElement('textarea');ta.value=num;document.body.appendChild(ta);ta.select();document.execCommand('copy');document.body.removeChild(ta);notify('Copied!');});}
function updCheckout(){const sub=cart.reduce((s,i)=>s+i.price*i.qty,0);const tot=sub+50;document.getElementById('checkoutItems').innerHTML=cart.map(i=>`<div class="sum-row"><span>${i.name} x${i.qty}</span><span>‚Ç±${(i.price*i.qty).toLocaleString()}</span></div>`).join('');document.getElementById('chkSub').textContent=`‚Ç±${sub.toLocaleString()}`;document.getElementById('chkTot').textContent=`‚Ç±${tot.toLocaleString()}`;document.getElementById('amountToPay').textContent=`‚Ç±${tot.toLocaleString()}`;}
function handleUpload(input){const f=input.files[0];if(!f)return;screenshotFile=f;const r=new FileReader();r.onload=e=>{screenshot=e.target.result;document.getElementById('uploadLabel').innerHTML=`<div class="i">‚úÖ</div><p style="font-size:11px;color:var(--g)">${f.name}</p><input type="file" id="screenshot" accept="image/*" onchange="handleUpload(this)">`;document.getElementById('screenshotPreview').innerHTML=`<img src="${e.target.result}" class="screenshot-preview"><div class="upload-success">‚úÖ Screenshot uploaded</div>`;};r.readAsDataURL(f);}
async function submitOrder(e){e.preventDefault();const btn=document.getElementById('orderBtn');btn.disabled=true;btn.textContent='Processing...';try{if(selPayment!=='cod'&&!screenshot){alert('Please upload payment screenshot');btn.disabled=false;btn.textContent='Place Order';return;}const sub=cart.reduce((s,i)=>s+i.price*i.qty,0);const tot=sub+50;const data={action:'createOrder',orderId:currentOrderRef,merchantId:cart[0].mid,customerName:document.getElementById('custName').value,customerPhone:document.getElementById('custPhone').value,customerEmail:document.getElementById('custEmail').value||'',barangay:document.getElementById('custBrgy').value,deliveryAddress:document.getElementById('custAddr').value,items:cart.map(i=>({productId:i.id,productName:i.name,quantity:i.qty,price:i.price})),subtotal:sub,deliveryFee:50,platformFee:0,total:tot,paymentMethod:selPayment,paymentScreenshot:selPayment!=='cod'?screenshot:''};const res=await fetch(API,{method:'POST',mode:'cors',headers:{'Content-Type':'text/plain;charset=utf-8'},body:JSON.stringify(data)});const result=await res.json();if(result.success){cart=[];saveCart();updateCart();closeModal('checkoutModal');screenshot='';screenshotFile=null;document.getElementById('screenshotPreview').innerHTML='';document.getElementById('uploadLabel').innerHTML=`<div class="i">üì∑</div><p style="font-size:12px">Click to upload proof of payment</p><input type="file" id="screenshot" accept="image/*" onchange="handleUpload(this)">`;alert(`‚úÖ Order Placed!\n\nüìã Order: ${currentOrderRef}\nüí∞ Total: ‚Ç±${tot.toLocaleString()}\n\n${selPayment==='cod'?'Pay upon delivery.':'Payment received. We will verify shortly.'}`);}else{throw new Error(result.error||'Order failed');}}catch(err){alert('Error: '+err.message);}finally{btn.disabled=false;btn.textContent='Place Order';}}
function bookSvc(id){selService=SVCS.find(s=>s.id===id);if(!selService)return;document.getElementById('svcDetails').innerHTML=`<div style="background:var(--g1);padding:10px;border-radius:8px"><h3 style="color:var(--p);font-size:15px;margin-bottom:4px">${selService.n}</h3><p style="color:var(--g5);font-size:12px">${selService.c}</p></div>`;document.getElementById('bookSvc').textContent=selService.n;document.getElementById('bookDur').textContent=selService.d;document.getElementById('bookTot').textContent=`‚Ç±${selService.p}${selService.u}`;document.getElementById('svcModal').classList.add('on');autoFill()}
function pickTime(t){selTime=t;document.querySelectorAll('.time-slot').forEach(s=>s.classList.toggle('sel',s.textContent===fmtTime(t)));document.getElementById('selTime').value=t}
function toggleSvcAddr(){document.getElementById('svcAddr').style.display=document.getElementById('svcLoc').value==='home'?'block':'none'}
async function submitSvcBooking(e){e.preventDefault();if(!selTime){alert('Select time');return}alert(`Booking submitted!\n\n${selService.n}\nDate: ${document.getElementById('svcDate').value}\nTime: ${fmtTime(selTime)}`);closeModal('svcModal');selService=null;selTime=''}
function bookStay(id){selStay=STAYS.find(s=>s.id===id);if(!selStay)return;document.getElementById('stayDetails').innerHTML=`<div style="background:var(--g1);padding:10px;border-radius:8px"><h3 style="color:var(--p);font-size:15px;margin-bottom:4px">${selStay.n}</h3><p style="color:var(--g5);font-size:12px">üìç ${selStay.l} ‚Ä¢ Up to ${selStay.g} guests</p></div>`;document.getElementById('stayProp').textContent=selStay.n;document.getElementById('stayCln').textContent=`‚Ç±${selStay.cl.toLocaleString()}`;document.getElementById('stayModal').classList.add('on');autoFill();calcStay()}
function calcStay(){if(!selStay)return;const inD=new Date(document.getElementById('checkIn').value),outD=new Date(document.getElementById('checkOut').value),type=document.getElementById('stayType').value;let nights=0,accom=0;if(type==='dayuse'){nights=1;accom=Math.round(selStay.r*0.6);document.getElementById('nightsLabel').textContent='Day Use';document.getElementById('stayNights').textContent='1 day'}else if(inD&&outD&&outD>inD){nights=Math.ceil((outD-inD)/(1000*60*60*24));accom=nights*selStay.r;document.getElementById('nightsLabel').textContent='Nights';document.getElementById('stayNights').textContent=`${nights} night${nights>1?'s':''}`}const fee=Math.round(accom*0.12),tot=accom+selStay.cl+fee;document.getElementById('stayAccom').textContent=`‚Ç±${accom.toLocaleString()}`;document.getElementById('stayFee').textContent=`‚Ç±${fee.toLocaleString()}`;document.getElementById('stayTot').textContent=`‚Ç±${tot.toLocaleString()}`}
async function submitStayBooking(e){e.preventDefault();alert(`Booking submitted!\n\n${selStay.n}\nCheck-in: ${document.getElementById('checkIn').value}\nCheck-out: ${document.getElementById('checkOut').value}`);closeModal('stayModal');selStay=null}
function checkLogin(){const u=JSON.parse(localStorage.getItem('amadeo_user')||'null');if(u){document.getElementById('loginLink').textContent=(u.Name||u.BusinessName||'User').split(' ')[0];document.getElementById('loginLink').href=u.MerchantId?'/dashboard':'/account'}}
function autoFill(){const u=JSON.parse(localStorage.getItem('amadeo_user')||'null');if(!u)return;['custName','bookName','guestName'].forEach(id=>{const el=document.getElementById(id);if(el)el.value=u.Name||''});['custPhone','bookPhone','guestPhone'].forEach(id=>{const el=document.getElementById(id);if(el)el.value=u.Phone||''});['custEmail','guestEmail'].forEach(id=>{const el=document.getElementById(id);if(el)el.value=u.Email||''})}
function notify(msg){const n=document.createElement('div');n.style.cssText='position:fixed;bottom:20px;left:50%;transform:translateX(-50%);background:var(--p);color:#fff;padding:12px 24px;border-radius:25px;font-size:14px;font-weight:600;z-index:9999;animation:fadeIn .3s';n.textContent=msg;document.body.appendChild(n);setTimeout(()=>n.remove(),2000)}
</script>
</body>
</html>
