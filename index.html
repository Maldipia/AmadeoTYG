<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Amadeo Verified Marketplace | Shop Local in Amadeo, Cavite</title>
    <meta name="description" content="Your trusted directory for verified local businesses in Amadeo, Cavite. From water delivery to home repairs - shop local, support Amadeo.">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üè™</text></svg>">
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #2d6a4f;
            --primary-light: #40916c;
            --primary-dark: #1b4332;
            --accent: #f77f00;
            --accent-light: #fcbf49;
            --cream: #fefae0;
            --warm-white: #fffef7;
            --text-dark: #1a1a1a;
            --text-muted: #6b7280;
            --border: #e5e7eb;
            --success: #10b981;
            --error: #ef4444;
            --shadow-sm: 0 1px 3px rgba(0,0,0,0.08);
            --shadow-md: 0 4px 12px rgba(0,0,0,0.1);
            --shadow-lg: 0 10px 25px rgba(0,0,0,0.15);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'DM Sans', sans-serif; background: var(--warm-white); color: var(--text-dark); line-height: 1.6; }

        /* ============================================
           HEADER STYLES
           ============================================ */
        .header { background: white; position: sticky; top: 0; z-index: 1000; box-shadow: var(--shadow-sm); }
        
        .header-top { 
            background: linear-gradient(90deg, #dc2626 0%, #b91c1c 100%); 
            color: white; 
            padding: 8px 20px; 
            text-align: center; 
            font-weight: 600; 
            font-size: 0.8rem; 
        }
        .header-top a { color: white; text-decoration: none; }
        
        .header-main { 
            max-width: 1400px; 
            margin: 0 auto; 
            padding: 15px 20px; 
            display: flex; 
            align-items: center; 
            justify-content: space-between; 
            gap: 20px; 
        }
        
        .logo { 
            display: flex; 
            align-items: center; 
            gap: 10px; 
            text-decoration: none; 
            color: var(--primary-dark); 
            font-weight: 700; 
            font-size: 1.2rem; 
        }
        .logo span { font-size: 1.5rem; }
        .logo-text { display: flex; flex-direction: column; line-height: 1.2; }
        .logo-subtitle { font-size: 0.65rem; color: var(--text-muted); font-weight: 500; }
        
        .search-box { flex: 1; max-width: 500px; position: relative; }
        .search-input { 
            width: 100%; 
            padding: 12px 45px 12px 18px; 
            border: 2px solid var(--border); 
            border-radius: 50px; 
            outline: none; 
            font-size: 0.95rem;
        }
        .search-input:focus { border-color: var(--primary); }
        .search-icon { 
            position: absolute; 
            right: 15px; 
            top: 50%; 
            transform: translateY(-50%); 
            color: var(--text-muted);
        }
        
        .nav-actions { display: flex; gap: 10px; align-items: center; }
        
        .btn { 
            padding: 10px 18px; 
            border-radius: 50px; 
            text-decoration: none; 
            font-weight: 600; 
            font-size: 0.9rem; 
            cursor: pointer; 
            border: none;
            transition: all 0.3s;
        }
        .btn-outline { 
            background: transparent; 
            border: 2px solid var(--primary); 
            color: var(--primary); 
        }
        .btn-primary { 
            background: var(--primary); 
            color: white; 
        }
        .btn-primary:hover { background: var(--primary-dark); }
        .btn-cart { 
            background: var(--accent); 
            color: white; 
            position: relative;
        }
        .cart-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: var(--error);
            color: white;
            font-size: 0.7rem;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* ============================================
           HERO SECTION
           ============================================ */
        .hero {
            background: linear-gradient(135deg, var(--primary-dark) 0%, var(--primary) 50%, var(--primary-light) 100%);
            color: white;
            padding: 60px 20px;
            text-align: center;
        }
        .hero h1 { font-size: 2.5rem; margin-bottom: 15px; }
        .hero p { font-size: 1.1rem; opacity: 0.9; max-width: 600px; margin: 0 auto 30px; }
        
        .stats-row {
            display: flex;
            justify-content: center;
            gap: 40px;
            flex-wrap: wrap;
        }
        .stat-item { text-align: center; }
        .stat-number { font-size: 2rem; font-weight: 700; }
        .stat-label { font-size: 0.85rem; opacity: 0.8; }

        /* ============================================
           CATEGORY CHIPS
           ============================================ */
        .categories-section {
            background: white;
            padding: 20px;
            border-bottom: 1px solid var(--border);
        }
        .categories-container {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            gap: 10px;
            overflow-x: auto;
            padding-bottom: 10px;
        }
        .cat-chip {
            padding: 10px 20px;
            background: var(--cream);
            border: none;
            border-radius: 25px;
            font-weight: 600;
            cursor: pointer;
            white-space: nowrap;
            font-size: 0.9rem;
            transition: all 0.3s;
        }
        .cat-chip:hover, .cat-chip.active {
            background: var(--primary);
            color: white;
        }

        /* ============================================
           MERCHANTS GRID
           ============================================ */
        .main-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 30px 20px;
        }
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }
        .section-title { font-size: 1.5rem; color: var(--primary-dark); }

        .merchants-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 25px;
        }

        .merchant-card {
            background: white;
            border-radius: 16px;
            overflow: hidden;
            box-shadow: var(--shadow-md);
            cursor: pointer;
            transition: transform 0.3s, box-shadow 0.3s;
        }
        .merchant-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
        }
        .merchant-banner {
            height: 120px;
            background: linear-gradient(135deg, var(--primary-light), var(--primary));
            position: relative;
        }
        .merchant-banner img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .merchant-status {
            position: absolute;
            top: 10px;
            right: 10px;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
        }
        .merchant-status.open { background: var(--success); color: white; }
        .merchant-status.closed { background: rgba(0,0,0,0.5); color: white; }

        .merchant-header {
            display: flex;
            padding: 15px;
            gap: 12px;
            margin-top: -30px;
            position: relative;
        }
        .merchant-logo {
            width: 60px;
            height: 60px;
            background: white;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            box-shadow: var(--shadow-sm);
            overflow: hidden;
        }
        .merchant-logo img { width: 100%; height: 100%; object-fit: cover; }
        .merchant-info { flex: 1; padding-top: 10px; }
        .merchant-info h3 { font-size: 1.1rem; margin-bottom: 3px; }
        .merchant-info p { font-size: 0.85rem; color: var(--text-muted); }

        .merchant-body {
            padding: 0 15px 15px;
            font-size: 0.9rem;
            color: var(--text-muted);
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .merchant-tags {
            padding: 0 15px 15px;
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }
        .merchant-tag {
            padding: 4px 10px;
            background: var(--cream);
            border-radius: 15px;
            font-size: 0.75rem;
            font-weight: 500;
        }

        .merchant-footer {
            padding: 15px;
            border-top: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .merchant-meta { font-size: 0.85rem; color: var(--text-muted); }
        .merchant-rating { color: var(--accent); font-weight: 600; }

        /* ============================================
           LOADING STATE
           ============================================ */
        .loading {
            grid-column: 1 / -1;
            text-align: center;
            padding: 60px 20px;
        }
        .spinner {
            width: 50px;
            height: 50px;
            border: 4px solid var(--border);
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        @keyframes spin { to { transform: rotate(360deg); } }

        /* ============================================
           STORE MODAL
           ============================================ */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 2000;
            overflow-y: auto;
            padding: 20px;
        }
        .modal-overlay.active { display: flex; justify-content: center; align-items: flex-start; }
        
        .store-modal {
            background: white;
            width: 100%;
            max-width: 900px;
            border-radius: 20px;
            overflow: hidden;
            margin: 20px 0;
        }
        .store-header {
            background: linear-gradient(135deg, var(--primary-dark), var(--primary));
            color: white;
            padding: 25px;
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
        }
        .store-header h2 { font-size: 1.5rem; margin-bottom: 8px; }
        .store-header p { opacity: 0.9; font-size: 0.9rem; }
        .close-btn {
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            font-size: 1.5rem;
            cursor: pointer;
        }
        
        .store-content { padding: 25px; }
        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
        }
        .product-card {
            background: var(--cream);
            border-radius: 12px;
            overflow: hidden;
            text-align: center;
        }
        .product-image {
            height: 140px;
            background: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3rem;
        }
        .product-image img { width: 100%; height: 100%; object-fit: cover; }
        .product-name { font-weight: 600; padding: 12px 12px 5px; font-size: 0.95rem; }
        .product-unit { font-size: 0.8rem; color: var(--text-muted); }
        .product-price { font-size: 1.2rem; font-weight: 700; color: var(--primary); padding: 5px 12px; }
        .product-stock { font-size: 0.8rem; color: var(--text-muted); padding-bottom: 10px; }
        .product-stock.low { color: var(--accent); }
        .product-stock.out { color: var(--error); }
        .btn-add {
            width: 100%;
            padding: 12px;
            background: var(--primary);
            color: white;
            border: none;
            font-weight: 600;
            cursor: pointer;
        }
        .btn-add:hover { background: var(--primary-dark); }
        .btn-add:disabled { background: var(--border); cursor: not-allowed; }

        /* ============================================
           CART SIDEBAR
           ============================================ */
        .cart-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.4);
            z-index: 3000;
        }
        .cart-overlay.active { display: block; }
        
        .cart-sidebar {
            position: fixed;
            top: 0;
            right: -400px;
            width: 400px;
            max-width: 100%;
            height: 100%;
            background: white;
            z-index: 3001;
            display: flex;
            flex-direction: column;
            transition: right 0.3s;
        }
        .cart-sidebar.open { right: 0; }
        
        .cart-header {
            padding: 20px;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .cart-header h3 { font-size: 1.2rem; }
        
        .cart-items {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
        }
        .cart-empty {
            text-align: center;
            padding: 40px 20px;
            color: var(--text-muted);
        }
        .cart-item {
            display: flex;
            gap: 12px;
            padding: 15px 0;
            border-bottom: 1px solid var(--border);
        }
        .cart-item-image {
            width: 60px;
            height: 60px;
            background: var(--cream);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .cart-item-details { flex: 1; }
        .cart-item-name { font-weight: 600; margin-bottom: 4px; }
        .cart-item-price { color: var(--primary); font-weight: 600; }
        .cart-item-qty {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 8px;
        }
        .qty-btn {
            width: 28px;
            height: 28px;
            border: 1px solid var(--border);
            background: white;
            border-radius: 6px;
            cursor: pointer;
        }
        .cart-item-remove {
            color: var(--error);
            background: none;
            border: none;
            cursor: pointer;
        }
        
        .cart-footer {
            padding: 20px;
            border-top: 1px solid var(--border);
            background: var(--cream);
        }
        .cart-total {
            display: flex;
            justify-content: space-between;
            font-size: 1.2rem;
            font-weight: 700;
            margin-bottom: 15px;
        }
        .btn-checkout {
            width: 100%;
            padding: 15px;
            background: var(--accent);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 700;
            cursor: pointer;
        }
        .btn-checkout:hover { background: #e56b00; }

        /* ============================================
           CHECKOUT MODAL
           ============================================ */
        .checkout-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 4000;
            overflow-y: auto;
            padding: 20px;
        }
        .checkout-modal.active { display: flex; justify-content: center; align-items: flex-start; }
        
        .checkout-container {
            background: white;
            width: 100%;
            max-width: 600px;
            border-radius: 20px;
            margin: 20px 0;
            overflow: hidden;
        }
        .checkout-header {
            background: var(--primary);
            color: white;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .checkout-body { padding: 25px; }
        
        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; margin-bottom: 8px; font-weight: 600; }
        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid var(--border);
            border-radius: 10px;
            font-size: 1rem;
        }
        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: var(--primary);
        }
        .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        
        .payment-options { display: flex; flex-direction: column; gap: 10px; }
        .payment-option {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 15px;
            border: 2px solid var(--border);
            border-radius: 10px;
            cursor: pointer;
        }
        .payment-option.selected { border-color: var(--primary); background: rgba(45,106,79,0.05); }
        .payment-option input { width: 18px; height: 18px; }
        
        .order-summary {
            background: var(--cream);
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
        }
        .summary-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
        }
        .summary-item.total {
            border-top: 2px solid var(--border);
            margin-top: 10px;
            padding-top: 15px;
            font-weight: 700;
            font-size: 1.1rem;
        }
        
        .btn-place-order {
            width: 100%;
            padding: 16px;
            background: var(--accent);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 1.1rem;
            font-weight: 700;
            cursor: pointer;
        }

        /* ============================================
           TOAST NOTIFICATION
           ============================================ */
        .toast {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            background: var(--text-dark);
            color: white;
            padding: 15px 25px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
            opacity: 0;
            transition: all 0.3s;
            z-index: 9999;
        }
        .toast.show { transform: translateX(-50%) translateY(0); opacity: 1; }
        .toast.success { background: var(--success); }
        .toast.error { background: var(--error); }

        /* ============================================
           FOOTER
           ============================================ */
        .footer {
            background: var(--primary-dark);
            color: white;
            padding: 40px 20px;
            margin-top: 60px;
        }
        .footer-content {
            max-width: 1400px;
            margin: 0 auto;
        }
        .footer-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 30px;
            margin-bottom: 30px;
        }
        .footer-section h4 { margin-bottom: 15px; font-size: 1rem; }
        .footer-section p, .footer-section a {
            color: rgba(255,255,255,0.8);
            font-size: 0.9rem;
            text-decoration: none;
            display: block;
            margin-bottom: 8px;
        }
        .footer-section a:hover { color: white; }
        .footer-bottom {
            border-top: 1px solid rgba(255,255,255,0.2);
            padding-top: 20px;
            text-align: center;
            font-size: 0.85rem;
            opacity: 0.8;
        }

        /* ============================================
           TYG BUSINESS NETWORK
           ============================================ */
        .business-network {
            background: #f8fafc;
            padding: 40px 20px;
            border-top: 1px solid var(--border);
        }
        .network-title {
            text-align: center;
            color: var(--text-muted);
            font-size: 0.85rem;
            margin-bottom: 25px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        .network-grid {
            max-width: 1200px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 15px;
        }
        .network-item {
            text-align: center;
            padding: 15px 10px;
            background: white;
            border-radius: 12px;
            text-decoration: none;
            color: var(--text-dark);
            transition: all 0.3s;
            border: 1px solid var(--border);
        }
        .network-item:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-md);
            border-color: var(--primary);
        }
        .network-item.featured {
            border: 2px solid var(--success);
            background: linear-gradient(135deg, #f0fdf4, white);
        }
        .network-icon { font-size: 1.5rem; margin-bottom: 8px; }
        .network-name { font-weight: 600; font-size: 0.85rem; margin-bottom: 3px; }
        .network-desc { font-size: 0.7rem; color: var(--text-muted); }
        .network-live {
            display: inline-block;
            background: var(--success);
            color: white;
            font-size: 0.6rem;
            padding: 2px 6px;
            border-radius: 10px;
            margin-top: 5px;
        }

        /* ============================================
           RESPONSIVE
           ============================================ */
        @media (max-width: 768px) {
            .header-main { flex-wrap: wrap; }
            .search-box { order: 3; flex-basis: 100%; max-width: none; }
            .hero h1 { font-size: 1.8rem; }
            .stats-row { gap: 20px; }
            .form-row { grid-template-columns: 1fr; }
            .network-grid { grid-template-columns: repeat(3, 1fr); }
        }
        @media (max-width: 480px) {
            .network-grid { grid-template-columns: repeat(2, 1fr); }
            .btn { padding: 8px 14px; font-size: 0.85rem; }
        }
    </style>
</head>
<body>
    <!-- ============================================
         HEADER
         ============================================ -->
    <header class="header">
        <div class="header-top">
            üè™ Welcome to Amadeo's Official Online Marketplace! <a href="/merchant-register">Become a Merchant ‚Üí</a>
        </div>
        <div class="header-main">
            <a href="/" class="logo">
                <span>üè†</span>
                <div class="logo-text">
                    Amadeo Marketplace
                    <span class="logo-subtitle">Shop Local, Support Amadeo</span>
                </div>
            </a>
            <div class="search-box">
                <input type="text" class="search-input" placeholder="Search products, stores..." id="searchInput" onkeyup="handleSearch(event)">
                <span class="search-icon">üîç</span>
            </div>
            <div class="nav-actions">
                <a href="/merchant-register" class="btn btn-outline">Sell on Amadeo</a>
                <button class="btn btn-cart" onclick="toggleCart()">
                    üõí <span id="cartCount">0</span>
                </button>
            </div>
        </div>
    </header>

    <!-- ============================================
         HERO SECTION
         ============================================ -->
    <section class="hero">
        <h1>üè† Ang Online Palengke ng Amadeo</h1>
        <p>Discover verified local businesses. From fresh produce to home services - everything you need, all from Amadeo.</p>
        <div class="stats-row">
            <div class="stat-item">
                <div class="stat-number" id="statMerchants">--</div>
                <div class="stat-label">Verified Merchants</div>
            </div>
            <div class="stat-item">
                <div class="stat-number" id="statProducts">--</div>
                <div class="stat-label">Products Available</div>
            </div>
            <div class="stat-item">
                <div class="stat-number">26</div>
                <div class="stat-label">Barangays Served</div>
            </div>
        </div>
    </section>

    <!-- ============================================
         CATEGORIES
         ============================================ -->
    <section class="categories-section">
        <div class="categories-container">
            <button class="cat-chip active" onclick="filterCategory('all', this)">üè™ All</button>
            <button class="cat-chip" onclick="filterCategory('Water', this)">üíß Water</button>
            <button class="cat-chip" onclick="filterCategory('Food', this)">üç± Food</button>
            <button class="cat-chip" onclick="filterCategory('Coffee', this)">‚òï Coffee</button>
            <button class="cat-chip" onclick="filterCategory('Grocery', this)">üõí Grocery</button>
            <button class="cat-chip" onclick="filterCategory('Rice', this)">üåæ Rice</button>
            <button class="cat-chip" onclick="filterCategory('Meat', this)">ü•© Meat</button>
            <button class="cat-chip" onclick="filterCategory('Services', this)">üîß Services</button>
            <button class="cat-chip" onclick="filterCategory('Hardware', this)">üî® Hardware</button>
        </div>
    </section>

    <!-- ============================================
         MERCHANTS GRID
         ============================================ -->
    <main class="main-content">
        <div class="section-header">
            <h2 class="section-title">üè™ Verified Merchants</h2>
        </div>
        <div class="merchants-grid" id="merchantsContainer">
            <div class="loading">
                <div class="spinner"></div>
                <p>Loading verified merchants...</p>
            </div>
        </div>
    </main>

    <!-- ============================================
         STORE MODAL
         ============================================ -->
    <div class="modal-overlay" id="storeModal" onclick="closeStoreModal(event)">
        <div class="store-modal" onclick="event.stopPropagation()">
            <div class="store-header">
                <div>
                    <h2 id="storeModalTitle">Store Name</h2>
                    <p id="storeModalLocation">üìç Location</p>
                    <p id="storeModalPhone">üìû Phone</p>
                </div>
                <button class="close-btn" onclick="closeStore()">√ó</button>
            </div>
            <div class="store-content">
                <p id="storeModalDesc" style="margin-bottom: 20px; color: var(--text-muted);">Store description</p>
                <h3 style="margin-bottom: 15px;">Products</h3>
                <div class="products-grid" id="storeProducts">
                    <!-- Products loaded dynamically -->
                </div>
            </div>
        </div>
    </div>

    <!-- ============================================
         CART SIDEBAR
         ============================================ -->
    <div class="cart-overlay" id="cartOverlay" onclick="toggleCart()"></div>
    <div class="cart-sidebar" id="cartSidebar">
        <div class="cart-header">
            <h3>üõí Your Cart</h3>
            <button class="close-btn" onclick="toggleCart()" style="background: var(--border);">√ó</button>
        </div>
        <div class="cart-items" id="cartItems">
            <div class="cart-empty">
                <p style="font-size: 3rem; margin-bottom: 15px;">üõí</p>
                <p>Your cart is empty</p>
                <p style="font-size: 0.85rem;">Add items from our merchants!</p>
            </div>
        </div>
        <div class="cart-footer">
            <div class="cart-total">
                <span>Total:</span>
                <span id="cartTotal">‚Ç±0.00</span>
            </div>
            <button class="btn-checkout" onclick="openCheckout()">Proceed to Checkout</button>
        </div>
    </div>

    <!-- ============================================
         CHECKOUT MODAL
         ============================================ -->
    <div class="checkout-modal" id="checkoutModal" onclick="closeCheckoutModal(event)">
        <div class="checkout-container" onclick="event.stopPropagation()">
            <div class="checkout-header">
                <h3>üìã Checkout</h3>
                <button class="close-btn" onclick="closeCheckout()">√ó</button>
            </div>
            <div class="checkout-body">
                <form id="checkoutForm" onsubmit="submitOrder(event)">
                    <div class="form-group">
                        <label>Full Name *</label>
                        <input type="text" id="customerName" required placeholder="Juan Dela Cruz">
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Phone Number *</label>
                            <input type="tel" id="customerPhone" required placeholder="09XX XXX XXXX">
                        </div>
                        <div class="form-group">
                            <label>Email (Optional)</label>
                            <input type="email" id="customerEmail" placeholder="email@example.com">
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Delivery Address *</label>
                        <input type="text" id="deliveryAddress" required placeholder="House/Unit No., Street">
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Barangay *</label>
                            <select id="barangay" required>
                                <option value="">Select Barangay</option>
                                <option value="Poblacion">Poblacion</option>
                                <option value="Dagatan">Dagatan</option>
                                <option value="Halang">Halang</option>
                                <option value="Iba">Iba</option>
                                <option value="Kaysuyo">Kaysuyo</option>
                                <option value="Lalaan I">Lalaan I</option>
                                <option value="Lalaan II">Lalaan II</option>
                                <option value="Maymangga">Maymangga</option>
                                <option value="Minantok East">Minantok East</option>
                                <option value="Minantok West">Minantok West</option>
                                <option value="Pangil">Pangil</option>
                                <option value="Salaban">Salaban</option>
                                <option value="Talon">Talon</option>
                                <option value="Tamlong">Tamlong</option>
                                <option value="Banaybanay">Banaybanay</option>
                                <option value="Buho">Buho</option>
                                <option value="Kabigting">Kabigting</option>
                                <option value="Labac">Labac</option>
                                <option value="Luksuhin">Luksuhin</option>
                                <option value="Maitim">Maitim</option>
                                <option value="Mahabang Kahoy">Mahabang Kahoy</option>
                                <option value="Paligawan">Paligawan</option>
                                <option value="San Agustin">San Agustin</option>
                                <option value="Tiambong">Tiambong</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Landmark</label>
                            <input type="text" id="landmark" placeholder="Near...">
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Payment Method *</label>
                        <div class="payment-options">
                            <label class="payment-option selected">
                                <input type="radio" name="paymentMethod" value="COD" checked>
                                <span>üíµ Cash on Delivery (COD)</span>
                            </label>
                            <label class="payment-option">
                                <input type="radio" name="paymentMethod" value="GCash">
                                <span>üì± GCash</span>
                            </label>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Order Notes (Optional)</label>
                        <textarea id="orderNotes" rows="2" placeholder="Special instructions..."></textarea>
                    </div>
                    <div class="order-summary" id="checkoutSummary">
                        <!-- Filled dynamically -->
                    </div>
                    <button type="submit" class="btn-place-order" id="placeOrderBtn">üõí Place Order</button>
                </form>
            </div>
        </div>
    </div>

    <!-- ============================================
         TYG BUSINESS NETWORK
         ============================================ -->
    <section class="business-network">
        <div class="network-title">üîó TYG Business Network</div>
        <div class="network-grid">
            <a href="https://tyg-services.com" target="_blank" class="network-item">
                <div class="network-icon">üîß</div>
                <div class="network-name">TYG Services</div>
                <div class="network-desc">Services & Solutions</div>
            </a>
            <a href="https://luntian.net" target="_blank" class="network-item">
                <div class="network-icon">üè°</div>
                <div class="network-name">Luntian</div>
                <div class="network-desc">Tagaytay Staycation</div>
            </a>
            <a href="https://soleblessing.com" target="_blank" class="network-item">
                <div class="network-icon">üëü</div>
                <div class="network-name">Sole Blessing</div>
                <div class="network-desc">Footwear & Sneakers</div>
            </a>
            <a href="https://www.ast3r.store/" target="_blank" class="network-item">
                <div class="network-icon">üëó</div>
                <div class="network-name">AST3R</div>
                <div class="network-desc">Fashion & Apparel</div>
            </a>
            <a href="https://www.thegoldblessing.com/" target="_blank" class="network-item featured">
                <div class="network-icon">üíé</div>
                <div class="network-name">The Gold Blessing</div>
                <div class="network-desc">Jewelry</div>
                <span class="network-live">‚úì NOW LIVE</span>
            </a>
            <a href="https://musthavecorner.com" target="_blank" class="network-item">
                <div class="network-icon">üõí</div>
                <div class="network-name">Must Have Corner</div>
                <div class="network-desc">Fresh Food Delivery</div>
            </a>
        </div>
    </section>

    <!-- ============================================
         FOOTER
         ============================================ -->
    <footer class="footer">
        <div class="footer-content">
            <div class="footer-grid">
                <div class="footer-section">
                    <h4>üè† Amadeo Marketplace</h4>
                    <p>The official online marketplace for Amadeo, Cavite. Supporting local businesses since 2025.</p>
                </div>
                <div class="footer-section">
                    <h4>Quick Links</h4>
                    <a href="/merchant-register">Become a Merchant</a>
                    <a href="/track">Track Order</a>
                    <a href="/faq">FAQ</a>
                </div>
                <div class="footer-section">
                    <h4>Legal</h4>
                    <a href="/terms">Terms of Service</a>
                    <a href="/privacy">Privacy Policy</a>
                </div>
                <div class="footer-section">
                    <h4>Contact</h4>
                    <p>üìû 0966 960 6060</p>
                    <p>üìß tygfsb@gmail.com</p>
                    <p>üìç Amadeo, Cavite</p>
                </div>
            </div>
            <div class="footer-bottom">
                ¬© 2025 Amadeo Marketplace. Powered by <a href="https://tyg-services.com" style="color: var(--accent-light);">TYG Services</a>
            </div>
        </div>
    </footer>

    <!-- ============================================
         TOAST NOTIFICATION
         ============================================ -->
    <div class="toast" id="toast">
        <span id="toastIcon">‚úì</span>
        <span id="toastMessage">Message</span>
    </div>

    <!-- ============================================
         JAVASCRIPT - PURE ES5 FOR COMPATIBILITY
         ============================================ -->
    <script>
        // ============================================
        // CONFIGURATION
        // ============================================
        var CONFIG = {
            API_URL: 'https://script.google.com/macros/s/AKfycbwgHmmK1j8a6rqx_Zfk5nPGqdUIRSo1oIUNgGoVr2-in988F3K8Kyp8PN15zHS3InIUgw/exec',
            DELIVERY_FEE: 30,
            TIMEOUT: 15000
        };

        // ============================================
        // STATE MANAGEMENT (ES5 - using var)
        // ============================================
        var STATE = {
            merchants: [],
            products: [],
            cart: [],
            currentFilter: 'all',
            currentMerchant: null,
            isLoading: true
        };

        // Load cart from localStorage
        try {
            var savedCart = localStorage.getItem('amadeo_cart');
            if (savedCart) {
                STATE.cart = JSON.parse(savedCart);
            }
        } catch (e) {
            STATE.cart = [];
        }

        // ============================================
        // INITIALIZATION
        // ============================================
        document.addEventListener('DOMContentLoaded', function() {
            initApp();
            setupPaymentOptions();
        });

        function initApp() {
            updateCartUI();
            loadData();
        }

        // ============================================
        // DATA FETCHING (ES5 with timeout)
        // ============================================
        function loadData() {
            STATE.isLoading = true;
            showLoading();

            var timeoutId = setTimeout(function() {
                STATE.isLoading = false;
                showNoMerchants('Connection timed out. Please refresh.');
                updateStats();
            }, CONFIG.TIMEOUT);

            // Fetch merchants
            fetch(CONFIG.API_URL + '?action=getMerchants')
                .then(function(response) {
                    return response.json();
                })
                .then(function(merchantsData) {
                    clearTimeout(timeoutId);
                    
                    console.log('Merchants response:', merchantsData);
                    
                    if (merchantsData.success && merchantsData.data) {
                        STATE.merchants = [];
                        for (var i = 0; i < merchantsData.data.length; i++) {
                            if (merchantsData.data[i].Status === 'Active') {
                                STATE.merchants.push(merchantsData.data[i]);
                            }
                        }
                    } else {
                        STATE.merchants = [];
                    }
                    
                    // Now fetch products
                    return fetch(CONFIG.API_URL + '?action=getAllInventory');
                })
                .then(function(response) {
                    return response.json();
                })
                .then(function(productsData) {
                    console.log('Products response:', productsData);
                    
                    if (productsData.success && productsData.data) {
                        STATE.products = [];
                        for (var j = 0; j < productsData.data.length; j++) {
                            if (productsData.data[j].Status === 'Active') {
                                STATE.products.push(productsData.data[j]);
                            }
                        }
                    } else {
                        STATE.products = [];
                    }
                    
                    updateStats();
                    renderMerchants();
                    STATE.isLoading = false;
                })
                .catch(function(error) {
                    clearTimeout(timeoutId);
                    console.error('Error loading data:', error);
                    STATE.isLoading = false;
                    showNoMerchants('Unable to connect. Please check your internet.');
                    updateStats();
                });
        }

        function showLoading() {
            document.getElementById('merchantsContainer').innerHTML = 
                '<div class="loading">' +
                    '<div class="spinner"></div>' +
                    '<p>Loading verified merchants...</p>' +
                '</div>';
        }

        function showNoMerchants(reason) {
            var message = reason || 'No merchants registered yet.';
            document.getElementById('merchantsContainer').innerHTML = 
                '<div style="text-align: center; grid-column: 1/-1; padding: 60px 20px;">' +
                    '<p style="font-size: 3rem; margin-bottom: 15px;">üè™</p>' +
                    '<h3 style="color: var(--primary-dark); margin-bottom: 10px;">Coming Soon!</h3>' +
                    '<p style="color: var(--text-muted); margin-bottom: 20px;">' + message + '</p>' +
                    '<p style="color: var(--text-muted); font-size: 0.9rem;">Amadeo Marketplace is launching soon with verified local businesses.</p>' +
                    '<a href="/merchant-register" class="btn btn-primary" style="margin-top: 20px; display: inline-block;">üè™ Register Your Business</a>' +
                    '<button class="btn btn-outline" onclick="loadData()" style="margin-top: 10px; margin-left: 10px;">üîÑ Refresh</button>' +
                '</div>';
        }

        function updateStats() {
            document.getElementById('statMerchants').textContent = STATE.merchants.length;
            document.getElementById('statProducts').textContent = STATE.products.length;
        }

        // ============================================
        // MERCHANT RENDERING
        // ============================================
        function renderMerchants() {
            var container = document.getElementById('merchantsContainer');
            
            if (!STATE.merchants || STATE.merchants.length === 0) {
                showNoMerchants('No merchants registered yet.');
                return;
            }
            
            var filtered = STATE.merchants;

            if (STATE.currentFilter !== 'all') {
                filtered = [];
                for (var i = 0; i < STATE.merchants.length; i++) {
                    var m = STATE.merchants[i];
                    if (m.Category === STATE.currentFilter || 
                        (m.Categories && m.Categories.indexOf(STATE.currentFilter) !== -1)) {
                        filtered.push(m);
                    }
                }
            }

            if (filtered.length === 0) {
                container.innerHTML = 
                    '<div style="text-align: center; grid-column: 1/-1; padding: 60px 20px;">' +
                        '<p style="font-size: 3rem; margin-bottom: 15px;">üîç</p>' +
                        '<p style="color: var(--text-muted); font-size: 1.1rem;">No merchants found in this category.</p>' +
                        '<button class="btn btn-outline" onclick="filterCategory(\'all\', document.querySelector(\'.cat-chip\'))" style="margin-top: 15px;">View All Merchants</button>' +
                    '</div>';
                return;
            }

            var html = '';
            for (var j = 0; j < filtered.length; j++) {
                var merchant = filtered[j];
                var productCount = countProductsForMerchant(merchant.MerchantId);
                var isOpen = checkIfOpen(merchant);
                var logo = getImageUrl(merchant.Logo);
                var banner = getImageUrl(merchant.Banner);
                var statusClass = isOpen ? 'open' : 'closed';
                var statusText = isOpen ? '‚óè Open' : '‚óè Closed';
                
                html += '<div class="merchant-card" onclick="openStore(\'' + merchant.MerchantId + '\')">';
                html += '<div class="merchant-banner">';
                if (banner) {
                    html += '<img src="' + banner + '" alt="' + escapeHtml(merchant.BusinessName) + '" onerror="this.style.display=\'none\'">';
                }
                html += '<span class="merchant-status ' + statusClass + '">' + statusText + '</span>';
                html += '</div>';
                html += '<div class="merchant-header">';
                html += '<div class="merchant-logo">';
                if (logo) {
                    html += '<img src="' + logo + '" alt="' + escapeHtml(merchant.BusinessName) + '" onerror="this.textContent=\'üè™\'">';
                } else {
                    html += 'üè™';
                }
                html += '</div>';
                html += '<div class="merchant-info">';
                html += '<h3>' + escapeHtml(merchant.BusinessName) + '</h3>';
                html += '<p>üìç ' + escapeHtml(merchant.Barangay || 'Amadeo, Cavite') + '</p>';
                html += '</div></div>';
                html += '<div class="merchant-body">' + escapeHtml(merchant.Description || 'Verified local business ready to serve you.') + '</div>';
                html += '<div class="merchant-tags">';
                html += '<span class="merchant-tag">' + (merchant.Category || 'General') + '</span>';
                if (merchant.DeliveryAvailable) {
                    html += '<span class="merchant-tag">üöö Delivery</span>';
                }
                html += '</div>';
                html += '<div class="merchant-footer">';
                html += '<div class="merchant-meta">';
                html += '<span>üì¶ ' + productCount + ' items</span>';
                if (merchant.Rating) {
                    html += '<span class="merchant-rating">‚≠ê ' + merchant.Rating + '</span>';
                }
                html += '</div>';
                html += '<button class="btn btn-primary" style="font-size: 0.85rem; padding: 8px 16px;">Visit Store ‚Üí</button>';
                html += '</div></div>';
            }
            container.innerHTML = html;
        }

        function countProductsForMerchant(merchantId) {
            var count = 0;
            for (var i = 0; i < STATE.products.length; i++) {
                if (STATE.products[i].MerchantId === merchantId) {
                    count++;
                }
            }
            return count;
        }

        function checkIfOpen(merchant) {
            if (merchant.IsOpen === false || merchant.IsOpen === 'FALSE') return false;
            if (merchant.IsOpen === true || merchant.IsOpen === 'TRUE') return true;
            var now = new Date();
            var hour = now.getHours();
            return hour >= 8 && hour < 20;
        }

        function getImageUrl(imageId) {
            if (!imageId) return null;
            if (imageId.indexOf('http') === 0) return imageId;
            return 'https://lh3.googleusercontent.com/d/' + imageId;
        }

        function filterCategory(category, btn) {
            STATE.currentFilter = category;
            
            var chips = document.querySelectorAll('.cat-chip');
            for (var i = 0; i < chips.length; i++) {
                chips[i].classList.remove('active');
            }
            if (btn) btn.classList.add('active');
            
            renderMerchants();
        }

        function handleSearch(event) {
            var query = event.target.value.toLowerCase().trim();
            if (!query) {
                renderMerchants();
                return;
            }
            
            var container = document.getElementById('merchantsContainer');
            var filtered = [];
            
            for (var i = 0; i < STATE.merchants.length; i++) {
                var m = STATE.merchants[i];
                var name = (m.BusinessName || '').toLowerCase();
                var desc = (m.Description || '').toLowerCase();
                var cat = (m.Category || '').toLowerCase();
                
                if (name.indexOf(query) !== -1 || desc.indexOf(query) !== -1 || cat.indexOf(query) !== -1) {
                    filtered.push(m);
                }
            }
            
            if (filtered.length === 0) {
                container.innerHTML = 
                    '<div style="text-align: center; grid-column: 1/-1; padding: 60px 20px;">' +
                        '<p style="font-size: 3rem; margin-bottom: 15px;">üîç</p>' +
                        '<p style="color: var(--text-muted);">No results for "' + escapeHtml(query) + '"</p>' +
                    '</div>';
                return;
            }
            
            // Render filtered (simplified)
            STATE.currentFilter = 'all';
            var tempMerchants = STATE.merchants;
            STATE.merchants = filtered;
            renderMerchants();
            STATE.merchants = tempMerchants;
        }

        // ============================================
        // STORE MODAL
        // ============================================
        function openStore(merchantId) {
            var merchant = null;
            for (var i = 0; i < STATE.merchants.length; i++) {
                if (STATE.merchants[i].MerchantId === merchantId) {
                    merchant = STATE.merchants[i];
                    break;
                }
            }
            if (!merchant) return;

            STATE.currentMerchant = merchant;
            var products = [];
            for (var j = 0; j < STATE.products.length; j++) {
                if (STATE.products[j].MerchantId === merchantId) {
                    products.push(STATE.products[j]);
                }
            }

            document.getElementById('storeModalTitle').textContent = merchant.BusinessName;
            document.getElementById('storeModalDesc').textContent = merchant.Description || 'Welcome to our store!';
            document.getElementById('storeModalLocation').textContent = 'üìç ' + (merchant.Barangay || 'Amadeo') + ', Cavite';
            document.getElementById('storeModalPhone').textContent = 'üìû ' + (merchant.Phone || 'Contact via message');

            var grid = document.getElementById('storeProducts');

            if (products.length === 0) {
                grid.innerHTML = 
                    '<div style="grid-column: 1/-1; text-align: center; padding: 40px; color: var(--text-muted);">' +
                        '<p style="font-size: 2rem; margin-bottom: 10px;">üì¶</p>' +
                        '<p>No products listed yet. Check back soon!</p>' +
                    '</div>';
            } else {
                var productsHtml = '';
                for (var k = 0; k < products.length; k++) {
                    var product = products[k];
                    var image = getImageUrl(product.ImageUrl || product.Image);
                    var stock = product.available || product.Stock || product.StockLevel || 0;
                    var stockClass = '';
                    var stockText = stock + ' in stock';
                    
                    if (stock <= 0) {
                        stockClass = 'out';
                        stockText = 'Out of stock';
                    } else if (stock <= 5) {
                        stockClass = 'low';
                        stockText = 'Only ' + stock + ' left!';
                    }

                    productsHtml += '<div class="product-card">';
                    productsHtml += '<div class="product-image">';
                    if (image) {
                        productsHtml += '<img src="' + image + '" alt="' + escapeHtml(product.Name) + '" onerror="this.parentElement.innerHTML=\'üì¶\'">';
                    } else {
                        productsHtml += 'üì¶';
                    }
                    productsHtml += '</div>';
                    productsHtml += '<div class="product-name">' + escapeHtml(product.Name) + '</div>';
                    productsHtml += '<div class="product-unit">' + escapeHtml(product.Unit || 'per piece') + '</div>';
                    productsHtml += '<div class="product-price">‚Ç±' + formatPrice(product.Price) + '</div>';
                    productsHtml += '<div class="product-stock ' + stockClass + '">' + stockText + '</div>';
                    productsHtml += '<button class="btn-add" onclick="addToCart(\'' + product.ProductId + '\')"' + (stock <= 0 ? ' disabled' : '') + '>';
                    productsHtml += stock <= 0 ? 'Out of Stock' : 'Add to Cart';
                    productsHtml += '</button></div>';
                }
                grid.innerHTML = productsHtml;
            }

            document.getElementById('storeModal').classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        function closeStore() {
            document.getElementById('storeModal').classList.remove('active');
            document.body.style.overflow = '';
            STATE.currentMerchant = null;
        }

        function closeStoreModal(event) {
            if (event.target === event.currentTarget) {
                closeStore();
            }
        }

        // ============================================
        // CART FUNCTIONS
        // ============================================
        function addToCart(productId) {
            var product = null;
            for (var i = 0; i < STATE.products.length; i++) {
                if (STATE.products[i].ProductId === productId) {
                    product = STATE.products[i];
                    break;
                }
            }
            if (!product) return;

            var existingIndex = -1;
            for (var j = 0; j < STATE.cart.length; j++) {
                if (STATE.cart[j].ProductId === productId) {
                    existingIndex = j;
                    break;
                }
            }

            if (existingIndex >= 0) {
                STATE.cart[existingIndex].qty++;
            } else {
                var cartItem = {
                    ProductId: product.ProductId,
                    MerchantId: product.MerchantId,
                    Name: product.Name,
                    Price: product.Price,
                    Unit: product.Unit,
                    Image: product.ImageUrl || product.Image,
                    qty: 1
                };
                STATE.cart.push(cartItem);
            }

            saveCart();
            updateCartUI();
            showToast('Added to cart!', 'success');
        }

        function removeFromCart(productId) {
            var newCart = [];
            for (var i = 0; i < STATE.cart.length; i++) {
                if (STATE.cart[i].ProductId !== productId) {
                    newCart.push(STATE.cart[i]);
                }
            }
            STATE.cart = newCart;
            saveCart();
            updateCartUI();
        }

        function updateQty(productId, delta) {
            for (var i = 0; i < STATE.cart.length; i++) {
                if (STATE.cart[i].ProductId === productId) {
                    STATE.cart[i].qty += delta;
                    if (STATE.cart[i].qty <= 0) {
                        removeFromCart(productId);
                        return;
                    }
                    break;
                }
            }
            saveCart();
            updateCartUI();
        }

        function saveCart() {
            try {
                localStorage.setItem('amadeo_cart', JSON.stringify(STATE.cart));
            } catch (e) {
                console.log('Could not save cart');
            }
        }

        function updateCartUI() {
            // Update cart count
            var totalItems = 0;
            for (var i = 0; i < STATE.cart.length; i++) {
                totalItems += STATE.cart[i].qty;
            }
            document.getElementById('cartCount').textContent = totalItems;

            // Update cart total
            var total = 0;
            for (var j = 0; j < STATE.cart.length; j++) {
                total += STATE.cart[j].Price * STATE.cart[j].qty;
            }
            document.getElementById('cartTotal').textContent = '‚Ç±' + formatPrice(total);

            // Update cart items display
            var cartItemsContainer = document.getElementById('cartItems');
            
            if (STATE.cart.length === 0) {
                cartItemsContainer.innerHTML = 
                    '<div class="cart-empty">' +
                        '<p style="font-size: 3rem; margin-bottom: 15px;">üõí</p>' +
                        '<p>Your cart is empty</p>' +
                        '<p style="font-size: 0.85rem;">Add items from our merchants!</p>' +
                    '</div>';
            } else {
                var cartHtml = '';
                for (var k = 0; k < STATE.cart.length; k++) {
                    var item = STATE.cart[k];
                    var itemImage = getImageUrl(item.Image);
                    
                    cartHtml += '<div class="cart-item">';
                    cartHtml += '<div class="cart-item-image">';
                    if (itemImage) {
                        cartHtml += '<img src="' + itemImage + '" style="width:100%;height:100%;object-fit:cover;border-radius:8px;" onerror="this.parentElement.innerHTML=\'üì¶\'">';
                    } else {
                        cartHtml += 'üì¶';
                    }
                    cartHtml += '</div>';
                    cartHtml += '<div class="cart-item-details">';
                    cartHtml += '<div class="cart-item-name">' + escapeHtml(item.Name) + '</div>';
                    cartHtml += '<div class="cart-item-price">‚Ç±' + formatPrice(item.Price) + '</div>';
                    cartHtml += '<div class="cart-item-qty">';
                    cartHtml += '<button class="qty-btn" onclick="updateQty(\'' + item.ProductId + '\', -1)">‚àí</button>';
                    cartHtml += '<span>' + item.qty + '</span>';
                    cartHtml += '<button class="qty-btn" onclick="updateQty(\'' + item.ProductId + '\', 1)">+</button>';
                    cartHtml += '<button class="cart-item-remove" onclick="removeFromCart(\'' + item.ProductId + '\')">üóëÔ∏è</button>';
                    cartHtml += '</div></div>';
                    cartHtml += '<div class="cart-item-subtotal">‚Ç±' + formatPrice(item.Price * item.qty) + '</div>';
                    cartHtml += '</div>';
                }
                cartItemsContainer.innerHTML = cartHtml;
            }
        }

        function toggleCart() {
            var sidebar = document.getElementById('cartSidebar');
            var overlay = document.getElementById('cartOverlay');
            
            sidebar.classList.toggle('open');
            overlay.classList.toggle('active');
            document.body.style.overflow = sidebar.classList.contains('open') ? 'hidden' : '';
        }

        // ============================================
        // CHECKOUT
        // ============================================
        function openCheckout() {
            if (STATE.cart.length === 0) return;

            toggleCart();

            var subtotal = 0;
            for (var i = 0; i < STATE.cart.length; i++) {
                subtotal += STATE.cart[i].Price * STATE.cart[i].qty;
            }
            var delivery = CONFIG.DELIVERY_FEE;
            var total = subtotal + delivery;

            var summaryHtml = '';
            for (var j = 0; j < STATE.cart.length; j++) {
                var item = STATE.cart[j];
                summaryHtml += '<div class="summary-item">';
                summaryHtml += '<span>' + escapeHtml(item.Name) + ' √ó ' + item.qty + '</span>';
                summaryHtml += '<span>‚Ç±' + formatPrice(item.Price * item.qty) + '</span>';
                summaryHtml += '</div>';
            }
            summaryHtml += '<div class="summary-item">';
            summaryHtml += '<span>Delivery Fee</span>';
            summaryHtml += '<span>‚Ç±' + formatPrice(delivery) + '</span>';
            summaryHtml += '</div>';
            summaryHtml += '<div class="summary-item total">';
            summaryHtml += '<span>Total</span>';
            summaryHtml += '<span>‚Ç±' + formatPrice(total) + '</span>';
            summaryHtml += '</div>';

            document.getElementById('checkoutSummary').innerHTML = summaryHtml;

            document.getElementById('checkoutModal').classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        function closeCheckout() {
            document.getElementById('checkoutModal').classList.remove('active');
            document.body.style.overflow = '';
        }

        function closeCheckoutModal(event) {
            if (event.target === event.currentTarget) {
                closeCheckout();
            }
        }

        function setupPaymentOptions() {
            var options = document.querySelectorAll('.payment-option');
            for (var i = 0; i < options.length; i++) {
                options[i].addEventListener('click', function() {
                    var allOptions = document.querySelectorAll('.payment-option');
                    for (var j = 0; j < allOptions.length; j++) {
                        allOptions[j].classList.remove('selected');
                    }
                    this.classList.add('selected');
                    this.querySelector('input').checked = true;
                });
            }
        }

        function submitOrder(event) {
            event.preventDefault();

            var btn = document.getElementById('placeOrderBtn');
            btn.disabled = true;
            btn.innerHTML = '‚è≥ Processing...';

            var orderItems = [];
            var subtotal = 0;
            for (var i = 0; i < STATE.cart.length; i++) {
                var item = STATE.cart[i];
                orderItems.push({
                    productId: item.ProductId,
                    merchantId: item.MerchantId,
                    name: item.Name,
                    quantity: item.qty,
                    price: item.Price
                });
                subtotal += item.Price * item.qty;
            }

            var formData = {
                action: 'createOrder',
                customerName: document.getElementById('customerName').value.trim(),
                customerPhone: document.getElementById('customerPhone').value.trim(),
                customerEmail: document.getElementById('customerEmail').value.trim(),
                deliveryAddress: document.getElementById('deliveryAddress').value.trim(),
                barangay: document.getElementById('barangay').value,
                landmark: document.getElementById('landmark').value.trim(),
                paymentMethod: document.querySelector('input[name="paymentMethod"]:checked').value,
                orderNotes: document.getElementById('orderNotes').value.trim(),
                items: orderItems,
                subtotal: subtotal,
                deliveryFee: CONFIG.DELIVERY_FEE
            };

            fetch(CONFIG.API_URL, {
                method: 'POST',
                headers: { 'Content-Type': 'text/plain' },
                body: JSON.stringify(formData)
            })
            .then(function(response) {
                return response.json();
            })
            .then(function(result) {
                if (result.success) {
                    var orderRef = result.orderId || generateOrderRef();
                    
                    STATE.cart = [];
                    saveCart();
                    updateCartUI();
                    
                    closeCheckout();
                    
                    alert('‚úÖ Order Placed Successfully!\n\nOrder ID: ' + orderRef + '\n\nWe\'ll contact you shortly to confirm your order.\n\nThank you for shopping local!');
                    
                    document.getElementById('checkoutForm').reset();
                    
                } else {
                    throw new Error(result.error || 'Failed to place order');
                }
            })
            .catch(function(error) {
                console.error('Order error:', error);
                showToast('Failed to place order. Please try again.', 'error');
            })
            .finally(function() {
                btn.disabled = false;
                btn.innerHTML = 'üõí Place Order';
            });
        }

        function generateOrderRef() {
            var date = new Date();
            var year = date.getFullYear();
            var month = String(date.getMonth() + 1);
            if (month.length < 2) month = '0' + month;
            var day = String(date.getDate());
            if (day.length < 2) day = '0' + day;
            var dateStr = year + month + day;
            var random = String(Math.floor(Math.random() * 10000));
            while (random.length < 4) random = '0' + random;
            return 'AMV-' + dateStr + '-' + random;
        }

        // ============================================
        // UTILITY FUNCTIONS
        // ============================================
        function formatPrice(price) {
            return parseFloat(price || 0).toLocaleString('en-PH', {
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
            });
        }

        function escapeHtml(text) {
            if (!text) return '';
            var div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function showToast(message, type) {
            type = type || 'success';
            var toast = document.getElementById('toast');
            var icon = document.getElementById('toastIcon');
            var msg = document.getElementById('toastMessage');

            icon.textContent = type === 'success' ? '‚úì' : '‚ö†Ô∏è';
            msg.textContent = message;
            toast.className = 'toast ' + type + ' show';

            setTimeout(function() {
                toast.classList.remove('show');
            }, 3000);
        }

        // ============================================
        // KEYBOARD SHORTCUTS
        // ============================================
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                if (document.getElementById('checkoutModal').classList.contains('active')) {
                    closeCheckout();
                } else if (document.getElementById('storeModal').classList.contains('active')) {
                    closeStore();
                } else if (document.getElementById('cartSidebar').classList.contains('open')) {
                    toggleCart();
                }
            }
        });
    </script>
</body>
</html>
