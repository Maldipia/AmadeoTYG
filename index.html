<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Amadeo Marketplace - Shop Local, Support Local</title>
    <meta name="description" content="Shop from verified local businesses in Amadeo, Cavite. Fresh products, local services, delivered to your doorstep.">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #0f766e;
            --primary-dark: #134e4a;
            --primary-light: #14b8a6;
            --accent: #f59e0b;
            --success: #10b981;
            --danger: #ef4444;
            --warning: #f59e0b;
            --bg: #f0fdfa;
            --card: #ffffff;
            --text: #1e293b;
            --text-muted: #64748b;
            --border: #e2e8f0;
            --shadow: 0 4px 20px rgba(15, 118, 110, 0.1);
            --shadow-lg: 0 10px 40px rgba(15, 118, 110, 0.15);
            --radius: 16px;
            --radius-sm: 10px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Plus Jakarta Sans', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg);
            color: var(--text);
            line-height: 1.6;
            min-height: 100vh;
        }

        /* Header */
        .header {
            background: linear-gradient(135deg, var(--primary-dark), var(--primary));
            color: white;
            padding: 1rem;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: var(--shadow);
        }

        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 1rem;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 1.25rem;
            font-weight: 800;
            text-decoration: none;
            color: white;
        }

        .logo-icon {
            font-size: 1.5rem;
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .cart-btn {
            background: rgba(255,255,255,0.15);
            border: 2px solid rgba(255,255,255,0.3);
            color: white;
            padding: 0.6rem 1rem;
            border-radius: 50px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            transition: all 0.3s ease;
            font-family: inherit;
        }

        .cart-btn:hover {
            background: rgba(255,255,255,0.25);
            transform: translateY(-2px);
        }

        .cart-count {
            background: var(--accent);
            color: var(--primary-dark);
            padding: 0.15rem 0.5rem;
            border-radius: 50px;
            font-size: 0.75rem;
            font-weight: 700;
            min-width: 20px;
            text-align: center;
        }

        /* Hero */
        .hero {
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
            color: white;
            padding: 2.5rem 1rem;
            text-align: center;
        }

        .hero h1 {
            font-size: clamp(1.5rem, 5vw, 2.5rem);
            font-weight: 800;
            margin-bottom: 0.5rem;
        }

        .hero p {
            opacity: 0.9;
            font-size: 1rem;
            max-width: 500px;
            margin: 0 auto;
        }

        /* Search */
        .search-section {
            max-width: 600px;
            margin: -1.5rem auto 1.5rem;
            padding: 0 1rem;
            position: relative;
            z-index: 10;
        }

        .search-box {
            display: flex;
            background: white;
            border-radius: 50px;
            box-shadow: var(--shadow-lg);
            overflow: hidden;
            border: 2px solid transparent;
            transition: border-color 0.3s;
        }

        .search-box:focus-within {
            border-color: var(--primary-light);
        }

        .search-box input {
            flex: 1;
            padding: 1rem 1.5rem;
            border: none;
            font-size: 1rem;
            font-family: inherit;
            outline: none;
        }

        .search-box button {
            background: var(--primary);
            color: white;
            border: none;
            padding: 1rem 1.5rem;
            cursor: pointer;
            font-size: 1.1rem;
            transition: background 0.3s;
        }

        .search-box button:hover {
            background: var(--primary-dark);
        }

        /* Categories */
        .categories {
            display: flex;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            overflow-x: auto;
            max-width: 1200px;
            margin: 0 auto 1rem;
            scrollbar-width: none;
        }

        .categories::-webkit-scrollbar {
            display: none;
        }

        .category-btn {
            background: white;
            border: 2px solid var(--border);
            padding: 0.6rem 1.2rem;
            border-radius: 50px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.85rem;
            white-space: nowrap;
            transition: all 0.3s;
            font-family: inherit;
        }

        .category-btn:hover,
        .category-btn.active {
            background: var(--primary);
            border-color: var(--primary);
            color: white;
            transform: translateY(-2px);
        }

        /* Main Content */
        .main {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 1rem 2rem;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .section-title {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--primary-dark);
        }

        .product-count {
            color: var(--text-muted);
            font-size: 0.9rem;
        }

        /* Products Grid */
        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
            gap: 1rem;
        }

        @media (min-width: 640px) {
            .products-grid {
                grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            }
        }

        .product-card {
            background: white;
            border-radius: var(--radius);
            overflow: hidden;
            box-shadow: var(--shadow);
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
        }

        .product-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
        }

        .product-image {
            width: 100%;
            aspect-ratio: 1;
            object-fit: cover;
            background: linear-gradient(135deg, #f0fdfa, #ccfbf1);
        }

        .product-info {
            padding: 1rem;
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .product-name {
            font-weight: 700;
            font-size: 0.95rem;
            margin-bottom: 0.25rem;
            color: var(--text);
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .product-merchant {
            font-size: 0.8rem;
            color: var(--text-muted);
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }

        .fulfillment-badges {
            display: flex;
            gap: 0.35rem;
            margin-bottom: 0.5rem;
            flex-wrap: wrap;
        }

        .badge {
            font-size: 0.65rem;
            padding: 0.2rem 0.5rem;
            border-radius: 50px;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 0.2rem;
        }

        .badge-pickup {
            background: #dcfce7;
            color: #166534;
        }

        .badge-delivery {
            background: #dbeafe;
            color: #1e40af;
        }

        .product-price {
            font-size: 1.1rem;
            font-weight: 800;
            color: var(--primary);
            margin-top: auto;
        }

        .product-stock {
            font-size: 0.75rem;
            margin-top: 0.25rem;
        }

        .stock-in {
            color: var(--success);
        }

        .stock-low {
            color: var(--warning);
        }

        .stock-out {
            color: var(--danger);
        }

        .add-btn {
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
            color: white;
            border: none;
            padding: 0.75rem;
            border-radius: var(--radius-sm);
            cursor: pointer;
            font-weight: 700;
            font-size: 0.85rem;
            margin-top: 0.75rem;
            transition: all 0.3s;
            font-family: inherit;
        }

        .add-btn:hover:not(:disabled) {
            transform: scale(1.02);
            box-shadow: 0 4px 15px rgba(15, 118, 110, 0.3);
        }

        .add-btn:disabled {
            background: #cbd5e1;
            cursor: not-allowed;
        }

        /* Loading & States */
        .loading-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 4rem 2rem;
            text-align: center;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 4px solid var(--border);
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .loading-text {
            margin-top: 1rem;
            color: var(--text-muted);
            font-weight: 500;
        }

        .empty-state {
            text-align: center;
            padding: 4rem 2rem;
        }

        .empty-icon {
            font-size: 4rem;
            margin-bottom: 1rem;
        }

        .empty-title {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--text);
            margin-bottom: 0.5rem;
        }

        .empty-text {
            color: var(--text-muted);
        }

        .error-state {
            background: #fef2f2;
            border: 2px solid #fecaca;
            border-radius: var(--radius);
            padding: 2rem;
            text-align: center;
            margin: 2rem 0;
        }

        .error-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
        }

        .error-title {
            color: var(--danger);
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .retry-btn {
            background: var(--danger);
            color: white;
            border: none;
            padding: 0.75rem 2rem;
            border-radius: 50px;
            cursor: pointer;
            font-weight: 600;
            margin-top: 1rem;
            font-family: inherit;
            transition: all 0.3s;
        }

        .retry-btn:hover {
            background: #dc2626;
            transform: translateY(-2px);
        }

        /* Cart Sidebar */
        .cart-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.5);
            z-index: 200;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s;
        }

        .cart-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .cart-sidebar {
            position: fixed;
            top: 0;
            right: -100%;
            width: 100%;
            max-width: 420px;
            height: 100%;
            background: white;
            z-index: 201;
            transition: right 0.3s ease;
            display: flex;
            flex-direction: column;
        }

        .cart-sidebar.active {
            right: 0;
        }

        .cart-header {
            background: linear-gradient(135deg, var(--primary-dark), var(--primary));
            color: white;
            padding: 1.25rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .cart-header h2 {
            font-size: 1.1rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .close-cart {
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.25rem;
            transition: all 0.3s;
        }

        .close-cart:hover {
            background: rgba(255,255,255,0.3);
            transform: rotate(90deg);
        }

        .cart-items {
            flex: 1;
            overflow-y: auto;
            padding: 1rem;
        }

        .cart-item {
            display: flex;
            gap: 1rem;
            padding: 1rem;
            background: var(--bg);
            border-radius: var(--radius-sm);
            margin-bottom: 0.75rem;
        }

        .cart-item-image {
            width: 70px;
            height: 70px;
            border-radius: 8px;
            object-fit: cover;
            background: white;
        }

        .cart-item-info {
            flex: 1;
        }

        .cart-item-name {
            font-weight: 600;
            font-size: 0.9rem;
            margin-bottom: 0.25rem;
        }

        .cart-item-price {
            color: var(--primary);
            font-weight: 700;
            font-size: 0.95rem;
        }

        .cart-item-qty {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-top: 0.5rem;
        }

        .qty-btn {
            width: 28px;
            height: 28px;
            border: 2px solid var(--border);
            background: white;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 700;
            font-size: 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
            font-family: inherit;
        }

        .qty-btn:hover {
            border-color: var(--primary);
            color: var(--primary);
        }

        .qty-value {
            font-weight: 700;
            min-width: 24px;
            text-align: center;
        }

        .remove-item {
            color: var(--danger);
            background: none;
            border: none;
            cursor: pointer;
            font-size: 1.1rem;
            padding: 0.25rem;
            transition: transform 0.2s;
        }

        .remove-item:hover {
            transform: scale(1.2);
        }

        .cart-empty {
            text-align: center;
            padding: 3rem 1rem;
            color: var(--text-muted);
        }

        .cart-empty-icon {
            font-size: 4rem;
            margin-bottom: 1rem;
            opacity: 0.5;
        }

        .cart-footer {
            border-top: 2px solid var(--border);
            padding: 1rem;
            background: white;
        }

        .cart-summary {
            margin-bottom: 1rem;
        }

        .summary-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.5rem;
            font-size: 0.95rem;
        }

        .summary-row.total {
            font-size: 1.2rem;
            font-weight: 800;
            color: var(--primary-dark);
            padding-top: 0.75rem;
            border-top: 2px dashed var(--border);
            margin-top: 0.75rem;
        }

        .checkout-btn {
            width: 100%;
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
            color: white;
            border: none;
            padding: 1rem;
            border-radius: var(--radius-sm);
            cursor: pointer;
            font-weight: 700;
            font-size: 1rem;
            font-family: inherit;
            transition: all 0.3s;
        }

        .checkout-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(15, 118, 110, 0.3);
        }

        .checkout-btn:disabled {
            background: #cbd5e1;
            cursor: not-allowed;
        }

        /* Modal */
        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.6);
            z-index: 300;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 1rem;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s;
        }

        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .modal {
            background: white;
            border-radius: var(--radius);
            width: 100%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            transform: scale(0.9);
            transition: transform 0.3s;
        }

        .modal-overlay.active .modal {
            transform: scale(1);
        }

        .modal-header {
            background: linear-gradient(135deg, var(--primary-dark), var(--primary));
            color: white;
            padding: 1.25rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
        }

        .modal-header h2 {
            font-size: 1.1rem;
            font-weight: 700;
        }

        .close-modal {
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.1rem;
            transition: all 0.3s;
        }

        .close-modal:hover {
            background: rgba(255,255,255,0.3);
        }

        .modal-body {
            padding: 1.25rem;
        }

        .form-group {
            margin-bottom: 1rem;
        }

        .form-label {
            display: block;
            font-weight: 600;
            font-size: 0.85rem;
            margin-bottom: 0.4rem;
            color: var(--text);
        }

        .form-input {
            width: 100%;
            padding: 0.75rem 1rem;
            border: 2px solid var(--border);
            border-radius: var(--radius-sm);
            font-size: 0.95rem;
            font-family: inherit;
            transition: border-color 0.3s;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--primary);
        }

        .form-input::placeholder {
            color: #94a3b8;
        }

        textarea.form-input {
            min-height: 80px;
            resize: vertical;
        }

        /* Payment Methods */
        .payment-section {
            margin-top: 1.5rem;
        }

        .payment-title {
            font-weight: 700;
            font-size: 0.95rem;
            margin-bottom: 0.75rem;
            color: var(--primary-dark);
        }

        .payment-methods {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 0.5rem;
        }

        .payment-option {
            position: relative;
        }

        .payment-option input {
            position: absolute;
            opacity: 0;
            pointer-events: none;
        }

        .payment-option label {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 0.75rem 0.5rem;
            border: 2px solid var(--border);
            border-radius: var(--radius-sm);
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.75rem;
            font-weight: 600;
            text-align: center;
        }

        .payment-option input:checked + label {
            border-color: var(--primary);
            background: var(--bg);
        }

        .payment-icon {
            font-size: 1.5rem;
            margin-bottom: 0.25rem;
        }

        /* QR Code Display */
        .qr-section {
            display: none;
            margin-top: 1rem;
            padding: 1rem;
            background: linear-gradient(135deg, #f0fdf4, #dcfce7);
            border-radius: var(--radius-sm);
            text-align: center;
        }

        .qr-section.active {
            display: block;
        }

        .qr-title {
            font-weight: 700;
            color: var(--primary-dark);
            margin-bottom: 0.75rem;
            font-size: 0.95rem;
        }

        .qr-code {
            width: 180px;
            height: 180px;
            margin: 0 auto 0.75rem;
            background: white;
            border-radius: 12px;
            padding: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .qr-code img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

        .qr-placeholder {
            color: var(--text-muted);
            font-size: 0.85rem;
        }

        .qr-details {
            font-size: 0.85rem;
            color: var(--text-muted);
            margin-bottom: 1rem;
        }

        .qr-details strong {
            color: var(--text);
        }

        /* Screenshot Upload */
        .upload-section {
            display: none;
            margin-top: 1rem;
        }

        .upload-section.active {
            display: block;
        }

        .upload-area {
            border: 2px dashed var(--primary);
            border-radius: var(--radius-sm);
            padding: 1.5rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            background: var(--bg);
        }

        .upload-area:hover {
            background: #ccfbf1;
        }

        .upload-area.has-file {
            border-style: solid;
            background: #d1fae5;
        }

        .upload-icon {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
        }

        .upload-text {
            font-weight: 600;
            color: var(--primary-dark);
        }

        .upload-hint {
            font-size: 0.8rem;
            color: var(--text-muted);
            margin-top: 0.25rem;
        }

        .upload-preview {
            max-width: 200px;
            max-height: 150px;
            margin: 0.5rem auto 0;
            border-radius: 8px;
            display: none;
        }

        .upload-preview.active {
            display: block;
        }

        /* Order Summary in Modal */
        .order-summary {
            background: var(--bg);
            border-radius: var(--radius-sm);
            padding: 1rem;
            margin-top: 1rem;
        }

        .order-summary h4 {
            font-size: 0.9rem;
            color: var(--primary-dark);
            margin-bottom: 0.75rem;
        }

        .order-item {
            display: flex;
            justify-content: space-between;
            font-size: 0.85rem;
            padding: 0.35rem 0;
        }

        .order-item span:first-child {
            color: var(--text-muted);
        }

        .order-total {
            display: flex;
            justify-content: space-between;
            font-weight: 700;
            font-size: 1.1rem;
            color: var(--primary-dark);
            padding-top: 0.75rem;
            margin-top: 0.5rem;
            border-top: 2px dashed var(--border);
        }

        /* Submit Button */
        .submit-order {
            width: 100%;
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
            color: white;
            border: none;
            padding: 1rem;
            border-radius: var(--radius-sm);
            cursor: pointer;
            font-weight: 700;
            font-size: 1rem;
            font-family: inherit;
            margin-top: 1.25rem;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .submit-order:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(15, 118, 110, 0.3);
        }

        .submit-order:disabled {
            background: #cbd5e1;
            cursor: not-allowed;
        }

        .submit-order .spinner-small {
            width: 20px;
            height: 20px;
            border: 2px solid rgba(255,255,255,0.3);
            border-top-color: white;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        /* Success Modal */
        .success-content {
            text-align: center;
            padding: 2rem;
        }

        .success-icon {
            font-size: 4rem;
            margin-bottom: 1rem;
        }

        .success-title {
            font-size: 1.5rem;
            font-weight: 800;
            color: var(--primary-dark);
            margin-bottom: 0.5rem;
        }

        .success-order-id {
            background: var(--bg);
            padding: 1rem;
            border-radius: var(--radius-sm);
            margin: 1rem 0;
            font-family: monospace;
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--primary);
            letter-spacing: 1px;
        }

        .success-message {
            color: var(--text-muted);
            margin-bottom: 1.5rem;
            line-height: 1.6;
        }

        .success-btn {
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
            color: white;
            border: none;
            padding: 1rem 2rem;
            border-radius: 50px;
            cursor: pointer;
            font-weight: 700;
            font-size: 1rem;
            font-family: inherit;
            transition: all 0.3s;
        }

        .success-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(15, 118, 110, 0.3);
        }

        /* Footer */
        .footer {
            background: var(--primary-dark);
            color: white;
            padding: 2rem 1rem;
            text-align: center;
            margin-top: 3rem;
        }

        .footer-logo {
            font-size: 1.25rem;
            font-weight: 800;
            margin-bottom: 0.5rem;
        }

        .footer-tagline {
            opacity: 0.8;
            font-size: 0.9rem;
            margin-bottom: 1rem;
        }

        .footer-contact {
            font-size: 0.85rem;
            opacity: 0.7;
        }

        .footer-contact a {
            color: var(--primary-light);
            text-decoration: none;
        }

        /* Toast Notifications */
        .toast-container {
            position: fixed;
            bottom: 1rem;
            right: 1rem;
            z-index: 400;
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .toast {
            background: var(--primary-dark);
            color: white;
            padding: 1rem 1.25rem;
            border-radius: var(--radius-sm);
            box-shadow: var(--shadow-lg);
            display: flex;
            align-items: center;
            gap: 0.75rem;
            animation: slideIn 0.3s ease;
            max-width: 320px;
        }

        .toast.success {
            background: var(--success);
        }

        .toast.error {
            background: var(--danger);
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(100%);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        /* Responsive */
        @media (max-width: 480px) {
            .payment-methods {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .header-content {
                flex-wrap: wrap;
            }
            
            .logo {
                font-size: 1.1rem;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <a href="/" class="logo">
                <span class="logo-icon">üè™</span>
                <span>Amadeo Marketplace</span>
            </a>
            <div class="header-actions">
                <button class="cart-btn" onclick="openCart()">
                    üõí Cart
                    <span class="cart-count" id="cartCount">0</span>
                </button>
            </div>
        </div>
    </header>

    <!-- Hero -->
    <section class="hero">
        <h1>Shop Local, Support Local üè°</h1>
        <p>Fresh products from verified Amadeo businesses, delivered to your doorstep</p>
    </section>

    <!-- Search -->
    <div class="search-section">
        <div class="search-box">
            <input type="text" id="searchInput" placeholder="Search products..." onkeyup="handleSearch(event)">
            <button onclick="searchProducts()">üîç</button>
        </div>
    </div>

    <!-- Categories -->
    <div class="categories" id="categoriesContainer">
        <button class="category-btn active" data-category="all" onclick="filterCategory('all', this)">üõí All</button>
        <button class="category-btn" data-category="Food" onclick="filterCategory('Food', this)">üç± Food</button>
        <button class="category-btn" data-category="Beverages" onclick="filterCategory('Beverages', this)">ü•§ Beverages</button>
        <button class="category-btn" data-category="Fresh Produce" onclick="filterCategory('Fresh Produce', this)">ü•¨ Fresh</button>
        <button class="category-btn" data-category="Grocery" onclick="filterCategory('Grocery', this)">üõçÔ∏è Grocery</button>
        <button class="category-btn" data-category="Coffee" onclick="filterCategory('Coffee', this)">‚òï Coffee</button>
    </div>

    <!-- Main Content -->
    <main class="main">
        <div class="section-header">
            <h2 class="section-title">Available Products</h2>
            <span class="product-count" id="productCount">Loading...</span>
        </div>
        
        <div id="productsContainer">
            <div class="loading-container">
                <div class="spinner"></div>
                <p class="loading-text">Loading products from Amadeo merchants...</p>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="footer-logo">üè™ Amadeo Marketplace</div>
        <p class="footer-tagline">Supporting local businesses in Amadeo, Cavite</p>
        <p class="footer-contact">
            üìû <a href="tel:09669606060">0966 960 6060</a> | 
            Powered by <a href="https://tyg-services.com" target="_blank">TYG Services</a>
        </p>
    </footer>

    <!-- Cart Sidebar -->
    <div class="cart-overlay" id="cartOverlay" onclick="closeCart()"></div>
    <aside class="cart-sidebar" id="cartSidebar">
        <div class="cart-header">
            <h2>üõí Your Cart</h2>
            <button class="close-cart" onclick="closeCart()">‚úï</button>
        </div>
        <div class="cart-items" id="cartItems">
            <div class="cart-empty">
                <div class="cart-empty-icon">üõí</div>
                <p>Your cart is empty</p>
                <p style="font-size: 0.85rem; margin-top: 0.5rem;">Add some products to get started!</p>
            </div>
        </div>
        <div class="cart-footer">
            <div class="cart-summary">
                <div class="summary-row">
                    <span>Subtotal</span>
                    <span id="cartSubtotal">‚Ç±0.00</span>
                </div>
                <div class="summary-row">
                    <span>Delivery Fee</span>
                    <span id="cartDelivery">‚Ç±0.00</span>
                </div>
                <div class="summary-row total">
                    <span>Total</span>
                    <span id="cartTotal">‚Ç±0.00</span>
                </div>
            </div>
            <button class="checkout-btn" id="checkoutBtn" onclick="openCheckout()" disabled>
                Proceed to Checkout
            </button>
        </div>
    </aside>

    <!-- Checkout Modal -->
    <div class="modal-overlay" id="checkoutModal">
        <div class="modal">
            <div class="modal-header">
                <h2>üì¶ Checkout</h2>
                <button class="close-modal" onclick="closeCheckout()">‚úï</button>
            </div>
            <div class="modal-body">
                <form id="checkoutForm" onsubmit="submitOrder(event)">
                    <div class="form-group">
                        <label class="form-label">Full Name *</label>
                        <input type="text" class="form-input" id="customerName" placeholder="Juan Dela Cruz" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Phone Number *</label>
                        <input type="tel" class="form-input" id="customerPhone" placeholder="09171234567" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Email (optional)</label>
                        <input type="email" class="form-input" id="customerEmail" placeholder="juan@email.com">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Delivery Address *</label>
                        <input type="text" class="form-input" id="customerAddress" placeholder="House #, Street, Purok" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Barangay *</label>
                        <select class="form-input" id="customerBarangay" required>
                            <option value="">Select Barangay</option>
                            <option value="Poblacion">Poblacion</option>
                            <option value="Buho">Buho</option>
                            <option value="Halang">Halang</option>
                            <option value="Banay-Banay">Banay-Banay</option>
                            <option value="Dagatan">Dagatan</option>
                            <option value="Lalaan I">Lalaan I</option>
                            <option value="Lalaan II">Lalaan II</option>
                            <option value="Maymangga">Maymangga</option>
                            <option value="Pangil">Pangil</option>
                            <option value="Salaban">Salaban</option>
                            <option value="Talon">Talon</option>
                            <option value="Lucsuhin">Lucsuhin</option>
                            <option value="Amaya">Amaya</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Special Instructions</label>
                        <textarea class="form-input" id="specialInstructions" placeholder="Landmark, delivery notes, etc."></textarea>
                    </div>
                    
                    <!-- Payment Section -->
                    <div class="payment-section">
                        <div class="payment-title">üí≥ Payment Method</div>
                        <div class="payment-methods">
                            <div class="payment-option">
                                <input type="radio" name="paymentMethod" id="payCOD" value="COD" checked onchange="handlePaymentChange()">
                                <label for="payCOD">
                                    <span class="payment-icon">üíµ</span>
                                    COD
                                </label>
                            </div>
                            <div class="payment-option">
                                <input type="radio" name="paymentMethod" id="payGCash" value="GCash" onchange="handlePaymentChange()">
                                <label for="payGCash">
                                    <span class="payment-icon">üì±</span>
                                    GCash
                                </label>
                            </div>
                            <div class="payment-option">
                                <input type="radio" name="paymentMethod" id="payMaya" value="Maya" onchange="handlePaymentChange()">
                                <label for="payMaya">
                                    <span class="payment-icon">üíö</span>
                                    Maya
                                </label>
                            </div>
                            <div class="payment-option">
                                <input type="radio" name="paymentMethod" id="payBDO" value="BDO" onchange="handlePaymentChange()">
                                <label for="payBDO">
                                    <span class="payment-icon">üè¶</span>
                                    BDO
                                </label>
                            </div>
                            <div class="payment-option">
                                <input type="radio" name="paymentMethod" id="payBPI" value="BPI" onchange="handlePaymentChange()">
                                <label for="payBPI">
                                    <span class="payment-icon">üèõÔ∏è</span>
                                    BPI
                                </label>
                            </div>
                            <div class="payment-option">
                                <input type="radio" name="paymentMethod" id="payUnionBank" value="UnionBank" onchange="handlePaymentChange()">
                                <label for="payUnionBank">
                                    <span class="payment-icon">üîµ</span>
                                    UnionBank
                                </label>
                            </div>
                        </div>
                    </div>
                    
                    <!-- QR Code Section -->
                    <div class="qr-section" id="qrSection">
                        <div class="qr-title" id="qrTitle">Scan to Pay via GCash</div>
                        <div class="qr-code">
                            <img id="qrImage" src="" alt="Payment QR Code" onerror="this.style.display='none'; this.parentElement.querySelector('.qr-placeholder').style.display='block';">
                            <div class="qr-placeholder" style="display: none;">QR Code</div>
                        </div>
                        <div class="qr-details">
                            <p><strong id="qrAccountName">TYG Services</strong></p>
                            <p id="qrAccountNumber">0966 960 6060</p>
                        </div>
                    </div>
                    
                    <!-- Screenshot Upload -->
                    <div class="upload-section" id="uploadSection">
                        <label class="form-label">üì∏ Upload Payment Screenshot *</label>
                        <div class="upload-area" id="uploadArea" onclick="document.getElementById('paymentScreenshot').click()">
                            <div class="upload-icon">üì§</div>
                            <div class="upload-text">Click to upload screenshot</div>
                            <div class="upload-hint">PNG, JPG up to 5MB</div>
                            <img class="upload-preview" id="uploadPreview" alt="Preview">
                        </div>
                        <input type="file" id="paymentScreenshot" accept="image/*" style="display: none" onchange="handleScreenshotUpload(event)">
                    </div>
                    
                    <!-- Order Summary -->
                    <div class="order-summary">
                        <h4>üìã Order Summary</h4>
                        <div id="orderSummaryItems"></div>
                        <div class="order-total">
                            <span>Total</span>
                            <span id="orderTotal">‚Ç±0.00</span>
                        </div>
                    </div>
                    
                    <button type="submit" class="submit-order" id="submitBtn">
                        <span id="submitText">Place Order</span>
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- Success Modal -->
    <div class="modal-overlay" id="successModal">
        <div class="modal">
            <div class="success-content">
                <div class="success-icon">‚úÖ</div>
                <h2 class="success-title">Order Placed!</h2>
                <div class="success-order-id" id="successOrderId">AMV-XXXXXXXX-XXXX</div>
                <p class="success-message">
                    Salamat po! Your order has been received.<br>
                    The merchant will contact you shortly to confirm.
                </p>
                <button class="success-btn" onclick="closeSuccessAndReset()">Continue Shopping</button>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <script>
        // ========================================
        // CONFIGURATION
        // ========================================
        const API_BASE = 'https://script.google.com/macros/s/AKfycbwgHmmK1j8a6rqx_Zfk5nPGqdUIRSo1oIUNgGoVr2-in988F3K8Kyp8PN15zHS3InIUgw/exec';
        
        // Payment QR codes - Update these with actual QR image URLs from your Google Drive
        const PAYMENT_QR = {
            GCash: '',
            Maya: '',
            BDO: '',
            BPI: '',
            UnionBank: ''
        };
        
        const PAYMENT_DETAILS = {
            GCash: { name: 'TYG Services', number: '0966 960 6060' },
            Maya: { name: 'TYG Services', number: '0966 960 6060' },
            BDO: { name: 'TYG Services', number: '1234-5678-9012' },
            BPI: { name: 'TYG Services', number: '9876-5432-1098' },
            UnionBank: { name: 'TYG Services', number: '1122-3344-5566' }
        };

        // ========================================
        // STATE
        // ========================================
        let allProducts = [];
        let filteredProducts = [];
        let cart = [];
        let currentCategory = 'all';
        let searchQuery = '';
        let paymentScreenshotData = null;

        // ========================================
        // INITIALIZATION
        // ========================================
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ Amadeo Marketplace initializing...');
            loadCart();
            loadProducts();
        });

        // ========================================
        // API FUNCTIONS
        // ========================================
        async function loadProducts() {
            const container = document.getElementById('productsContainer');
            
            try {
                showLoading(container);
                console.log('üì° Fetching products from API...');
                
                const response = await fetch(API_BASE + '?action=getProducts&limit=200', {
                    method: 'GET',
                    headers: {
                        'Accept': 'application/json'
                    }
                });
                
                console.log('üì• Response status:', response.status);
                
                if (!response.ok) {
                    throw new Error('HTTP error! status: ' + response.status);
                }
                
                const text = await response.text();
                console.log('üìÑ Response text length:', text.length);
                
                let result;
                try {
                    result = JSON.parse(text);
                } catch (parseError) {
                    console.error('JSON parse error:', parseError);
                    throw new Error('Invalid JSON response from server');
                }
                
                console.log('‚úÖ Parsed result:', result);
                
                if (result.success && result.data && Array.isArray(result.data)) {
                    allProducts = result.data;
                    filteredProducts = [...allProducts];
                    console.log('üéâ Loaded ' + allProducts.length + ' products');
                    renderProducts();
                    updateProductCount();
                } else if (result.success && !result.data) {
                    allProducts = [];
                    filteredProducts = [];
                    renderProducts();
                    updateProductCount();
                } else {
                    throw new Error(result.error || 'Failed to load products');
                }
            } catch (error) {
                console.error('‚ùå Error loading products:', error);
                showError(container, error.message);
            }
        }

        // ========================================
        // RENDERING FUNCTIONS
        // ========================================
        function renderProducts() {
            const container = document.getElementById('productsContainer');
            
            if (!filteredProducts || filteredProducts.length === 0) {
                showEmpty(container);
                return;
            }
            
            let html = '<div class="products-grid">';
            
            for (let i = 0; i < filteredProducts.length; i++) {
                html += renderProductCard(filteredProducts[i]);
            }
            
            html += '</div>';
            container.innerHTML = html;
        }

        function renderProductCard(product) {
            if (!product) return '';
            
            const imageUrl = getImageUrl(product.ImageUrl);
            const available = product.available || (product.inventory ? product.inventory.quantity : 0) || 0;
            const stockStatus = getStockStatusInfo(available);
            const isInStock = available > 0;
            
            // Fulfillment badges
            const offersPickup = product.OffersPickup !== 'No';
            const offersDelivery = product.OffersDelivery === 'Yes';
            
            // Safe product data for onclick
            const safeProduct = {
                ProductId: product.ProductId || '',
                MerchantId: product.MerchantId || '',
                Name: product.Name || 'Product',
                Price: product.Price || 0,
                ImageUrl: product.ImageUrl || '',
                Category: product.Category || '',
                available: available
            };
            
            const productJson = encodeURIComponent(JSON.stringify(safeProduct));
            
            return '<div class="product-card">' +
                '<img src="' + imageUrl + '" alt="' + escapeHtml(product.Name) + '" class="product-image" onerror="this.onerror=null; this.src=\'data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><rect fill=%22%23f0fdfa%22 width=%22100%22 height=%22100%22/><text x=%2250%22 y=%2255%22 text-anchor=%22middle%22 font-size=%2240%22>üõí</text></svg>\'">' +
                '<div class="product-info">' +
                    '<div class="product-name">' + escapeHtml(product.Name) + '</div>' +
                    '<div class="product-merchant">üè™ ' + escapeHtml(product.merchantName || 'Local Merchant') + '</div>' +
                    '<div class="fulfillment-badges">' +
                        (offersPickup ? '<span class="badge badge-pickup">üìç Pickup</span>' : '') +
                        (offersDelivery ? '<span class="badge badge-delivery">üöö Delivery</span>' : '') +
                    '</div>' +
                    '<div class="product-price">‚Ç±' + formatPrice(product.Price) + '</div>' +
                    '<div class="product-stock ' + stockStatus.class + '">' + stockStatus.text + '</div>' +
                    '<button class="add-btn" onclick="addToCartFromJson(\'' + productJson + '\')" ' + (isInStock ? '' : 'disabled') + '>' +
                        (isInStock ? 'üõí Add to Cart' : 'Out of Stock') +
                    '</button>' +
                '</div>' +
            '</div>';
        }

        function showLoading(container) {
            container.innerHTML = '<div class="loading-container">' +
                '<div class="spinner"></div>' +
                '<p class="loading-text">Loading products from Amadeo merchants...</p>' +
            '</div>';
        }

        function showError(container, message) {
            container.innerHTML = '<div class="error-state">' +
                '<div class="error-icon">üòï</div>' +
                '<div class="error-title">Oops! Something went wrong</div>' +
                '<p>' + escapeHtml(message) + '</p>' +
                '<button class="retry-btn" onclick="loadProducts()">üîÑ Try Again</button>' +
            '</div>';
        }

        function showEmpty(container) {
            container.innerHTML = '<div class="empty-state">' +
                '<div class="empty-icon">üîç</div>' +
                '<div class="empty-title">No products found</div>' +
                '<p class="empty-text">Try a different search or category</p>' +
            '</div>';
        }

        // ========================================
        // FILTER & SEARCH
        // ========================================
        function filterCategory(category, btn) {
            currentCategory = category;
            
            // Update active button
            var buttons = document.querySelectorAll('.category-btn');
            for (var i = 0; i < buttons.length; i++) {
                buttons[i].classList.remove('active');
            }
            if (btn) btn.classList.add('active');
            
            applyFilters();
        }

        function handleSearch(event) {
            if (event.key === 'Enter') {
                searchProducts();
            }
        }

        function searchProducts() {
            searchQuery = document.getElementById('searchInput').value.trim().toLowerCase();
            applyFilters();
        }

        function applyFilters() {
            filteredProducts = [];
            
            for (var i = 0; i < allProducts.length; i++) {
                var product = allProducts[i];
                
                var matchesCategory = currentCategory === 'all' || 
                    (product.Category && product.Category.toLowerCase() === currentCategory.toLowerCase());
                
                var matchesSearch = !searchQuery || 
                    (product.Name && product.Name.toLowerCase().indexOf(searchQuery) !== -1) ||
                    (product.Description && product.Description.toLowerCase().indexOf(searchQuery) !== -1) ||
                    (product.merchantName && product.merchantName.toLowerCase().indexOf(searchQuery) !== -1);
                
                if (matchesCategory && matchesSearch) {
                    filteredProducts.push(product);
                }
            }
            
            renderProducts();
            updateProductCount();
        }

        function updateProductCount() {
            var count = filteredProducts ? filteredProducts.length : 0;
            document.getElementById('productCount').textContent = count + ' product' + (count !== 1 ? 's' : '') + ' available';
        }

        // ========================================
        // CART FUNCTIONS
        // ========================================
        function addToCartFromJson(encodedProduct) {
            try {
                var product = JSON.parse(decodeURIComponent(encodedProduct));
                addToCart(product);
            } catch (e) {
                console.error('Error adding to cart:', e);
                showToast('Error adding product to cart', 'error');
            }
        }

        function addToCart(product) {
            var existingIndex = -1;
            for (var i = 0; i < cart.length; i++) {
                if (cart[i].ProductId === product.ProductId) {
                    existingIndex = i;
                    break;
                }
            }
            
            if (existingIndex > -1) {
                cart[existingIndex].quantity += 1;
            } else {
                product.quantity = 1;
                cart.push(product);
            }
            
            saveCart();
            updateCartUI();
            showToast(product.Name + ' added to cart!', 'success');
        }

        function updateCartQuantity(productId, delta) {
            for (var i = 0; i < cart.length; i++) {
                if (cart[i].ProductId === productId) {
                    cart[i].quantity += delta;
                    
                    if (cart[i].quantity <= 0) {
                        cart.splice(i, 1);
                    }
                    break;
                }
            }
            
            saveCart();
            updateCartUI();
        }

        function removeFromCart(productId) {
            for (var i = cart.length - 1; i >= 0; i--) {
                if (cart[i].ProductId === productId) {
                    cart.splice(i, 1);
                    break;
                }
            }
            saveCart();
            updateCartUI();
        }

        function saveCart() {
            try {
                localStorage.setItem('amadeoCart', JSON.stringify(cart));
            } catch (e) {
                console.warn('Could not save cart to localStorage');
            }
        }

        function loadCart() {
            try {
                var saved = localStorage.getItem('amadeoCart');
                if (saved) {
                    cart = JSON.parse(saved);
                }
            } catch (e) {
                cart = [];
            }
            updateCartUI();
        }

        function clearCart() {
            cart = [];
            saveCart();
            updateCartUI();
        }

        function updateCartUI() {
            var count = 0;
            var subtotal = 0;
            
            for (var i = 0; i < cart.length; i++) {
                count += cart[i].quantity;
                subtotal += (cart[i].Price || 0) * cart[i].quantity;
            }
            
            var delivery = 0; // Free delivery
            var total = subtotal + delivery;
            
            // Update header count
            document.getElementById('cartCount').textContent = count;
            
            // Update cart sidebar
            document.getElementById('cartSubtotal').textContent = '‚Ç±' + formatPrice(subtotal);
            document.getElementById('cartDelivery').textContent = '‚Ç±' + formatPrice(delivery);
            document.getElementById('cartTotal').textContent = '‚Ç±' + formatPrice(total);
            
            // Enable/disable checkout
            document.getElementById('checkoutBtn').disabled = cart.length === 0;
            
            // Render cart items
            renderCartItems();
        }

        function renderCartItems() {
            var container = document.getElementById('cartItems');
            
            if (cart.length === 0) {
                container.innerHTML = '<div class="cart-empty">' +
                    '<div class="cart-empty-icon">üõí</div>' +
                    '<p>Your cart is empty</p>' +
                    '<p style="font-size: 0.85rem; margin-top: 0.5rem;">Add some products to get started!</p>' +
                '</div>';
                return;
            }
            
            var html = '';
            for (var i = 0; i < cart.length; i++) {
                var item = cart[i];
                html += '<div class="cart-item">' +
                    '<img src="' + getImageUrl(item.ImageUrl) + '" alt="' + escapeHtml(item.Name) + '" class="cart-item-image" onerror="this.onerror=null; this.src=\'data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><rect fill=%22%23f0fdfa%22 width=%22100%22 height=%22100%22/><text x=%2250%22 y=%2255%22 text-anchor=%22middle%22 font-size=%2240%22>üõí</text></svg>\'">' +
                    '<div class="cart-item-info">' +
                        '<div class="cart-item-name">' + escapeHtml(item.Name) + '</div>' +
                        '<div class="cart-item-price">‚Ç±' + formatPrice((item.Price || 0) * item.quantity) + '</div>' +
                        '<div class="cart-item-qty">' +
                            '<button class="qty-btn" onclick="updateCartQuantity(\'' + item.ProductId + '\', -1)">‚àí</button>' +
                            '<span class="qty-value">' + item.quantity + '</span>' +
                            '<button class="qty-btn" onclick="updateCartQuantity(\'' + item.ProductId + '\', 1)">+</button>' +
                        '</div>' +
                    '</div>' +
                    '<button class="remove-item" onclick="removeFromCart(\'' + item.ProductId + '\')">üóëÔ∏è</button>' +
                '</div>';
            }
            
            container.innerHTML = html;
        }

        // ========================================
        // CART SIDEBAR
        // ========================================
        function openCart() {
            document.getElementById('cartOverlay').classList.add('active');
            document.getElementById('cartSidebar').classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        function closeCart() {
            document.getElementById('cartOverlay').classList.remove('active');
            document.getElementById('cartSidebar').classList.remove('active');
            document.body.style.overflow = '';
        }

        // ========================================
        // CHECKOUT
        // ========================================
        function openCheckout() {
            if (cart.length === 0) return;
            
            closeCart();
            updateOrderSummary();
            document.getElementById('checkoutModal').classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        function closeCheckout() {
            document.getElementById('checkoutModal').classList.remove('active');
            document.body.style.overflow = '';
            resetPaymentUI();
        }

        function updateOrderSummary() {
            var container = document.getElementById('orderSummaryItems');
            var subtotal = 0;
            var html = '';
            
            for (var i = 0; i < cart.length; i++) {
                var item = cart[i];
                var itemTotal = (item.Price || 0) * item.quantity;
                subtotal += itemTotal;
                
                html += '<div class="order-item">' +
                    '<span>' + item.quantity + 'x ' + escapeHtml(item.Name) + '</span>' +
                    '<span>‚Ç±' + formatPrice(itemTotal) + '</span>' +
                '</div>';
            }
            
            html += '<div class="order-item">' +
                '<span>Delivery Fee</span>' +
                '<span>‚Ç±0.00</span>' +
            '</div>';
            
            container.innerHTML = html;
            document.getElementById('orderTotal').textContent = '‚Ç±' + formatPrice(subtotal);
        }

        // ========================================
        // PAYMENT HANDLING
        // ========================================
        function handlePaymentChange() {
            var selected = document.querySelector('input[name="paymentMethod"]:checked').value;
            var qrSection = document.getElementById('qrSection');
            var uploadSection = document.getElementById('uploadSection');
            
            if (selected === 'COD') {
                qrSection.classList.remove('active');
                uploadSection.classList.remove('active');
            } else {
                // Show QR code
                qrSection.classList.add('active');
                uploadSection.classList.add('active');
                
                // Update QR details
                document.getElementById('qrTitle').textContent = 'Scan to Pay via ' + selected;
                
                var qrImg = document.getElementById('qrImage');
                var qrUrl = PAYMENT_QR[selected] || '';
                
                if (qrUrl) {
                    qrImg.src = qrUrl;
                    qrImg.style.display = 'block';
                    qrImg.parentElement.querySelector('.qr-placeholder').style.display = 'none';
                } else {
                    qrImg.style.display = 'none';
                    qrImg.parentElement.querySelector('.qr-placeholder').style.display = 'block';
                }
                
                var details = PAYMENT_DETAILS[selected] || { name: 'TYG Services', number: '' };
                document.getElementById('qrAccountName').textContent = details.name;
                document.getElementById('qrAccountNumber').textContent = details.number;
            }
        }

        function handleScreenshotUpload(event) {
            var file = event.target.files[0];
            if (!file) return;
            
            // Validate file
            if (file.type.indexOf('image/') !== 0) {
                showToast('Please upload an image file', 'error');
                return;
            }
            
            if (file.size > 5 * 1024 * 1024) {
                showToast('File too large. Max 5MB allowed.', 'error');
                return;
            }
            
            // Read file
            var reader = new FileReader();
            reader.onload = function(e) {
                paymentScreenshotData = {
                    name: file.name,
                    type: file.type,
                    data: e.target.result
                };
                
                // Update UI
                var uploadArea = document.getElementById('uploadArea');
                var preview = document.getElementById('uploadPreview');
                
                uploadArea.classList.add('has-file');
                preview.src = e.target.result;
                preview.classList.add('active');
                
                document.querySelector('#uploadArea .upload-text').textContent = 'Screenshot uploaded ‚úì';
            };
            reader.readAsDataURL(file);
        }

        function resetPaymentUI() {
            paymentScreenshotData = null;
            document.getElementById('payCOD').checked = true;
            document.getElementById('qrSection').classList.remove('active');
            document.getElementById('uploadSection').classList.remove('active');
            document.getElementById('uploadArea').classList.remove('has-file');
            document.getElementById('uploadPreview').classList.remove('active');
            document.querySelector('#uploadArea .upload-text').textContent = 'Click to upload screenshot';
            document.getElementById('paymentScreenshot').value = '';
        }

        // ========================================
        // ORDER SUBMISSION
        // ========================================
        async function submitOrder(event) {
            event.preventDefault();
            
            var submitBtn = document.getElementById('submitBtn');
            var submitText = document.getElementById('submitText');
            
            // Get form data
            var customerName = document.getElementById('customerName').value.trim();
            var customerPhone = document.getElementById('customerPhone').value.trim();
            var customerEmail = document.getElementById('customerEmail').value.trim();
            var customerAddress = document.getElementById('customerAddress').value.trim();
            var customerBarangay = document.getElementById('customerBarangay').value;
            var specialInstructions = document.getElementById('specialInstructions').value.trim();
            var paymentMethod = document.querySelector('input[name="paymentMethod"]:checked').value;
            
            // Validate
            if (!customerName || !customerPhone || !customerAddress || !customerBarangay) {
                showToast('Please fill in all required fields', 'error');
                return;
            }
            
            if (paymentMethod !== 'COD' && !paymentScreenshotData) {
                showToast('Please upload payment screenshot', 'error');
                return;
            }
            
            // Disable button
            submitBtn.disabled = true;
            submitText.innerHTML = '<div class="spinner-small"></div> Processing...';
            
            try {
                // Prepare items
                var items = [];
                for (var i = 0; i < cart.length; i++) {
                    var item = cart[i];
                    items.push({
                        productId: item.ProductId,
                        merchantId: item.MerchantId,
                        productName: item.Name,
                        name: item.Name,
                        price: item.Price,
                        quantity: item.quantity
                    });
                }
                
                // Prepare order data
                var orderData = {
                    action: 'createOrder',
                    customerName: customerName,
                    customerPhone: customerPhone,
                    customerEmail: customerEmail,
                    customerAddress: customerAddress,
                    barangay: customerBarangay,
                    specialInstructions: specialInstructions,
                    paymentMethod: paymentMethod,
                    deliveryFee: 0,
                    items: items
                };
                
                // Add screenshot if not COD
                if (paymentMethod !== 'COD' && paymentScreenshotData) {
                    orderData.paymentScreenshot = paymentScreenshotData.data;
                }
                
                console.log('üì§ Submitting order...');
                
                // Submit order
                var response = await fetch(API_BASE, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(orderData)
                });
                
                var result = await response.json();
                console.log('üì• Order response:', result);
                
                if (result.success) {
                    // Show success
                    closeCheckout();
                    document.getElementById('successOrderId').textContent = result.orderId;
                    document.getElementById('successModal').classList.add('active');
                    
                    // Clear cart
                    clearCart();
                    
                    // Reset form
                    document.getElementById('checkoutForm').reset();
                    resetPaymentUI();
                } else {
                    throw new Error(result.error || 'Failed to place order');
                }
            } catch (error) {
                console.error('‚ùå Order submission error:', error);
                showToast(error.message || 'Failed to place order. Please try again.', 'error');
            } finally {
                submitBtn.disabled = false;
                submitText.textContent = 'Place Order';
            }
        }

        function closeSuccessAndReset() {
            document.getElementById('successModal').classList.remove('active');
            document.body.style.overflow = '';
        }

        // ========================================
        // UTILITY FUNCTIONS
        // ========================================
        function getImageUrl(url) {
            if (!url) {
                return 'data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><rect fill=%22%23f0fdfa%22 width=%22100%22 height=%22100%22/><text x=%2250%22 y=%2255%22 text-anchor=%22middle%22 font-size=%2240%22>üõí</text></svg>';
            }
            
            // Convert drive.google.com URLs to lh3 format
            if (url.indexOf('drive.google.com') !== -1) {
                var match = url.match(/[-\w]{25,}/);
                if (match) {
                    return 'https://lh3.googleusercontent.com/d/' + match[0];
                }
            }
            
            // Already lh3 format or other URL
            return url;
        }

        function getStockStatusInfo(available) {
            if (available <= 0) {
                return { text: '‚ùå Out of stock', class: 'stock-out' };
            } else if (available <= 5) {
                return { text: '‚ö†Ô∏è Only ' + available + ' left', class: 'stock-low' };
            } else {
                return { text: '‚úì ' + available + ' in stock', class: 'stock-in' };
            }
        }

        function formatPrice(price) {
            var num = Number(price) || 0;
            return num.toLocaleString('en-PH', {
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
            });
        }

        function escapeHtml(str) {
            if (!str) return '';
            var div = document.createElement('div');
            div.textContent = str;
            return div.innerHTML;
        }

        function showToast(message, type) {
            type = type || 'success';
            var container = document.getElementById('toastContainer');
            var toast = document.createElement('div');
            toast.className = 'toast ' + type;
            toast.innerHTML = '<span>' + (type === 'success' ? '‚úì' : '‚ö†Ô∏è') + '</span>' +
                '<span>' + escapeHtml(message) + '</span>';
            
            container.appendChild(toast);
            
            setTimeout(function() {
                toast.style.opacity = '0';
                toast.style.transform = 'translateX(100%)';
                setTimeout(function() {
                    if (toast.parentNode) {
                        toast.parentNode.removeChild(toast);
                    }
                }, 300);
            }, 3000);
        }
    </script>
</body>
</html>
