<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Amadeo Verified Marketplace</title>
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f5f5f5;
            color: #333;
        }

        /* Header */
        .header {
            background: linear-gradient(135deg, #2e7d32 0%, #1b5e20 100%);
            color: white;
            padding: 15px 20px;
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
        }

        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 1.5rem;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .logo-icon {
            font-size: 2rem;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .cart-btn {
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            padding: 10px 15px;
            border-radius: 25px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 1rem;
            transition: all 0.3s;
        }

        .cart-btn:hover {
            background: rgba(255,255,255,0.3);
        }

        .cart-count {
            background: #ff5722;
            color: white;
            border-radius: 50%;
            width: 22px;
            height: 22px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            font-weight: bold;
        }

        .user-menu {
            position: relative;
        }

        .user-btn {
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            padding: 8px 15px;
            border-radius: 25px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 0.95rem;
        }

        .user-btn:hover {
            background: rgba(255,255,255,0.3);
        }

        .user-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            object-fit: cover;
        }

        .user-dropdown {
            position: absolute;
            top: 100%;
            right: 0;
            background: white;
            border-radius: 12px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.2);
            min-width: 220px;
            display: none;
            margin-top: 10px;
            overflow: hidden;
        }

        .user-dropdown.show {
            display: block;
        }

        .user-dropdown-header {
            padding: 15px;
            background: #f5f5f5;
            border-bottom: 1px solid #eee;
        }

        .user-dropdown-name {
            font-weight: 600;
            color: #333;
        }

        .user-dropdown-email {
            font-size: 0.85rem;
            color: #666;
        }

        .user-dropdown-item {
            padding: 12px 15px;
            display: flex;
            align-items: center;
            gap: 10px;
            color: #333;
            text-decoration: none;
            cursor: pointer;
            transition: background 0.2s;
        }

        .user-dropdown-item:hover {
            background: #f5f5f5;
        }

        .user-dropdown-item.logout {
            color: #d32f2f;
            border-top: 1px solid #eee;
        }

        /* Hero Section */
        .hero {
            background: linear-gradient(135deg, #2e7d32 0%, #1b5e20 100%);
            color: white;
            padding: 60px 20px;
            text-align: center;
        }

        .hero h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .hero p {
            font-size: 1.1rem;
            opacity: 0.9;
            margin-bottom: 30px;
        }

        .search-box {
            max-width: 500px;
            margin: 0 auto;
            position: relative;
        }

        .search-box input {
            width: 100%;
            padding: 15px 20px;
            padding-right: 50px;
            border: none;
            border-radius: 30px;
            font-size: 1rem;
        }

        .search-box button {
            position: absolute;
            right: 5px;
            top: 5px;
            background: #2e7d32;
            border: none;
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
        }

        /* Categories */
        .categories {
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }

        .category-scroll {
            display: flex;
            gap: 10px;
            overflow-x: auto;
            padding: 10px 0;
        }

        .category-btn {
            background: white;
            border: 2px solid #e0e0e0;
            padding: 10px 20px;
            border-radius: 25px;
            cursor: pointer;
            white-space: nowrap;
            transition: all 0.3s;
            font-size: 0.95rem;
        }

        .category-btn:hover, .category-btn.active {
            border-color: #2e7d32;
            background: #e8f5e9;
            color: #2e7d32;
        }

        /* Products Grid */
        .products-section {
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }

        .section-title {
            font-size: 1.5rem;
            margin-bottom: 20px;
            color: #333;
        }

        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
        }

        .product-card {
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            transition: transform 0.3s, box-shadow 0.3s;
        }

        .product-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 20px rgba(0,0,0,0.15);
        }

        .product-image {
            width: 100%;
            height: 180px;
            object-fit: cover;
        }

        .product-info {
            padding: 15px;
        }

        .product-merchant {
            font-size: 0.85rem;
            color: #2e7d32;
            margin-bottom: 5px;
        }

        .product-name {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .product-price {
            font-size: 1.25rem;
            font-weight: bold;
            color: #2e7d32;
            margin-bottom: 10px;
        }

        .product-unit {
            font-size: 0.85rem;
            color: #666;
            font-weight: normal;
        }

        .add-to-cart-btn {
            width: 100%;
            background: #2e7d32;
            color: white;
            border: none;
            padding: 12px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            transition: background 0.3s;
        }

        .add-to-cart-btn:hover {
            background: #1b5e20;
        }

        /* Cart Sidebar */
        .cart-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 2000;
            display: none;
        }

        .cart-overlay.show {
            display: block;
        }

        .cart-sidebar {
            position: fixed;
            top: 0;
            right: -400px;
            width: 400px;
            max-width: 100%;
            height: 100%;
            background: white;
            z-index: 2001;
            transition: right 0.3s;
            display: flex;
            flex-direction: column;
        }

        .cart-sidebar.show {
            right: 0;
        }

        .cart-header {
            padding: 20px;
            background: #2e7d32;
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .cart-header h2 {
            font-size: 1.3rem;
        }

        .cart-close {
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
        }

        .cart-items {
            flex: 1;
            overflow-y: auto;
            padding: 15px;
        }

        .cart-item {
            display: flex;
            gap: 15px;
            padding: 15px;
            border-bottom: 1px solid #eee;
        }

        .cart-item-image {
            width: 70px;
            height: 70px;
            object-fit: cover;
            border-radius: 8px;
        }

        .cart-item-info {
            flex: 1;
        }

        .cart-item-name {
            font-weight: 600;
            margin-bottom: 5px;
        }

        .cart-item-price {
            color: #2e7d32;
            font-weight: bold;
        }

        .cart-item-qty {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 10px;
        }

        .qty-btn {
            width: 28px;
            height: 28px;
            border: 1px solid #ddd;
            background: white;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1rem;
        }

        .qty-btn:hover {
            background: #f5f5f5;
        }

        .cart-item-remove {
            color: #d32f2f;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 0.9rem;
        }

        .cart-empty {
            text-align: center;
            padding: 40px;
            color: #666;
        }

        .cart-footer {
            padding: 20px;
            border-top: 1px solid #eee;
            background: #f9f9f9;
        }

        .cart-total {
            display: flex;
            justify-content: space-between;
            font-size: 1.2rem;
            font-weight: bold;
            margin-bottom: 15px;
        }

        .checkout-btn {
            width: 100%;
            background: #2e7d32;
            color: white;
            border: none;
            padding: 15px;
            border-radius: 10px;
            font-size: 1.1rem;
            cursor: pointer;
            transition: background 0.3s;
        }

        .checkout-btn:hover {
            background: #1b5e20;
        }

        .checkout-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        /* Checkout Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 3000;
            display: none;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .modal-overlay.show {
            display: flex;
        }

        .modal {
            background: white;
            border-radius: 15px;
            width: 100%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            padding: 20px;
            background: #2e7d32;
            color: white;
            border-radius: 15px 15px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h2 {
            font-size: 1.3rem;
        }

        .modal-close {
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
        }

        .modal-body {
            padding: 25px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #2e7d32;
        }

        .form-group textarea {
            resize: vertical;
            min-height: 80px;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        /* Payment Section */
        .payment-options {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
        }

        .payment-option {
            flex: 1;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            cursor: pointer;
            text-align: center;
            transition: all 0.3s;
        }

        .payment-option:hover {
            border-color: #2e7d32;
        }

        .payment-option.selected {
            border-color: #2e7d32;
            background: #e8f5e9;
        }

        .payment-option input {
            display: none;
        }

        .payment-option-icon {
            font-size: 2rem;
            margin-bottom: 5px;
        }

        .payment-option-label {
            font-weight: 600;
        }

        .payment-details {
            background: #f5f5f5;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: none;
        }

        .payment-details.show {
            display: block;
        }

        .payment-info {
            text-align: center;
        }

        .payment-info h4 {
            color: #2e7d32;
            margin-bottom: 15px;
        }

        .payment-number {
            font-size: 1.5rem;
            font-weight: bold;
            color: #333;
            margin-bottom: 5px;
        }

        .payment-name {
            color: #666;
            margin-bottom: 20px;
        }

        .upload-area {
            border: 2px dashed #2e7d32;
            border-radius: 10px;
            padding: 30px;
            text-align: center;
            cursor: pointer;
            transition: background 0.3s;
        }

        .upload-area:hover {
            background: #e8f5e9;
        }

        .upload-area.has-file {
            border-style: solid;
            background: #e8f5e9;
        }

        .upload-icon {
            font-size: 2.5rem;
            color: #2e7d32;
            margin-bottom: 10px;
        }

        .upload-text {
            color: #666;
        }

        .upload-preview {
            max-width: 200px;
            max-height: 150px;
            margin-top: 15px;
            border-radius: 8px;
        }

        /* Legal Agreement */
        .legal-section {
            background: #fff3e0;
            border: 1px solid #ffcc02;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .legal-section h4 {
            color: #e65100;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .legal-checkbox {
            display: flex;
            align-items: flex-start;
            gap: 10px;
            margin-bottom: 12px;
        }

        .legal-checkbox input[type="checkbox"] {
            width: 20px;
            height: 20px;
            margin-top: 2px;
            cursor: pointer;
        }

        .legal-checkbox label {
            font-size: 0.95rem;
            color: #333;
            cursor: pointer;
        }

        .legal-checkbox a {
            color: #2e7d32;
            text-decoration: underline;
        }

        /* Order Summary */
        .order-summary {
            background: #f9f9f9;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .order-summary h4 {
            margin-bottom: 15px;
            color: #333;
        }

        .summary-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-size: 0.95rem;
        }

        .summary-item.total {
            font-weight: bold;
            font-size: 1.1rem;
            border-top: 2px solid #ddd;
            padding-top: 10px;
            margin-top: 10px;
        }

        .submit-order-btn {
            width: 100%;
            background: #2e7d32;
            color: white;
            border: none;
            padding: 15px;
            border-radius: 10px;
            font-size: 1.1rem;
            cursor: pointer;
            transition: background 0.3s;
        }

        .submit-order-btn:hover {
            background: #1b5e20;
        }

        .submit-order-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        /* Legal Modal */
        .legal-modal {
            max-width: 700px;
        }

        .legal-content {
            max-height: 400px;
            overflow-y: auto;
            padding: 20px;
            background: #f9f9f9;
            border-radius: 10px;
            margin-bottom: 20px;
            font-size: 0.95rem;
            line-height: 1.6;
        }

        .legal-content h3 {
            color: #2e7d32;
            margin: 20px 0 10px 0;
        }

        .legal-content h3:first-child {
            margin-top: 0;
        }

        .legal-content ul {
            margin-left: 20px;
            margin-bottom: 15px;
        }

        .legal-content li {
            margin-bottom: 8px;
        }

        /* Success Modal */
        .success-content {
            text-align: center;
            padding: 40px 20px;
        }

        .success-icon {
            font-size: 4rem;
            color: #2e7d32;
            margin-bottom: 20px;
        }

        .success-content h2 {
            color: #333;
            margin-bottom: 10px;
        }

        .success-content p {
            color: #666;
            margin-bottom: 20px;
        }

        .order-id {
            background: #e8f5e9;
            padding: 15px;
            border-radius: 10px;
            font-size: 1.2rem;
            font-weight: bold;
            color: #2e7d32;
            margin-bottom: 20px;
        }

        /* Login Required */
        .login-prompt {
            text-align: center;
            padding: 40px 20px;
        }

        .login-prompt p {
            margin-bottom: 20px;
            color: #666;
        }

        .google-signin-btn {
            background: white;
            border: 2px solid #ddd;
            padding: 12px 30px;
            border-radius: 30px;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            font-size: 1rem;
            transition: all 0.3s;
        }

        .google-signin-btn:hover {
            border-color: #2e7d32;
            background: #f5f5f5;
        }

        .google-signin-btn img {
            width: 20px;
            height: 20px;
        }

        /* Footer */
        .footer {
            background: #333;
            color: white;
            padding: 40px 20px;
            margin-top: 50px;
        }

        .footer-content {
            max-width: 1200px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 30px;
        }

        .footer-section h4 {
            margin-bottom: 15px;
            color: #4caf50;
        }

        .footer-section a {
            color: #ccc;
            text-decoration: none;
            display: block;
            margin-bottom: 8px;
        }

        .footer-section a:hover {
            color: white;
        }

        .footer-bottom {
            max-width: 1200px;
            margin: 30px auto 0;
            padding-top: 20px;
            border-top: 1px solid #555;
            text-align: center;
            color: #999;
            font-size: 0.9rem;
        }

        /* Loading Spinner */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255,255,255,0.9);
            z-index: 5000;
            display: none;
            align-items: center;
            justify-content: center;
            flex-direction: column;
        }

        .loading-overlay.show {
            display: flex;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 4px solid #e0e0e0;
            border-top-color: #2e7d32;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .loading-text {
            margin-top: 15px;
            color: #666;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .hero h1 {
                font-size: 1.8rem;
            }

            .form-row {
                grid-template-columns: 1fr;
            }

            .payment-options {
                flex-direction: column;
            }

            .cart-sidebar {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <div class="logo">
                <span class="logo-icon">üè™</span>
                <span>Amadeo Verified</span>
            </div>
            <div class="header-right">
                <button class="cart-btn" onclick="toggleCart()">
                    üõí Cart <span class="cart-count" id="cartCount">0</span>
                </button>
                
                <div class="user-menu" id="userMenu">
                    <!-- Logged out state -->
                    <button class="user-btn" id="loginBtn" onclick="showLoginModal()">
                        Sign In
                    </button>
                    
                    <!-- Logged in state (hidden by default) -->
                    <button class="user-btn" id="userBtn" style="display: none;" onclick="toggleUserDropdown()">
                        <img src="" alt="" class="user-avatar" id="userAvatar">
                        <span id="userName"></span>
                        ‚ñº
                    </button>
                    
                    <div class="user-dropdown" id="userDropdown">
                        <div class="user-dropdown-header">
                            <div class="user-dropdown-name" id="dropdownName"></div>
                            <div class="user-dropdown-email" id="dropdownEmail"></div>
                        </div>
                        <div class="user-dropdown-item" onclick="viewOrders()">
                            üì¶ My Orders
                        </div>
                        <div class="user-dropdown-item logout" onclick="logout()">
                            üö™ Sign Out
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Hero Section -->
    <section class="hero">
        <h1>üõçÔ∏è Amadeo Verified Marketplace</h1>
        <p>Shop from verified local businesses in Amadeo, Cavite</p>
        <div class="search-box">
            <input type="text" id="searchInput" placeholder="Search products..." onkeyup="searchProducts()">
            <button onclick="searchProducts()">üîç</button>
        </div>
    </section>

    <!-- Categories -->
    <section class="categories">
        <div class="category-scroll">
            <button class="category-btn active" onclick="filterCategory('all')">All</button>
            <button class="category-btn" onclick="filterCategory('food')">üç≤ Food</button>
            <button class="category-btn" onclick="filterCategory('water')">üíß Water</button>
            <button class="category-btn" onclick="filterCategory('services')">üîß Services</button>
            <button class="category-btn" onclick="filterCategory('retail')">üõí Retail</button>
            <button class="category-btn" onclick="filterCategory('agriculture')">üåæ Agriculture</button>
            <button class="category-btn" onclick="filterCategory('health')">üíä Health</button>
        </div>
    </section>

    <!-- Products Grid -->
    <section class="products-section">
        <h2 class="section-title">Available Products</h2>
        <div class="products-grid" id="productsGrid">
            <!-- Products loaded dynamically -->
        </div>
    </section>

    <!-- Cart Sidebar -->
    <div class="cart-overlay" id="cartOverlay" onclick="toggleCart()"></div>
    <div class="cart-sidebar" id="cartSidebar">
        <div class="cart-header">
            <h2>üõí Your Cart</h2>
            <button class="cart-close" onclick="toggleCart()">√ó</button>
        </div>
        <div class="cart-items" id="cartItems">
            <div class="cart-empty">
                <p>Your cart is empty</p>
            </div>
        </div>
        <div class="cart-footer">
            <div class="cart-total">
                <span>Total:</span>
                <span id="cartTotal">‚Ç±0.00</span>
            </div>
            <button class="checkout-btn" id="checkoutBtn" onclick="proceedToCheckout()" disabled>
                Proceed to Checkout
            </button>
        </div>
    </div>

    <!-- Login Modal -->
    <div class="modal-overlay" id="loginModal">
        <div class="modal" style="max-width: 400px;">
            <div class="modal-header">
                <h2>Sign In</h2>
                <button class="modal-close" onclick="hideLoginModal()">√ó</button>
            </div>
            <div class="modal-body">
                <div class="login-prompt">
                    <p>Sign in with your Google account to continue</p>
                    <div id="googleSignInDiv"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Checkout Modal -->
    <div class="modal-overlay" id="checkoutModal">
        <div class="modal">
            <div class="modal-header">
                <h2>üì¶ Checkout</h2>
                <button class="modal-close" onclick="hideCheckoutModal()">√ó</button>
            </div>
            <div class="modal-body">
                <form id="checkoutForm" onsubmit="submitOrder(event)">
                    <!-- Delivery Information -->
                    <h3 style="margin-bottom: 20px; color: #333;">üìç Delivery Information</h3>
                    
                    <div class="form-group">
                        <label>Full Name *</label>
                        <input type="text" id="customerName" required placeholder="Juan dela Cruz">
                    </div>
                    
                    <div class="form-group">
                        <label>Mobile Number *</label>
                        <input type="tel" id="customerMobile" required placeholder="09XX XXX XXXX">
                    </div>
                    
                    <div class="form-group">
                        <label>Delivery Address *</label>
                        <textarea id="customerAddress" required placeholder="House #, Street, Barangay, Amadeo, Cavite"></textarea>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>Delivery Date *</label>
                            <input type="date" id="deliveryDate" required>
                        </div>
                        <div class="form-group">
                            <label>Preferred Time *</label>
                            <select id="deliveryTime" required>
                                <option value="">Select time...</option>
                                <option value="Morning (8AM-12PM)">Morning (8AM-12PM)</option>
                                <option value="Afternoon (12PM-5PM)">Afternoon (12PM-5PM)</option>
                                <option value="Evening (5PM-8PM)">Evening (5PM-8PM)</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>Special Instructions (Optional)</label>
                        <textarea id="specialInstructions" placeholder="Any special requests or notes for the merchant..."></textarea>
                    </div>

                    <!-- Payment Method -->
                    <h3 style="margin: 30px 0 20px; color: #333;">üí≥ Payment Method</h3>
                    
                    <div class="payment-options">
                        <label class="payment-option" id="codOption">
                            <input type="radio" name="paymentMethod" value="COD" onchange="selectPayment('COD')">
                            <div class="payment-option-icon">üíµ</div>
                            <div class="payment-option-label">Cash on Delivery</div>
                        </label>
                        <label class="payment-option" id="onlineOption">
                            <input type="radio" name="paymentMethod" value="ONLINE" onchange="selectPayment('ONLINE')">
                            <div class="payment-option-icon">üì±</div>
                            <div class="payment-option-label">Online Payment</div>
                        </label>
                    </div>

                    <!-- Online Payment Details -->
                    <div class="payment-details" id="paymentDetails">
                        <div class="payment-info">
                            <h4>üì± GCash Payment</h4>
                            <div class="payment-number">0966 960 6060</div>
                            <div class="payment-name">LEGERYN PIA</div>
                            <p style="font-size: 0.9rem; color: #666; margin-bottom: 20px;">
                                Please send the exact amount and upload your payment screenshot below.
                            </p>
                        </div>
                        
                        <div class="upload-area" id="uploadArea" onclick="document.getElementById('paymentProof').click()">
                            <div class="upload-icon">üì§</div>
                            <div class="upload-text">Click to upload payment screenshot</div>
                            <img class="upload-preview" id="uploadPreview" style="display: none;">
                        </div>
                        <input type="file" id="paymentProof" accept="image/*" style="display: none;" onchange="previewPaymentProof(this)">
                    </div>

                    <!-- Order Summary -->
                    <div class="order-summary">
                        <h4>üìã Order Summary</h4>
                        <div id="checkoutItems"></div>
                        <div class="summary-item">
                            <span>Subtotal</span>
                            <span id="summarySubtotal">‚Ç±0.00</span>
                        </div>
                        <div class="summary-item">
                            <span>Platform Fee (5%)</span>
                            <span id="summaryFee">‚Ç±0.00</span>
                        </div>
                        <div class="summary-item total">
                            <span>Total Amount</span>
                            <span id="summaryTotal">‚Ç±0.00</span>
                        </div>
                    </div>

                    <!-- Legal Agreement -->
                    <div class="legal-section">
                        <h4>‚öñÔ∏è Terms & Agreement</h4>
                        <div class="legal-checkbox">
                            <input type="checkbox" id="agreeTerms" required>
                            <label for="agreeTerms">
                                I have read and agree to the <a href="#" onclick="showTermsModal(event)">Terms and Conditions</a> and <a href="#" onclick="showPrivacyModal(event)">Privacy Policy</a> *
                            </label>
                        </div>
                        <div class="legal-checkbox">
                            <input type="checkbox" id="agreeRefund" required>
                            <label for="agreeRefund">
                                I understand and agree to the <a href="#" onclick="showRefundModal(event)">Refund & Cancellation Policy</a> *
                            </label>
                        </div>
                        <div class="legal-checkbox">
                            <input type="checkbox" id="agreeAccuracy" required>
                            <label for="agreeAccuracy">
                                I confirm that all information provided is accurate and complete *
                            </label>
                        </div>
                    </div>

                    <button type="submit" class="submit-order-btn" id="submitOrderBtn">
                        ‚úÖ Place Order
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- Terms Modal -->
    <div class="modal-overlay" id="termsModal">
        <div class="modal legal-modal">
            <div class="modal-header">
                <h2>üìú Terms and Conditions</h2>
                <button class="modal-close" onclick="hideTermsModal()">√ó</button>
            </div>
            <div class="modal-body">
                <div class="legal-content">
                    <h3>1. Introduction</h3>
                    <p>Welcome to Amadeo Verified Marketplace ("Platform"), operated by TYG Services. By placing an order, you agree to these Terms and Conditions.</p>
                    
                    <h3>2. Platform Role</h3>
                    <p>The Platform serves as a FACILITATOR connecting consumers with verified local merchants. TYG Services is NOT the seller of products and does not guarantee product quality, availability, or delivery times. Each merchant is an independent business responsible for their own products and services.</p>
                    
                    <h3>3. Orders</h3>
                    <ul>
                        <li>All orders are subject to merchant acceptance and availability</li>
                        <li>Prices displayed include the 5% platform fee</li>
                        <li>Orders cannot be modified after submission</li>
                        <li>Merchants reserve the right to decline orders</li>
                    </ul>
                    
                    <h3>4. Payment</h3>
                    <ul>
                        <li>All payments are processed through TYG Services</li>
                        <li>For online payments, proof of payment must be uploaded</li>
                        <li>COD orders require exact payment upon delivery</li>
                        <li>Fraudulent payment claims will result in account suspension</li>
                    </ul>
                    
                    <h3>5. Delivery</h3>
                    <ul>
                        <li>Delivery is handled by respective merchants</li>
                        <li>Delivery times are estimates only</li>
                        <li>Customer must provide accurate delivery information</li>
                        <li>Failed deliveries due to incorrect information may incur additional charges</li>
                    </ul>
                    
                    <h3>6. Limitation of Liability</h3>
                    <p>TYG Services shall not be liable for any direct, indirect, incidental, or consequential damages arising from product quality, delivery delays, or merchant actions. Maximum liability is limited to the platform fee collected.</p>
                    
                    <h3>7. Dispute Resolution</h3>
                    <p>For product-related issues, contact the merchant first. Platform-related disputes will be handled by TYG Services. All disputes are subject to the laws of the Republic of the Philippines.</p>
                    
                    <h3>8. Account Termination</h3>
                    <p>TYG Services reserves the right to suspend or terminate accounts that violate these terms, engage in fraudulent activity, or abuse the platform.</p>
                    
                    <h3>9. Modifications</h3>
                    <p>These terms may be updated at any time. Continued use of the platform constitutes acceptance of updated terms.</p>
                    
                    <p style="margin-top: 20px;"><strong>Effective Date:</strong> November 2024</p>
                    <p><strong>Contact:</strong> <a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="e4909d83829786a48389858d88ca878b89">[email&#160;protected]</a></p>
                </div>
                <button class="submit-order-btn" onclick="hideTermsModal()">I Understand</button>
            </div>
        </div>
    </div>

    <!-- Privacy Modal -->
    <div class="modal-overlay" id="privacyModal">
        <div class="modal legal-modal">
            <div class="modal-header">
                <h2>üîí Privacy Policy</h2>
                <button class="modal-close" onclick="hidePrivacyModal()">√ó</button>
            </div>
            <div class="modal-body">
                <div class="legal-content">
                    <h3>1. Information We Collect</h3>
                    <ul>
                        <li>Personal information (name, email, phone number)</li>
                        <li>Delivery addresses</li>
                        <li>Order history</li>
                        <li>Payment proof images</li>
                        <li>Device and browser information</li>
                    </ul>
                    
                    <h3>2. How We Use Your Information</h3>
                    <ul>
                        <li>Process and fulfill orders</li>
                        <li>Communicate order status</li>
                        <li>Share necessary information with merchants for delivery</li>
                        <li>Improve our services</li>
                        <li>Prevent fraud</li>
                    </ul>
                    
                    <h3>3. Information Sharing</h3>
                    <p>We share your information with:</p>
                    <ul>
                        <li>Merchants (name, contact, address for delivery purposes)</li>
                        <li>Payment processors (for verification)</li>
                        <li>Legal authorities (when required by law)</li>
                    </ul>
                    <p>We do NOT sell your personal information to third parties.</p>
                    
                    <h3>4. Data Security</h3>
                    <p>We implement appropriate security measures to protect your data. However, no system is 100% secure. Use strong passwords and report suspicious activity immediately.</p>
                    
                    <h3>5. Data Retention</h3>
                    <p>Order information is retained for business and legal purposes. You may request deletion of your account by contacting us.</p>
                    
                    <h3>6. Your Rights</h3>
                    <p>Under Philippine Data Privacy Act (RA 10173), you have the right to access, correct, and request deletion of your personal data.</p>
                    
                    <h3>7. Contact Us</h3>
                    <p>For privacy concerns: <a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="03777a6465706143646e626a6f2d606c6e">[email&#160;protected]</a></p>
                    
                    <p style="margin-top: 20px;"><strong>Effective Date:</strong> November 2024</p>
                </div>
                <button class="submit-order-btn" onclick="hidePrivacyModal()">I Understand</button>
            </div>
        </div>
    </div>

    <!-- Refund Modal -->
    <div class="modal-overlay" id="refundModal">
        <div class="modal legal-modal">
            <div class="modal-header">
                <h2>‚Ü©Ô∏è Refund & Cancellation Policy</h2>
                <button class="modal-close" onclick="hideRefundModal()">√ó</button>
            </div>
            <div class="modal-body">
                <div class="legal-content">
                    <h3>1. Order Cancellation</h3>
                    <ul>
                        <li>Orders may be cancelled within 30 minutes of placement</li>
                        <li>After 30 minutes, cancellation is subject to merchant approval</li>
                        <li>Orders already being prepared cannot be cancelled</li>
                        <li>Contact the merchant directly for cancellation requests</li>
                    </ul>
                    
                    <h3>2. Refund Eligibility</h3>
                    <p>Refunds are available ONLY in the following cases:</p>
                    <ul>
                        <li>Merchant fails to deliver the order</li>
                        <li>Order delivered is significantly different from what was ordered</li>
                        <li>Product is damaged or spoiled upon delivery</li>
                        <li>Merchant cancels the order</li>
                    </ul>
                    
                    <h3>3. Non-Refundable Cases</h3>
                    <ul>
                        <li>Change of mind after order confirmation</li>
                        <li>Incorrect delivery information provided by customer</li>
                        <li>Customer unavailable during delivery</li>
                        <li>Minor variations in product appearance</li>
                        <li>Delays due to weather or unforeseen circumstances</li>
                    </ul>
                    
                    <h3>4. Refund Process</h3>
                    <ul>
                        <li>Contact merchant first to resolve the issue</li>
                        <li>If unresolved, email <a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="7e0a0719180d1c3e19131f1712501d1113">[email&#160;protected]</a> with order details</li>
                        <li>Provide photos as evidence (for damaged/incorrect items)</li>
                        <li>Refund decision within 3-5 business days</li>
                        <li>Approved refunds processed within 7 business days</li>
                    </ul>
                    
                    <h3>5. Refund Method</h3>
                    <ul>
                        <li>Online payments: Refunded to original payment method</li>
                        <li>COD orders: Not applicable (no payment made)</li>
                        <li>Platform fee (5%) is non-refundable for customer-caused issues</li>
                    </ul>
                    
                    <h3>6. Dispute Resolution</h3>
                    <p>All disputes will be handled fairly. TYG Services decision on refunds is final after investigation.</p>
                    
                    <p style="margin-top: 20px;"><strong>Effective Date:</strong> November 2024</p>
                </div>
                <button class="submit-order-btn" onclick="hideRefundModal()">I Understand</button>
            </div>
        </div>
    </div>

    <!-- Order Success Modal -->
    <div class="modal-overlay" id="successModal">
        <div class="modal" style="max-width: 450px;">
            <div class="modal-body">
                <div class="success-content">
                    <div class="success-icon">‚úÖ</div>
                    <h2>Order Placed Successfully!</h2>
                    <p>Your order has been submitted and sent to the merchant.</p>
                    <div class="order-id" id="successOrderId">ORD-XXXXXXXX</div>
                    <p style="font-size: 0.9rem; color: #666;">
                        You will receive a confirmation email shortly.<br>
                        The merchant will contact you regarding delivery.
                    </p>
                    <button class="submit-order-btn" onclick="closeSuccessModal()">Continue Shopping</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="spinner"></div>
        <div class="loading-text">Processing your order...</div>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <div class="footer-content">
            <div class="footer-section">
                <h4>üè™ Amadeo Verified</h4>
                <p style="color: #999; font-size: 0.9rem;">
                    Supporting local businesses in Amadeo, Cavite since 2024.
                </p>
            </div>
            <div class="footer-section">
                <h4>Quick Links</h4>
                <a href="#" onclick="showTermsModal(event)">Terms & Conditions</a>
                <a href="#" onclick="showPrivacyModal(event)">Privacy Policy</a>
                <a href="#" onclick="showRefundModal(event)">Refund Policy</a>
            </div>
            <div class="footer-section">
                <h4>Contact Us</h4>
                <a href="/cdn-cgi/l/email-protection#85f1fce2e3f6e7c5e2e8e4ece9abe6eae8">üìß <span class="__cf_email__" data-cfemail="f7838e90918495b7909a969e9bd994989a">[email&#160;protected]</span></a>
                <a href="tel:09669606060">üì± 0966 960 6060</a>
            </div>
            <div class="footer-section">
                <h4>For Merchants</h4>
                <a href="merchant-dashboard.html">Merchant Login</a>
                <a href="merchant-register.html">Become a Merchant</a>
            </div>
        </div>
        <div class="footer-bottom">
            <p>¬© 2024 Amadeo Verified Marketplace. Powered by TYG Services.</p>
            <p style="margin-top: 5px; font-size: 0.85rem;">All transactions protected. Platform facilitator only.</p>
        </div>
    </footer>

    <script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script>
        // ============================================
        // CONFIGURATION - UPDATE THESE VALUES
        // ============================================
        const CONFIG = {
            GOOGLE_CLIENT_ID: 'YOUR_CLIENT_ID.apps.googleusercontent.com',
            BACKEND_URL: 'https://script.google.com/macros/s/AKfycbwgHmmK1j8a6rqx_Zfk5nPGqdUIRSo1oIUNgGoVr2-in988F3K8Kyp8PN15zHS3InIUgw/exec',
            PLATFORM_FEE: 0.05, // 5%
            GCASH_NUMBER: '0966 960 6060',
            GCASH_NAME: 'LEGERYN PIA'
        };

        // ============================================
        // STATE MANAGEMENT
        // ============================================
        let currentUser = null;
        let cart = [];
        let products = [];
        let selectedPayment = null;

        // ============================================
        // INITIALIZATION
        // ============================================
        document.addEventListener('DOMContentLoaded', function() {
            // Load saved cart
            const savedCart = localStorage.getItem('amadeo_cart');
            if (savedCart) {
                cart = JSON.parse(savedCart);
                updateCartUI();
            }

            // Check for saved user
            const savedUser = localStorage.getItem('amadeo_user');
            if (savedUser) {
                currentUser = JSON.parse(savedUser);
                showLoggedInState();
            }

            // Initialize Google Sign-In
            initGoogleSignIn();

            // Set minimum date for delivery
            const tomorrow = new Date();
            tomorrow.setDate(tomorrow.getDate() + 1);
            document.getElementById('deliveryDate').min = tomorrow.toISOString().split('T')[0];

            // Load products
            loadProducts();
        });

        // ============================================
        // GOOGLE SIGN-IN
        // ============================================
        function initGoogleSignIn() {
            if (typeof google !== 'undefined') {
                google.accounts.id.initialize({
                    client_id: CONFIG.GOOGLE_CLIENT_ID,
                    callback: handleCredentialResponse
                });
                
                google.accounts.id.renderButton(
                    document.getElementById('googleSignInDiv'),
                    { 
                        theme: 'outline', 
                        size: 'large',
                        width: 280,
                        text: 'signin_with'
                    }
                );
            }
        }

        function handleCredentialResponse(response) {
            const token = response.credential;
            const payload = parseJwt(token);
            
            currentUser = {
                google_id: payload.sub,
                email: payload.email,
                name: payload.name,
                picture: payload.picture
            };

            // Save to localStorage
            localStorage.setItem('amadeo_user', JSON.stringify(currentUser));

            // Authenticate with backend
            authenticateWithBackend(currentUser);

            // Update UI
            showLoggedInState();
            hideLoginModal();
        }

        function parseJwt(token) {
            const base64Url = token.split('.')[1];
            const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
            const jsonPayload = decodeURIComponent(atob(base64).split('').map(function(c) {
                return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
            }).join(''));
            return JSON.parse(jsonPayload);
        }

        async function authenticateWithBackend(user) {
            try {
                const response = await fetch(CONFIG.BACKEND_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        action: 'authenticateConsumer',
                        data: user
                    })
                });
                const result = await response.json();
                if (result.success) {
                    currentUser = { ...currentUser, ...result.user };
                    localStorage.setItem('amadeo_user', JSON.stringify(currentUser));
                }
            } catch (error) {
                console.error('Auth error:', error);
            }
        }

        function showLoggedInState() {
            document.getElementById('loginBtn').style.display = 'none';
            document.getElementById('userBtn').style.display = 'flex';
            document.getElementById('userAvatar').src = currentUser.picture || 'https://via.placeholder.com/32';
            document.getElementById('userName').textContent = currentUser.name.split(' ')[0];
            document.getElementById('dropdownName').textContent = currentUser.name;
            document.getElementById('dropdownEmail').textContent = currentUser.email;

            // Pre-fill checkout form
            if (document.getElementById('customerName')) {
                document.getElementById('customerName').value = currentUser.name || '';
            }
        }

        function showLoggedOutState() {
            document.getElementById('loginBtn').style.display = 'flex';
            document.getElementById('userBtn').style.display = 'none';
            document.getElementById('userDropdown').classList.remove('show');
        }

        function toggleUserDropdown() {
            document.getElementById('userDropdown').classList.toggle('show');
        }

        function logout() {
            currentUser = null;
            localStorage.removeItem('amadeo_user');
            showLoggedOutState();
            
            if (typeof google !== 'undefined') {
                google.accounts.id.disableAutoSelect();
            }
        }

        // ============================================
        // PRODUCTS
        // ============================================
        async function loadProducts() {
            try {
                // For demo, use sample products
                // Replace with actual API call
                products = getSampleProducts();
                displayProducts(products);
            } catch (error) {
                console.error('Error loading products:', error);
            }
        }

        function getSampleProducts() {
            return [
                {
                    id: 'PROD-001',
                    merchant_id: 'MER-001',
                    merchant_name: "Maria's Carinderia",
                    name: 'Adobo (Family Size)',
                    price: 250,
                    unit: 'per serving',
                    category: 'food',
                    image: 'https://images.unsplash.com/photo-1603133872878-684f208fb84b?w=400',
                    stock: 'in_stock'
                },
                {
                    id: 'PROD-002',
                    merchant_id: 'MER-001',
                    merchant_name: "Maria's Carinderia",
                    name: 'Sinigang na Baboy',
                    price: 280,
                    unit: 'per serving',
                    category: 'food',
                    image: 'https://images.unsplash.com/photo-1455619452474-d2be8b1e70cd?w=400',
                    stock: 'in_stock'
                },
                {
                    id: 'PROD-003',
                    merchant_id: 'MER-002',
                    merchant_name: "Juan's Water Station",
                    name: 'Purified Water (5 Gallons)',
                    price: 50,
                    unit: 'per container',
                    category: 'water',
                    image: 'https://images.unsplash.com/photo-1548839140-29a749e1cf4d?w=400',
                    stock: 'in_stock'
                },
                {
                    id: 'PROD-004',
                    merchant_id: 'MER-002',
                    merchant_name: "Juan's Water Station",
                    name: 'Mineral Water (5 Gallons)',
                    price: 60,
                    unit: 'per container',
                    category: 'water',
                    image: 'https://images.unsplash.com/photo-1560023907-5f339617ea30?w=400',
                    stock: 'in_stock'
                },
                {
                    id: 'PROD-005',
                    merchant_id: 'MER-003',
                    merchant_name: 'Amadeo Fresh Farm',
                    name: 'Fresh Vegetables Bundle',
                    price: 150,
                    unit: 'per bundle',
                    category: 'agriculture',
                    image: 'https://images.unsplash.com/photo-1540420773420-3366772f4999?w=400',
                    stock: 'in_stock'
                },
                {
                    id: 'PROD-006',
                    merchant_id: 'MER-003',
                    merchant_name: 'Amadeo Fresh Farm',
                    name: 'Organic Coffee Beans (500g)',
                    price: 350,
                    unit: 'per pack',
                    category: 'agriculture',
                    image: 'https://images.unsplash.com/photo-1447933601403-0c6688de566e?w=400',
                    stock: 'limited'
                }
            ];
        }

        function displayProducts(productsToShow) {
            const grid = document.getElementById('productsGrid');
            
            if (productsToShow.length === 0) {
                grid.innerHTML = '<p style="text-align: center; color: #666; padding: 40px;">No products found.</p>';
                return;
            }

            grid.innerHTML = productsToShow.map(product => `
                <div class="product-card" data-category="${product.category}">
                    <img src="${product.image}" alt="${product.name}" class="product-image">
                    <div class="product-info">
                        <div class="product-merchant">üè™ ${product.merchant_name}</div>
                        <div class="product-name">${product.name}</div>
                        <div class="product-price">
                            ‚Ç±${product.price.toFixed(2)}
                            <span class="product-unit">${product.unit}</span>
                        </div>
                        <button class="add-to-cart-btn" onclick="addToCart('${product.id}')">
                            üõí Add to Cart
                        </button>
                    </div>
                </div>
            `).join('');
        }

        function searchProducts() {
            const query = document.getElementById('searchInput').value.toLowerCase();
            const filtered = products.filter(p => 
                p.name.toLowerCase().includes(query) || 
                p.merchant_name.toLowerCase().includes(query)
            );
            displayProducts(filtered);
        }

        function filterCategory(category) {
            // Update active button
            document.querySelectorAll('.category-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');

            if (category === 'all') {
                displayProducts(products);
            } else {
                const filtered = products.filter(p => p.category === category);
                displayProducts(filtered);
            }
        }

        // ============================================
        // CART
        // ============================================
        function addToCart(productId) {
            const product = products.find(p => p.id === productId);
            if (!product) return;

            const existingItem = cart.find(item => item.id === productId);
            if (existingItem) {
                existingItem.quantity++;
            } else {
                cart.push({
                    ...product,
                    quantity: 1
                });
            }

            saveCart();
            updateCartUI();
            
            // Show cart
            document.getElementById('cartOverlay').classList.add('show');
            document.getElementById('cartSidebar').classList.add('show');
        }

        function updateCartQuantity(productId, change) {
            const item = cart.find(i => i.id === productId);
            if (item) {
                item.quantity += change;
                if (item.quantity <= 0) {
                    cart = cart.filter(i => i.id !== productId);
                }
                saveCart();
                updateCartUI();
            }
        }

        function removeFromCart(productId) {
            cart = cart.filter(i => i.id !== productId);
            saveCart();
            updateCartUI();
        }

        function saveCart() {
            localStorage.setItem('amadeo_cart', JSON.stringify(cart));
        }

        function updateCartUI() {
            const cartItems = document.getElementById('cartItems');
            const cartCount = document.getElementById('cartCount');
            const cartTotal = document.getElementById('cartTotal');
            const checkoutBtn = document.getElementById('checkoutBtn');

            const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
            const totalPrice = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);

            cartCount.textContent = totalItems;
            cartTotal.textContent = `‚Ç±${totalPrice.toFixed(2)}`;
            checkoutBtn.disabled = cart.length === 0;

            if (cart.length === 0) {
                cartItems.innerHTML = '<div class="cart-empty"><p>Your cart is empty</p></div>';
                return;
            }

            cartItems.innerHTML = cart.map(item => `
                <div class="cart-item">
                    <img src="${item.image}" alt="${item.name}" class="cart-item-image">
                    <div class="cart-item-info">
                        <div class="cart-item-name">${item.name}</div>
                        <div class="cart-item-price">‚Ç±${item.price.toFixed(2)}</div>
                        <div class="cart-item-qty">
                            <button class="qty-btn" onclick="updateCartQuantity('${item.id}', -1)">‚àí</button>
                            <span>${item.quantity}</span>
                            <button class="qty-btn" onclick="updateCartQuantity('${item.id}', 1)">+</button>
                            <button class="cart-item-remove" onclick="removeFromCart('${item.id}')">üóëÔ∏è</button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function toggleCart() {
            document.getElementById('cartOverlay').classList.toggle('show');
            document.getElementById('cartSidebar').classList.toggle('show');
        }

        // ============================================
        // CHECKOUT
        // ============================================
        function proceedToCheckout() {
            if (!currentUser) {
                showLoginModal();
                return;
            }

            if (cart.length === 0) {
                alert('Your cart is empty');
                return;
            }

            // Close cart sidebar
            toggleCart();

            // Update checkout summary
            updateCheckoutSummary();

            // Pre-fill user info
            document.getElementById('customerName').value = currentUser.name || '';

            // Show checkout modal
            document.getElementById('checkoutModal').classList.add('show');
        }

        function updateCheckoutSummary() {
            const checkoutItems = document.getElementById('checkoutItems');
            const subtotal = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            const fee = subtotal * CONFIG.PLATFORM_FEE;
            const total = subtotal + fee;

            checkoutItems.innerHTML = cart.map(item => `
                <div class="summary-item">
                    <span>${item.name} √ó ${item.quantity}</span>
                    <span>‚Ç±${(item.price * item.quantity).toFixed(2)}</span>
                </div>
            `).join('');

            document.getElementById('summarySubtotal').textContent = `‚Ç±${subtotal.toFixed(2)}`;
            document.getElementById('summaryFee').textContent = `‚Ç±${fee.toFixed(2)}`;
            document.getElementById('summaryTotal').textContent = `‚Ç±${total.toFixed(2)}`;
        }

        function selectPayment(method) {
            selectedPayment = method;
            
            document.getElementById('codOption').classList.remove('selected');
            document.getElementById('onlineOption').classList.remove('selected');
            
            if (method === 'COD') {
                document.getElementById('codOption').classList.add('selected');
                document.getElementById('paymentDetails').classList.remove('show');
            } else {
                document.getElementById('onlineOption').classList.add('selected');
                document.getElementById('paymentDetails').classList.add('show');
            }
        }

        function previewPaymentProof(input) {
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const preview = document.getElementById('uploadPreview');
                    preview.src = e.target.result;
                    preview.style.display = 'block';
                    document.getElementById('uploadArea').classList.add('has-file');
                    document.querySelector('#uploadArea .upload-text').textContent = 'Payment proof uploaded ‚úì';
                };
                reader.readAsDataURL(input.files[0]);
            }
        }

        async function submitOrder(event) {
            event.preventDefault();

            // Validate payment method
            if (!selectedPayment) {
                alert('Please select a payment method');
                return;
            }

            // Validate online payment proof
            if (selectedPayment === 'ONLINE') {
                const proofFile = document.getElementById('paymentProof').files[0];
                if (!proofFile) {
                    alert('Please upload your payment proof screenshot');
                    return;
                }
            }

            // Validate legal agreements
            if (!document.getElementById('agreeTerms').checked ||
                !document.getElementById('agreeRefund').checked ||
                !document.getElementById('agreeAccuracy').checked) {
                alert('Please agree to all terms and conditions');
                return;
            }

            // Show loading
            document.getElementById('loadingOverlay').classList.add('show');

            try {
                // Prepare order data
                const subtotal = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
                const fee = subtotal * CONFIG.PLATFORM_FEE;
                const total = subtotal + fee;

                const orderData = {
                    customer: {
                        user_id: currentUser.user_id,
                        google_id: currentUser.google_id,
                        name: document.getElementById('customerName').value,
                        email: currentUser.email,
                        mobile: document.getElementById('customerMobile').value,
                        address: document.getElementById('customerAddress').value
                    },
                    delivery: {
                        date: document.getElementById('deliveryDate').value,
                        time: document.getElementById('deliveryTime').value,
                        instructions: document.getElementById('specialInstructions').value
                    },
                    items: cart.map(item => ({
                        product_id: item.id,
                        merchant_id: item.merchant_id,
                        merchant_name: item.merchant_name,
                        name: item.name,
                        price: item.price,
                        quantity: item.quantity,
                        subtotal: item.price * item.quantity
                    })),
                    payment: {
                        method: selectedPayment,
                        subtotal: subtotal,
                        platform_fee: fee,
                        total: total
                    },
                    agreements: {
                        terms_accepted: true,
                        refund_policy_accepted: true,
                        accuracy_confirmed: true,
                        timestamp: new Date().toISOString()
                    }
                };

                // Upload payment proof if online payment
                if (selectedPayment === 'ONLINE') {
                    const proofFile = document.getElementById('paymentProof').files[0];
                    orderData.payment.proof = await fileToBase64(proofFile);
                    orderData.payment.proof_filename = proofFile.name;
                }

                // Submit order to backend
                const response = await fetch(CONFIG.BACKEND_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        action: 'submitOrder',
                        data: orderData
                    })
                });

                const result = await response.json();

                if (result.success) {
                    // Clear cart
                    cart = [];
                    saveCart();
                    updateCartUI();

                    // Show success
                    document.getElementById('successOrderId').textContent = result.orderId;
                    document.getElementById('loadingOverlay').classList.remove('show');
                    document.getElementById('checkoutModal').classList.remove('show');
                    document.getElementById('successModal').classList.add('show');

                    // Reset form
                    document.getElementById('checkoutForm').reset();
                    selectedPayment = null;
                    document.getElementById('paymentDetails').classList.remove('show');
                    document.getElementById('uploadPreview').style.display = 'none';
                    document.getElementById('uploadArea').classList.remove('has-file');
                } else {
                    throw new Error(result.message || 'Failed to submit order');
                }

            } catch (error) {
                console.error('Order error:', error);
                document.getElementById('loadingOverlay').classList.remove('show');
                alert('Error submitting order: ' + error.message);
            }
        }

        function fileToBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = () => resolve(reader.result);
                reader.onerror = error => reject(error);
            });
        }

        // ============================================
        // MODALS
        // ============================================
        function showLoginModal() {
            document.getElementById('loginModal').classList.add('show');
        }

        function hideLoginModal() {
            document.getElementById('loginModal').classList.remove('show');
        }

        function hideCheckoutModal() {
            document.getElementById('checkoutModal').classList.remove('show');
        }

        function showTermsModal(event) {
            if (event) event.preventDefault();
            document.getElementById('termsModal').classList.add('show');
        }

        function hideTermsModal() {
            document.getElementById('termsModal').classList.remove('show');
        }

        function showPrivacyModal(event) {
            if (event) event.preventDefault();
            document.getElementById('privacyModal').classList.add('show');
        }

        function hidePrivacyModal() {
            document.getElementById('privacyModal').classList.remove('show');
        }

        function showRefundModal(event) {
            if (event) event.preventDefault();
            document.getElementById('refundModal').classList.add('show');
        }

        function hideRefundModal() {
            document.getElementById('refundModal').classList.remove('show');
        }

        fun