<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Merchant Dashboard - Amadeo Marketplace</title>
    <style>
        :root{--p:#0f766e;--pd:#134e4a;--pl:#14b8a6;--r:#ef4444;--g:#22c55e;--o:#f97316;--y:#eab308;--v:#7c3aed;--b:#3b82f6;--g1:#f9fafb;--g2:#e5e7eb;--g3:#d1d5db;--g5:#6b7280;--g7:#374151;--g9:#111827;--sh:0 4px 6px -1px rgba(0,0,0,0.1);--rd:12px}
        *{margin:0;padding:0;box-sizing:border-box}
        body{font-family:system-ui,-apple-system,sans-serif;background:var(--g1);color:var(--g9);line-height:1.5}
        
        /* LAYOUT */
        .app{display:flex;min-height:100vh}
        .sidebar{width:260px;background:var(--pd);color:#fff;position:fixed;height:100vh;overflow-y:auto;z-index:100}
        .main{flex:1;margin-left:260px;min-height:100vh}
        @media(max-width:900px){.sidebar{transform:translateX(-100%);transition:transform .3s}.sidebar.open{transform:translateX(0)}.main{margin-left:0}}
        
        /* SIDEBAR */
        .sidebar-header{padding:20px;border-bottom:1px solid rgba(255,255,255,.1)}
        .logo{font-size:18px;font-weight:700;display:flex;align-items:center;gap:10px}
        .logo a{color:#fff;text-decoration:none}
        .merchant-info{margin-top:15px;padding:12px;background:rgba(255,255,255,.1);border-radius:8px}
        .merchant-name{font-weight:600;font-size:14px}
        .merchant-id{font-size:11px;opacity:.7;margin-top:2px}
        
        .nav{padding:15px 0}
        .nav-section{padding:10px 20px;font-size:11px;text-transform:uppercase;opacity:.5;letter-spacing:1px}
        .nav a{display:flex;align-items:center;gap:12px;padding:12px 20px;color:rgba(255,255,255,.8);text-decoration:none;font-size:14px;transition:all .2s;border-left:3px solid transparent}
        .nav a:hover{background:rgba(255,255,255,.1);color:#fff}
        .nav a.active{background:rgba(255,255,255,.15);color:#fff;border-left-color:var(--pl)}
        .nav .icon{font-size:18px;width:24px;text-align:center}
        .nav .badge{background:var(--o);padding:2px 8px;border-radius:10px;font-size:10px;margin-left:auto}
        
        .sidebar-footer{padding:20px;border-top:1px solid rgba(255,255,255,.1);margin-top:auto}
        .btn-logout{width:100%;padding:10px;background:rgba(255,255,255,.1);border:none;color:#fff;border-radius:6px;cursor:pointer;font-size:13px}
        .btn-logout:hover{background:rgba(255,255,255,.2)}
        
        /* HEADER */
        .header{background:#fff;padding:15px 24px;box-shadow:var(--sh);display:flex;justify-content:space-between;align-items:center;position:sticky;top:0;z-index:50}
        .header-left{display:flex;align-items:center;gap:15px}
        .menu-toggle{display:none;background:none;border:none;font-size:24px;cursor:pointer}
        @media(max-width:900px){.menu-toggle{display:block}}
        .page-title{font-size:20px;font-weight:600;color:var(--g9)}
        .header-right{display:flex;align-items:center;gap:15px}
        .notif-btn{background:none;border:none;font-size:20px;cursor:pointer;position:relative}
        .notif-badge{position:absolute;top:-5px;right:-5px;background:var(--r);color:#fff;width:16px;height:16px;border-radius:50%;font-size:10px;display:flex;align-items:center;justify-content:center}
        .view-store{padding:8px 16px;background:var(--p);color:#fff;border-radius:6px;text-decoration:none;font-size:13px;font-weight:500}
        
        /* CONTENT */
        .content{padding:24px}
        
        /* STATS GRID */
        .stats-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:20px;margin-bottom:30px}
        .stat-card{background:#fff;padding:20px;border-radius:var(--rd);box-shadow:var(--sh)}
        .stat-card .label{font-size:13px;color:var(--g5);margin-bottom:8px}
        .stat-card .value{font-size:28px;font-weight:700;color:var(--g9)}
        .stat-card .change{font-size:12px;margin-top:8px;display:flex;align-items:center;gap:5px}
        .stat-card .change.up{color:var(--g)}
        .stat-card .change.down{color:var(--r)}
        .stat-card.highlight{background:linear-gradient(135deg,var(--p),var(--pl));color:#fff}
        .stat-card.highlight .label,.stat-card.highlight .value{color:#fff}
        
        /* CARDS */
        .card{background:#fff;border-radius:var(--rd);box-shadow:var(--sh);margin-bottom:24px}
        .card-header{padding:16px 20px;border-bottom:1px solid var(--g2);display:flex;justify-content:space-between;align-items:center}
        .card-title{font-size:16px;font-weight:600;color:var(--g9)}
        .card-body{padding:20px}
        
        /* TABLES */
        .table-wrap{overflow-x:auto}
        table{width:100%;border-collapse:collapse;font-size:14px}
        th{text-align:left;padding:12px 16px;background:var(--g1);color:var(--g5);font-weight:600;font-size:12px;text-transform:uppercase;letter-spacing:.5px}
        td{padding:12px 16px;border-bottom:1px solid var(--g1)}
        tr:hover{background:var(--g1)}
        .status{padding:4px 12px;border-radius:20px;font-size:11px;font-weight:600}
        .status-pending{background:#fef3c7;color:#d97706}
        .status-confirmed{background:#dbeafe;color:#2563eb}
        .status-preparing{background:#e0e7ff;color:#4f46e5}
        .status-out_for_delivery{background:#cffafe;color:#0891b2}
        .status-delivered,.status-completed,.status-active{background:#dcfce7;color:#16a34a}
        .status-cancelled,.status-inactive{background:#fee2e2;color:#dc2626}
        
        /* BUTTONS */
        .btn{padding:8px 16px;border-radius:6px;font-size:13px;font-weight:600;cursor:pointer;border:none;transition:all .2s;display:inline-flex;align-items:center;gap:6px}
        .btn-primary{background:var(--p);color:#fff}
        .btn-primary:hover{background:var(--pd)}
        .btn-success{background:var(--g);color:#fff}
        .btn-warning{background:var(--o);color:#fff}
        .btn-danger{background:var(--r);color:#fff}
        .btn-outline{background:#fff;border:1px solid var(--g2);color:var(--g7)}
        .btn-outline:hover{border-color:var(--p);color:var(--p)}
        .btn-sm{padding:6px 12px;font-size:12px}
        .btn-group{display:flex;gap:8px}
        
        /* FORMS */
        .form-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:16px}
        .form-group{margin-bottom:16px}
        .form-group label{display:block;font-size:13px;font-weight:600;color:var(--g7);margin-bottom:6px}
        .form-group input,.form-group select,.form-group textarea{width:100%;padding:10px 12px;border:1px solid var(--g2);border-radius:8px;font-size:14px;font-family:inherit}
        .form-group input:focus,.form-group select:focus,.form-group textarea:focus{outline:none;border-color:var(--p)}
        .form-row{display:flex;gap:16px}
        .form-row>*{flex:1}
        
        /* MODAL */
        .modal-bg{position:fixed;inset:0;background:rgba(0,0,0,.5);z-index:200;display:none;align-items:flex-start;justify-content:center;padding:20px;overflow-y:auto}
        .modal-bg.open{display:flex}
        .modal{background:#fff;border-radius:var(--rd);width:100%;max-width:600px;margin:40px auto;animation:slideUp .3s}
        @keyframes slideUp{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}
        .modal-header{padding:16px 20px;border-bottom:1px solid var(--g2);display:flex;justify-content:space-between;align-items:center}
        .modal-header h2{font-size:18px;color:var(--p)}
        .modal-close{background:none;border:none;font-size:24px;cursor:pointer;color:var(--g5)}
        .modal-body{padding:20px;max-height:70vh;overflow-y:auto}
        .modal-footer{padding:16px 20px;border-top:1px solid var(--g2);display:flex;justify-content:flex-end;gap:10px}
        
        /* TABS */
        .tabs{display:flex;gap:5px;margin-bottom:20px;border-bottom:2px solid var(--g2);padding-bottom:0}
        .tab-btn{padding:12px 20px;border:none;background:none;cursor:pointer;font-weight:500;font-size:14px;color:var(--g5);border-bottom:2px solid transparent;margin-bottom:-2px;transition:all .2s}
        .tab-btn:hover{color:var(--p)}
        .tab-btn.active{color:var(--p);border-bottom-color:var(--p)}
        
        /* EMPTY STATE */
        .empty{text-align:center;padding:60px 20px}
        .empty .icon{font-size:60px;margin-bottom:16px}
        .empty h3{color:var(--g7);margin-bottom:8px}
        .empty p{color:var(--g5);font-size:14px;margin-bottom:20px}
        
        /* LOADING */
        .loading{text-align:center;padding:40px}
        .spinner{width:36px;height:36px;border:3px solid var(--g2);border-top-color:var(--p);border-radius:50%;animation:spin .7s linear infinite;margin:0 auto 12px}
        @keyframes spin{to{transform:rotate(360deg)}}
        
        /* TOAST */
        .toast{position:fixed;bottom:20px;right:20px;background:var(--p);color:#fff;padding:12px 24px;border-radius:8px;box-shadow:var(--sh);z-index:1000;animation:slideIn .3s}
        @keyframes slideIn{from{transform:translateX(100%);opacity:0}to{transform:translateX(0);opacity:1}}
        
        /* SECTION HIDE */
        .section{display:none}
        .section.active{display:block}
        
        /* PRODUCT/SERVICE CARDS */
        .item-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:20px}
        .item-card{background:#fff;border-radius:var(--rd);box-shadow:var(--sh);overflow:hidden}
        .item-img{height:140px;background:linear-gradient(135deg,#ccfbf1,#99f6e4);display:flex;align-items:center;justify-content:center;font-size:40px}
        .item-img img{width:100%;height:100%;object-fit:cover}
        .item-body{padding:16px}
        .item-name{font-weight:600;font-size:15px;margin-bottom:4px}
        .item-meta{font-size:12px;color:var(--g5);margin-bottom:8px}
        .item-price{font-size:18px;font-weight:700;color:var(--p);margin-bottom:12px}
        .item-actions{display:flex;gap:8px}
        
        /* QUICK STATS */
        .quick-stats{display:flex;gap:20px;margin-bottom:20px;flex-wrap:wrap}
        .quick-stat{background:#fff;padding:12px 20px;border-radius:8px;box-shadow:var(--sh);display:flex;align-items:center;gap:12px}
        .quick-stat .icon{font-size:24px}
        .quick-stat .info .num{font-size:20px;font-weight:700;color:var(--p)}
        .quick-stat .info .label{font-size:11px;color:var(--g5)}
        
        /* ACTION ROW */
        .action-row{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;flex-wrap:wrap;gap:15px}
        .search-box{display:flex;gap:10px}
        .search-box input{padding:10px 16px;border:1px solid var(--g2);border-radius:8px;width:250px;font-size:14px}
        .filter-select{padding:10px 16px;border:1px solid var(--g2);border-radius:8px;font-size:14px}
        
        /* CHART PLACEHOLDER */
        .chart-placeholder{height:200px;background:var(--g1);border-radius:8px;display:flex;align-items:center;justify-content:center;color:var(--g5)}
        
        /* RESPONSIVE */
        @media(max-width:600px){
            .stats-grid{grid-template-columns:1fr 1fr}
            .form-row{flex-direction:column}
            .action-row{flex-direction:column;align-items:stretch}
            .search-box{flex-direction:column}
            .search-box input{width:100%}
        }
    </style>
</head>
<body>
    <div class="app">
        <!-- SIDEBAR -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="logo"><a href="/">üè™ Amadeo Marketplace</a></div>
                <div class="merchant-info">
                    <div class="merchant-name" id="merchantName">Loading...</div>
                    <div class="merchant-id" id="merchantId">-</div>
                </div>
            </div>
            
            <nav class="nav">
                <div class="nav-section">Main</div>
                <a href="#dashboard" class="active" onclick="showSection('dashboard')"><span class="icon">üìä</span> Dashboard</a>
                <a href="#orders" onclick="showSection('orders')"><span class="icon">üì¶</span> Orders <span class="badge" id="ordersBadge">0</span></a>
                
                <div class="nav-section">Manage</div>
                <a href="#products" onclick="showSection('products')"><span class="icon">üõçÔ∏è</span> Products</a>
                <a href="#services" onclick="showSection('services')"><span class="icon">üîß</span> Services</a>
                <a href="#stays" onclick="showSection('stays')"><span class="icon">üè°</span> Properties</a>
                
                <div class="nav-section">Finance</div>
                <a href="#earnings" onclick="showSection('earnings')"><span class="icon">üí∞</span> Earnings</a>
                
                <div class="nav-section">Account</div>
                <a href="#settings" onclick="showSection('settings')"><span class="icon">‚öôÔ∏è</span> Settings</a>
            </nav>
            
            <div class="sidebar-footer">
                <button class="btn-logout" onclick="logout()">üö™ Logout</button>
            </div>
        </aside>
        
        <!-- MAIN -->
        <main class="main">
            <header class="header">
                <div class="header-left">
                    <button class="menu-toggle" onclick="toggleSidebar()">‚ò∞</button>
                    <h1 class="page-title" id="pageTitle">Dashboard</h1>
                </div>
                <div class="header-right">
                    <button class="notif-btn">üîî<span class="notif-badge" id="notifBadge">0</span></button>
                    <a href="/" class="view-store">View Store</a>
                </div>
            </header>
            
            <div class="content">
                <!-- DASHBOARD -->
                <section id="dashboard" class="section active">
                    <div class="stats-grid">
                        <div class="stat-card highlight">
                            <div class="label">Today's Revenue</div>
                            <div class="value" id="todayRevenue">‚Ç±0</div>
                            <div class="change up">üìà From orders today</div>
                        </div>
                        <div class="stat-card">
                            <div class="label">Total Orders</div>
                            <div class="value" id="totalOrders">0</div>
                        </div>
                        <div class="stat-card">
                            <div class="label">Pending Orders</div>
                            <div class="value" id="pendingOrders">0</div>
                        </div>
                        <div class="stat-card">
                            <div class="label">Products</div>
                            <div class="value" id="totalProducts">0</div>
                        </div>
                    </div>
                    
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">üì¶ Recent Orders</div>
                            <a href="#orders" onclick="showSection('orders')" class="btn btn-outline btn-sm">View All</a>
                        </div>
                        <div class="card-body">
                            <div class="table-wrap">
                                <table>
                                    <thead>
                                        <tr><th>Order ID</th><th>Customer</th><th>Items</th><th>Total</th><th>Status</th><th>Action</th></tr>
                                    </thead>
                                    <tbody id="recentOrders">
                                        <tr><td colspan="6" class="loading"><div class="spinner"></div></td></tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">üìà Sales Overview (This Month)</div>
                        </div>
                        <div class="card-body">
                            <div class="chart-placeholder">üìä Sales chart coming soon</div>
                        </div>
                    </div>
                </section>
                
                <!-- ORDERS -->
                <section id="orders" class="section">
                    <div class="action-row">
                        <div class="tabs" style="margin-bottom:0;border:none;padding:0">
                            <button class="tab-btn active" onclick="filterOrders('all')">All</button>
                            <button class="tab-btn" onclick="filterOrders('pending')">Pending</button>
                            <button class="tab-btn" onclick="filterOrders('confirmed')">Confirmed</button>
                            <button class="tab-btn" onclick="filterOrders('delivered')">Delivered</button>
                        </div>
                        <div class="search-box">
                            <input type="text" id="orderSearch" placeholder="Search orders..." oninput="searchOrders(this.value)">
                        </div>
                    </div>
                    
                    <div class="card">
                        <div class="card-body" style="padding:0">
                            <div class="table-wrap">
                                <table>
                                    <thead>
                                        <tr><th>Order ID</th><th>Date</th><th>Customer</th><th>Items</th><th>Total</th><th>Payment</th><th>Status</th><th>Actions</th></tr>
                                    </thead>
                                    <tbody id="ordersTable">
                                        <tr><td colspan="8" class="loading"><div class="spinner"></div></td></tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </section>
                
                <!-- PRODUCTS -->
                <section id="products" class="section">
                    <div class="action-row">
                        <div class="quick-stats">
                            <div class="quick-stat"><span class="icon">üì¶</span><div class="info"><div class="num" id="prodActive">0</div><div class="label">Active</div></div></div>
                            <div class="quick-stat"><span class="icon">‚ö†Ô∏è</span><div class="info"><div class="num" id="prodLow">0</div><div class="label">Low Stock</div></div></div>
                        </div>
                        <button class="btn btn-primary" onclick="openProductModal()">+ Add Product</button>
                    </div>
                    
                    <div class="item-grid" id="productsGrid">
                        <div class="loading"><div class="spinner"></div></div>
                    </div>
                </section>
                
                <!-- SERVICES -->
                <section id="services" class="section">
                    <div class="action-row">
                        <div class="quick-stats">
                            <div class="quick-stat"><span class="icon">üîß</span><div class="info"><div class="num" id="svcActive">0</div><div class="label">Active Services</div></div></div>
                            <div class="quick-stat"><span class="icon">üìÖ</span><div class="info"><div class="num" id="svcBookings">0</div><div class="label">Bookings</div></div></div>
                        </div>
                        <button class="btn btn-primary" onclick="openServiceModal()">+ Add Service</button>
                    </div>
                    
                    <div class="item-grid" id="servicesGrid">
                        <div class="empty">
                            <div class="icon">üîß</div>
                            <h3>No Services Yet</h3>
                            <p>Add services like laundry, beauty, massage, repairs</p>
                            <button class="btn btn-primary" onclick="openServiceModal()">Add Your First Service</button>
                        </div>
                    </div>
                </section>
                
                <!-- STAYS/PROPERTIES -->
                <section id="stays" class="section">
                    <div class="action-row">
                        <div class="quick-stats">
                            <div class="quick-stat"><span class="icon">üè°</span><div class="info"><div class="num" id="propActive">0</div><div class="label">Listed</div></div></div>
                            <div class="quick-stat"><span class="icon">üìÖ</span><div class="info"><div class="num" id="propBookings">0</div><div class="label">Bookings</div></div></div>
                        </div>
                        <button class="btn btn-primary" onclick="openPropertyModal()">+ Add Property</button>
                    </div>
                    
                    <div class="item-grid" id="propertiesGrid">
                        <div class="empty">
                            <div class="icon">üè°</div>
                            <h3>No Properties Yet</h3>
                            <p>List your private pool, rest house, or venue</p>
                            <button class="btn btn-primary" onclick="openPropertyModal()">Add Your First Property</button>
                        </div>
                    </div>
                </section>
                
                <!-- EARNINGS -->
                <section id="earnings" class="section">
                    <div class="stats-grid">
                        <div class="stat-card highlight">
                            <div class="label">Total Earnings</div>
                            <div class="value" id="totalEarnings">‚Ç±0</div>
                        </div>
                        <div class="stat-card">
                            <div class="label">This Month</div>
                            <div class="value" id="monthEarnings">‚Ç±0</div>
                        </div>
                        <div class="stat-card">
                            <div class="label">Pending Payout</div>
                            <div class="value" id="pendingPayout">‚Ç±0</div>
                        </div>
                        <div class="stat-card">
                            <div class="label">Platform Fees</div>
                            <div class="value" id="totalFees">‚Ç±0</div>
                        </div>
                    </div>
                    
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">üí∞ Transaction History</div>
                        </div>
                        <div class="card-body">
                            <div class="table-wrap">
                                <table>
                                    <thead>
                                        <tr><th>Date</th><th>Order ID</th><th>Type</th><th>Amount</th><th>Fee</th><th>Net</th></tr>
                                    </thead>
                                    <tbody id="earningsTable">
                                        <tr><td colspan="6" style="text-align:center;padding:40px;color:var(--g5)">Earnings will appear here after completed orders</td></tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </section>
                
                <!-- SETTINGS -->
                <section id="settings" class="section">
                    <div class="card">
                        <div class="card-header"><div class="card-title">üè™ Business Information</div></div>
                        <div class="card-body">
                            <form id="settingsForm" onsubmit="saveSettings(event)">
                                <div class="form-grid">
                                    <div class="form-group"><label>Business Name *</label><input type="text" id="setBizName" required></div>
                                    <div class="form-group"><label>Owner Name *</label><input type="text" id="setOwner" required></div>
                                    <div class="form-group"><label>Phone *</label><input type="tel" id="setPhone" required></div>
                                    <div class="form-group"><label>Email</label><input type="email" id="setEmail"></div>
                                    <div class="form-group"><label>Barangay</label>
                                        <select id="setBrgy">
                                            <option value="">Select Barangay</option>
                                            <option>Barangay I (Poblacion)</option>
                                            <option>Barangay II (Poblacion)</option>
                                            <option>Barangay III (Poblacion)</option>
                                            <option>Barangay IV (Poblacion)</option>
                                            <option>Barangay V (Poblacion)</option>
                                            <option>Barangay VI (Poblacion)</option>
                                            <option>Barangay VII (Poblacion)</option>
                                            <option>Barangay VIII (Poblacion)</option>
                                            <option>Banaybanay</option>
                                            <option>Buho</option>
                                            <option>Dagatan</option>
                                            <option>Halang</option>
                                            <option>Lalaan I</option>
                                            <option>Lalaan II</option>
                                            <option>Loma</option>
                                            <option>Lucsuhin</option>
                                            <option>Lukong</option>
                                            <option>Maymangga</option>
                                            <option>Minantok Kanluran</option>
                                            <option>Minantok Silangan</option>
                                            <option>Pangil</option>
                                            <option>Salaban</option>
                                            <option>Taywanak Ibaba</option>
                                            <option>Taywanak Ilaya</option>
                                            <option>Tibig</option>
                                            <option>Ulo</option>
                                        </select>
                                    </div>
                                    <div class="form-group"><label>Category</label>
                                        <select id="setCategory">
                                            <option>Food & Beverages</option>
                                            <option>Fresh Produce</option>
                                            <option>Groceries</option>
                                            <option>Health & Beauty</option>
                                            <option>Home & Living</option>
                                            <option>Fashion</option>
                                            <option>Electronics</option>
                                            <option>Services</option>
                                            <option>Plants & Garden</option>
                                            <option>Pet Supplies</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="form-group"><label>Business Description</label><textarea id="setDesc" rows="3" placeholder="Tell customers about your business..."></textarea></div>
                                <button type="submit" class="btn btn-primary">Save Changes</button>
                            </form>
                        </div>
                    </div>
                    
                    <div class="card">
                        <div class="card-header"><div class="card-title">üí≥ Payout Settings</div></div>
                        <div class="card-body">
                            <div class="form-grid">
                                <div class="form-group"><label>GCash Number</label><input type="tel" id="setGcash" placeholder="09XX XXX XXXX"></div>
                                <div class="form-group"><label>Bank Account</label><input type="text" id="setBank" placeholder="Bank name - Account number"></div>
                            </div>
                            <button class="btn btn-outline" onclick="savePayoutSettings()">Update Payout Info</button>
                        </div>
                    </div>
                </section>
            </div>
        </main>
    </div>
    
    <!-- ORDER DETAIL MODAL -->
    <div class="modal-bg" id="orderModal">
        <div class="modal">
            <div class="modal-header"><h2>Order Details</h2><button class="modal-close" onclick="closeModal('orderModal')">√ó</button></div>
            <div class="modal-body" id="orderModalBody"></div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeModal('orderModal')">Close</button>
                <button class="btn btn-success" id="confirmOrderBtn" onclick="updateOrderStatus('confirmed')">‚úì Confirm</button>
            </div>
        </div>
    </div>
    
    <!-- PRODUCT MODAL -->
    <div class="modal-bg" id="productModal">
        <div class="modal">
            <div class="modal-header"><h2 id="productModalTitle">Add Product</h2><button class="modal-close" onclick="closeModal('productModal')">√ó</button></div>
            <div class="modal-body">
                <form id="productForm" onsubmit="saveProduct(event)">
                    <input type="hidden" id="prodId">
                    <div class="form-group"><label>Product Name *</label><input type="text" id="prodName" required></div>
                    <div class="form-row">
                        <div class="form-group"><label>Price (‚Ç±) *</label><input type="number" id="prodPrice" min="0" step="0.01" required></div>
                        <div class="form-group"><label>Stock *</label><input type="number" id="prodStock" min="0" required></div>
                    </div>
                    <div class="form-group"><label>Category *</label>
                        <select id="prodCategory" required>
                            <option value="">Select</option>
                            <option>Food & Beverages</option>
                            <option>Fresh Produce</option>
                            <option>Groceries</option>
                            <option>Health & Beauty</option>
                            <option>Home & Living</option>
                            <option>Fashion</option>
                            <option>Electronics</option>
                            <option>Plants & Garden</option>
                            <option>Pet Supplies</option>
                        </select>
                    </div>
                    <div class="form-group"><label>Description</label><textarea id="prodDesc" rows="3"></textarea></div>
                    <div class="form-group"><label>Image URL</label><input type="url" id="prodImage" placeholder="https://..."></div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeModal('productModal')">Cancel</button>
                <button class="btn btn-primary" onclick="document.getElementById('productForm').requestSubmit()">Save Product</button>
            </div>
        </div>
    </div>
    
    <!-- SERVICE MODAL -->
    <div class="modal-bg" id="serviceModal">
        <div class="modal">
            <div class="modal-header"><h2>Add Service</h2><button class="modal-close" onclick="closeModal('serviceModal')">√ó</button></div>
            <div class="modal-body">
                <form id="serviceForm" onsubmit="saveService(event)">
                    <input type="hidden" id="svcId">
                    <div class="form-group"><label>Service Name *</label><input type="text" id="svcName" required placeholder="e.g., Wash & Fold Laundry"></div>
                    <div class="form-row">
                        <div class="form-group"><label>Price (‚Ç±) *</label><input type="number" id="svcPrice" min="0" required></div>
                        <div class="form-group"><label>Price Type *</label>
                            <select id="svcPriceType" required>
                                <option value="fixed">Fixed Price</option>
                                <option value="per_hour">Per Hour</option>
                                <option value="per_kilo">Per Kilo</option>
                                <option value="per_sqm">Per Sqm</option>
                                <option value="per_unit">Per Unit</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group"><label>Category *</label>
                        <select id="svcCategory" required>
                            <option value="">Select</option>
                            <option>Laundry</option>
                            <option>Beauty</option>
                            <option>Massage</option>
                            <option>Home Repair</option>
                            <option>Cleaning</option>
                            <option>Automotive</option>
                            <option>Tech</option>
                            <option>Pet</option>
                            <option>Events</option>
                            <option>Tutoring</option>
                        </select>
                    </div>
                    <div class="form-row">
                        <div class="form-group"><label>Duration</label><input type="text" id="svcDuration" placeholder="e.g., 1-2 hours"></div>
                        <div class="form-group"><label>Service Type</label>
                            <select id="svcType">
                                <option value="both">Home Service & Shop Visit</option>
                                <option value="home">Home Service Only</option>
                                <option value="shop">Shop Visit Only</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group"><label>Description</label><textarea id="svcDesc" rows="3"></textarea></div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeModal('serviceModal')">Cancel</button>
                <button class="btn btn-primary" onclick="document.getElementById('serviceForm').requestSubmit()">Save Service</button>
            </div>
        </div>
    </div>
    
    <!-- PROPERTY MODAL -->
    <div class="modal-bg" id="propertyModal">
        <div class="modal">
            <div class="modal-header"><h2>Add Property</h2><button class="modal-close" onclick="closeModal('propertyModal')">√ó</button></div>
            <div class="modal-body">
                <form id="propertyForm" onsubmit="saveProperty(event)">
                    <input type="hidden" id="propId">
                    <div class="form-group"><label>Property Name *</label><input type="text" id="propName" required placeholder="e.g., Mountain View Private Pool"></div>
                    <div class="form-row">
                        <div class="form-group"><label>Type *</label>
                            <select id="propType" required>
                                <option value="">Select</option>
                                <option>Private Pool</option>
                                <option>Rest House</option>
                                <option>Resort</option>
                                <option>Farm Stay</option>
                                <option>Cabin</option>
                                <option>Venue</option>
                            </select>
                        </div>
                        <div class="form-group"><label>Location (Barangay) *</label>
                            <select id="propLocation" required>
                                <option value="">Select Barangay</option>
                                <option>Barangay I (Poblacion)</option>
                                <option>Barangay II (Poblacion)</option>
                                <option>Barangay III (Poblacion)</option>
                                <option>Barangay IV (Poblacion)</option>
                                <option>Barangay V (Poblacion)</option>
                                <option>Barangay VI (Poblacion)</option>
                                <option>Barangay VII (Poblacion)</option>
                                <option>Barangay VIII (Poblacion)</option>
                                <option>Banaybanay</option>
                                <option>Buho</option>
                                <option>Dagatan</option>
                                <option>Halang</option>
                                <option>Lalaan I</option>
                                <option>Lalaan II</option>
                                <option>Loma</option>
                                <option>Lucsuhin</option>
                                <option>Lukong</option>
                                <option>Maymangga</option>
                                <option>Minantok Kanluran</option>
                                <option>Minantok Silangan</option>
                                <option>Pangil</option>
                                <option>Salaban</option>
                                <option>Taywanak Ibaba</option>
                                <option>Taywanak Ilaya</option>
                                <option>Tibig</option>
                                <option>Ulo</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group"><label>Weekday Rate (‚Ç±) *</label><input type="number" id="propWeekday" min="0" required></div>
                        <div class="form-group"><label>Weekend Rate (‚Ç±) *</label><input type="number" id="propWeekend" min="0" required></div>
                    </div>
                    <div class="form-row">
                        <div class="form-group"><label>Max Guests *</label><input type="number" id="propGuests" min="1" required></div>
                        <div class="form-group"><label>Bedrooms</label><input type="number" id="propBeds" min="0"></div>
                        <div class="form-group"><label>Bathrooms</label><input type="number" id="propBaths" min="0"></div>
                    </div>
                    <div class="form-group"><label>Cleaning Fee (‚Ç±)</label><input type="number" id="propClean" min="0"></div>
                    <div class="form-group"><label>Amenities</label><input type="text" id="propAmenities" placeholder="Pool, WiFi, Parking, BBQ, Karaoke (comma separated)"></div>
                    <div class="form-group"><label>Description</label><textarea id="propDesc" rows="3"></textarea></div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeModal('propertyModal')">Cancel</button>
                <button class="btn btn-primary" onclick="document.getElementById('propertyForm').requestSubmit()">Save Property</button>
            </div>
        </div>
    </div>
    
    <script>
    var API='https://script.google.com/macros/s/AKfycbwgHmmK1j8a6rqx_Zfk5nPGqdUIRSo1oIUNgGoVr2-in988F3K8Kyp8PN15zHS3InIUgw/exec';
    var merchant=null;
    var orders=[];
    var products=[];
    var services=[];
    var properties=[];
    var currentOrderFilter='all';
    var selectedOrder=null;
    
    document.addEventListener('DOMContentLoaded',function(){
        loadMerchant();
        checkHash();
    });
    
    function checkHash(){
        var h=window.location.hash.replace('#','');
        if(h)showSection(h);
    }
    
    function loadMerchant(){
        var stored=localStorage.getItem('amadeo_merchant');
        if(stored){
            merchant=JSON.parse(stored);
            displayMerchant();
            loadData();
        }else{
            window.location.href='/merchant-login';
        }
    }
    
    function displayMerchant(){
        document.getElementById('merchantName').textContent=merchant.BusinessName||'My Store';
        document.getElementById('merchantId').textContent=merchant.MerchantId||'';
        
        // Settings form
        document.getElementById('setBizName').value=merchant.BusinessName||'';
        document.getElementById('setOwner').value=merchant.OwnerName||'';
        document.getElementById('setPhone').value=merchant.Phone||'';
        document.getElementById('setEmail').value=merchant.Email||'';
        document.getElementById('setBrgy').value=merchant.Barangay||'';
        document.getElementById('setCategory').value=merchant.Category||'';
        document.getElementById('setDesc').value=merchant.Description||'';
    }
    
    function loadData(){
        Promise.all([loadOrders(),loadProducts()]).then(function(){
            updateDashboard();
        });
    }
    
    function loadOrders(){
        return fetch(API+'?action=getOrders&merchantId='+merchant.MerchantId)
            .then(function(res){return res.json();})
            .then(function(data){
                if(data.success)orders=data.data||[];
                renderOrders();
                renderRecentOrders();
            })
            .catch(function(e){console.error(e);});
    }
    
    function loadProducts(){
        return fetch(API+'?action=getProducts&merchantId='+merchant.MerchantId)
            .then(function(res){return res.json();})
            .then(function(data){
                if(data.success)products=data.data||[];
                renderProducts();
            })
            .catch(function(e){console.error(e);});
    }
    
    function updateDashboard(){
        var today=new Date().toDateString();
        var todayOrders=orders.filter(function(o){
            return new Date(o.CreatedAt).toDateString()===today;
        });
        var todayRev=todayOrders.reduce(function(s,o){
            return s+(parseFloat(o.Total)||0);
        },0);
        var pending=orders.filter(function(o){
            return (o.Status||'').toLowerCase()==='pending';
        }).length;
        
        document.getElementById('todayRevenue').textContent='‚Ç±'+todayRev.toLocaleString();
        document.getElementById('totalOrders').textContent=orders.length;
        document.getElementById('pendingOrders').textContent=pending;
        document.getElementById('totalProducts').textContent=products.length;
        document.getElementById('ordersBadge').textContent=pending;
        document.getElementById('notifBadge').textContent=pending;
        
        // Products stats
        var active=products.filter(function(p){return p.Status!=='Inactive';}).length;
        var low=products.filter(function(p){return (p.StockLevel||0)<=5&&(p.StockLevel||0)>0;}).length;
        document.getElementById('prodActive').textContent=active;
        document.getElementById('prodLow').textContent=low;
        
        // Earnings
        var delivered=orders.filter(function(o){return (o.Status||'').toLowerCase()==='delivered';});
        var total=delivered.reduce(function(s,o){return s+(parseFloat(o.Total)||0);},0);
        var fees=delivered.reduce(function(s,o){return s+(parseFloat(o.PlatformFee)||0);},0);
        document.getElementById('totalEarnings').textContent='‚Ç±'+(total-fees).toLocaleString();
        document.getElementById('monthEarnings').textContent='‚Ç±'+(total-fees).toLocaleString();
        document.getElementById('totalFees').textContent='‚Ç±'+fees.toLocaleString();
    }
    
    function renderRecentOrders(){
        var recent=orders.slice(0,5);
        var tbody=document.getElementById('recentOrders');
        
        if(!recent.length){
            tbody.innerHTML='<tr><td colspan="6" style="text-align:center;padding:30px;color:var(--g5)">No orders yet</td></tr>';
            return;
        }
        
        var html='';
        for(var i=0;i<recent.length;i++){
            var o=recent[i];
            var items=parseItems(o.Items);
            var status=(o.Status||'pending').toLowerCase();
            html+='<tr>';
            html+='<td><strong>'+(o.OrderId||'-')+'</strong></td>';
            html+='<td>'+(o.CustomerName||'-')+'</td>';
            html+='<td>'+items.length+' item'+(items.length!==1?'s':'')+'</td>';
            html+='<td><strong>‚Ç±'+Number(o.Total||0).toLocaleString()+'</strong></td>';
            html+='<td><span class="status status-'+status+'">'+fmtStatus(status)+'</span></td>';
            html+='<td><button class="btn btn-sm btn-outline" onclick="viewOrder(\''+o.OrderId+'\')">View</button></td>';
            html+='</tr>';
        }
        tbody.innerHTML=html;
    }
    
    function renderOrders(){
        var list=orders;
        if(currentOrderFilter!=='all'){
            list=orders.filter(function(o){
                return (o.Status||'').toLowerCase()===currentOrderFilter;
            });
        }
        
        var tbody=document.getElementById('ordersTable');
        if(!list.length){
            tbody.innerHTML='<tr><td colspan="8" style="text-align:center;padding:40px;color:var(--g5)">No orders found</td></tr>';
            return;
        }
        
        var html='';
        for(var i=0;i<list.length;i++){
            var o=list[i];
            var items=parseItems(o.Items);
            var status=(o.Status||'pending').toLowerCase();
            var date=o.CreatedAt?new Date(o.CreatedAt).toLocaleDateString('en-PH',{month:'short',day:'numeric',hour:'2-digit',minute:'2-digit'}):'-';
            
            html+='<tr>';
            html+='<td><strong>'+(o.OrderId||'-')+'</strong></td>';
            html+='<td>'+date+'</td>';
            html+='<td>'+(o.CustomerName||'-')+'<br><small style="color:var(--g5)">'+(o.CustomerPhone||'')+'</small></td>';
            html+='<td>'+items.length+' item'+(items.length!==1?'s':'')+'</td>';
            html+='<td><strong>‚Ç±'+Number(o.Total||0).toLocaleString()+'</strong></td>';
            html+='<td>'+fmtPay(o.PaymentMethod)+'</td>';
            html+='<td><span class="status status-'+status+'">'+fmtStatus(status)+'</span></td>';
            html+='<td><div class="btn-group">';
            html+='<button class="btn btn-sm btn-outline" onclick="viewOrder(\''+o.OrderId+'\')">View</button>';
            if(status==='pending'){
                html+='<button class="btn btn-sm btn-success" onclick="quickConfirm(\''+o.OrderId+'\')">‚úì</button>';
            }
            html+='</div></td>';
            html+='</tr>';
        }
        tbody.innerHTML=html;
    }
    
    function renderProducts(){
        var grid=document.getElementById('productsGrid');
        if(!products.length){
            grid.innerHTML='<div class="empty"><div class="icon">üì¶</div><h3>No Products Yet</h3><p>Add products to start selling</p><button class="btn btn-primary" onclick="openProductModal()">Add Product</button></div>';
            return;
        }
        
        var html='';
        for(var i=0;i<products.length;i++){
            var p=products[i];
            html+='<div class="item-card">';
            html+='<div class="item-img">';
            if(p.Image){
                html+='<img src="'+p.Image+'" onerror="this.parentElement.innerHTML=\'üì¶\'">';
            }else{
                html+='üì¶';
            }
            html+='</div>';
            html+='<div class="item-body">';
            html+='<div class="item-name">'+(p.Name||'Product')+'</div>';
            html+='<div class="item-meta">'+(p.Category||'-')+' ‚Ä¢ Stock: '+(p.StockLevel||0)+'</div>';
            html+='<div class="item-price">‚Ç±'+Number(p.Price||0).toLocaleString()+'</div>';
            html+='<div class="item-actions">';
            html+='<button class="btn btn-sm btn-outline" onclick="editProduct(\''+p.ProductId+'\')">Edit</button>';
            html+='<button class="btn btn-sm btn-danger" onclick="deleteProduct(\''+p.ProductId+'\')">Delete</button>';
            html+='</div></div></div>';
        }
        grid.innerHTML=html;
    }
    
    function parseItems(items){
        if(!items)return[];
        if(Array.isArray(items))return items;
        try{return JSON.parse(items);}catch(e){return[];}
    }
    
    function fmtStatus(s){
        var m={
            pending:'Pending',
            confirmed:'Confirmed',
            preparing:'Preparing',
            out_for_delivery:'On the Way',
            delivered:'Delivered',
            cancelled:'Cancelled'
        };
        return m[s]||s;
    }
    
    function fmtPay(m){
        var p={cod:'COD',gcash:'GCash',paymaya:'PayMaya',bank:'Bank'};
        return p[(m||'').toLowerCase()]||m||'-';
    }
    
    function filterOrders(f){
        currentOrderFilter=f;
        var btns=document.querySelectorAll('#orders .tab-btn');
        for(var i=0;i<btns.length;i++){
            var isActive=(f==='all'&&btns[i].textContent.toLowerCase().indexOf('all')>=0)||
                         btns[i].textContent.toLowerCase().indexOf(f)>=0;
            btns[i].classList.toggle('active',isActive);
        }
        renderOrders();
    }
    
    function searchOrders(q){
        q=q.toLowerCase();
        var rows=document.querySelectorAll('#ordersTable tr');
        for(var i=0;i<rows.length;i++){
            rows[i].style.display=rows[i].textContent.toLowerCase().indexOf(q)>=0?'':'none';
        }
    }
    
    function viewOrder(orderId){
        selectedOrder=null;
        for(var i=0;i<orders.length;i++){
            if(orders[i].OrderId===orderId){
                selectedOrder=orders[i];
                break;
            }
        }
        if(!selectedOrder)return;
        
        var items=parseItems(selectedOrder.Items);
        var status=(selectedOrder.Status||'pending').toLowerCase();
        
        var itemsHtml='';
        for(var j=0;j<items.length;j++){
            var it=items[j];
            itemsHtml+='<tr><td>'+(it.productName||it.name||'-')+'</td><td>'+(it.quantity||1)+'</td><td>‚Ç±'+Number(it.price||0).toLocaleString()+'</td></tr>';
        }
        
        var html='<div style="margin-bottom:20px">';
        html+='<h3 style="color:var(--p);margin-bottom:5px">'+selectedOrder.OrderId+'</h3>';
        html+='<span class="status status-'+status+'">'+fmtStatus(status)+'</span>';
        html+='</div>';
        html+='<div style="display:grid;grid-template-columns:1fr 1fr;gap:15px;margin-bottom:20px">';
        html+='<div><strong>Customer</strong><br>'+(selectedOrder.CustomerName||'-')+'</div>';
        html+='<div><strong>Phone</strong><br>'+(selectedOrder.CustomerPhone||'-')+'</div>';
        html+='<div><strong>Address</strong><br>'+(selectedOrder.Barangay||'')+', '+(selectedOrder.DeliveryAddress||'-')+'</div>';
        html+='<div><strong>Payment</strong><br>'+fmtPay(selectedOrder.PaymentMethod)+'</div>';
        html+='</div>';
        html+='<div style="margin-bottom:20px"><strong>Items</strong>';
        html+='<table style="margin-top:10px"><thead><tr><th>Item</th><th>Qty</th><th>Price</th></tr></thead>';
        html+='<tbody>'+itemsHtml+'</tbody></table></div>';
        html+='<div style="display:flex;justify-content:space-between;font-size:18px;font-weight:700;color:var(--p)">';
        html+='<span>Total</span><span>‚Ç±'+Number(selectedOrder.Total||0).toLocaleString()+'</span></div>';
        if(selectedOrder.Notes){
            html+='<div style="margin-top:15px;padding:12px;background:var(--g1);border-radius:8px"><strong>Notes:</strong> '+selectedOrder.Notes+'</div>';
        }
        html+='<div style="margin-top:20px">';
        html+='<label style="display:block;margin-bottom:8px;font-weight:600">Update Status</label>';
        html+='<select id="newStatus" style="width:100%;padding:10px;border:1px solid var(--g2);border-radius:8px">';
        html+='<option value="pending"'+(status==='pending'?' selected':'')+'>Pending</option>';
        html+='<option value="confirmed"'+(status==='confirmed'?' selected':'')+'>Confirmed</option>';
        html+='<option value="preparing"'+(status==='preparing'?' selected':'')+'>Preparing</option>';
        html+='<option value="out_for_delivery"'+(status==='out_for_delivery'?' selected':'')+'>Out for Delivery</option>';
        html+='<option value="delivered"'+(status==='delivered'?' selected':'')+'>Delivered</option>';
        html+='<option value="cancelled"'+(status==='cancelled'?' selected':'')+'>Cancelled</option>';
        html+='</select></div>';
        
        document.getElementById('orderModalBody').innerHTML=html;
        document.getElementById('confirmOrderBtn').textContent=status==='pending'?'‚úì Confirm Order':'Update Status';
        openModal('orderModal');
    }
    
    function updateOrderStatus(newStatus){
        if(!selectedOrder)return;
        var statusEl=document.getElementById('newStatus');
        newStatus=newStatus||( statusEl?statusEl.value:'confirmed');
        
        fetch(API,{
            method:'POST',
            mode:'cors',
            headers:{'Content-Type':'text/plain;charset=utf-8'},
            body:JSON.stringify({
                action:'updateOrderStatus',
                orderId:selectedOrder.OrderId,
                status:newStatus
            })
        })
        .then(function(res){return res.json();})
        .then(function(data){
            if(data.success){
                toast('Order updated!');
                closeModal('orderModal');
                loadOrders().then(updateDashboard);
            }else{
                throw new Error(data.error);
            }
        })
        .catch(function(e){alert('Error: '+e.message);});
    }
    
    function quickConfirm(orderId){
        for(var i=0;i<orders.length;i++){
            if(orders[i].OrderId===orderId){
                selectedOrder=orders[i];
                break;
            }
        }
        if(confirm('Confirm order '+orderId+'?')){
            updateOrderStatus('confirmed');
        }
    }
    
    // PRODUCT FUNCTIONS
    function openProductModal(productId){
        document.getElementById('productForm').reset();
        document.getElementById('prodId').value='';
        document.getElementById('productModalTitle').textContent='Add Product';
        
        if(productId){
            for(var i=0;i<products.length;i++){
                var p=products[i];
                if(p.ProductId===productId){
                    document.getElementById('prodId').value=p.ProductId;
                    document.getElementById('prodName').value=p.Name||'';
                    document.getElementById('prodPrice').value=p.Price||'';
                    document.getElementById('prodStock').value=p.StockLevel||'';
                    document.getElementById('prodCategory').value=p.Category||'';
                    document.getElementById('prodDesc').value=p.Description||'';
                    document.getElementById('prodImage').value=p.Image||'';
                    document.getElementById('productModalTitle').textContent='Edit Product';
                    break;
                }
            }
        }
        openModal('productModal');
    }
    
    function editProduct(id){openProductModal(id);}
    
    function saveProduct(e){
        e.preventDefault();
        
        var data={
            action:document.getElementById('prodId').value?'updateProduct':'addProduct',
            productId:document.getElementById('prodId').value||undefined,
            merchantId:merchant.MerchantId,
            name:document.getElementById('prodName').value,
            price:parseFloat(document.getElementById('prodPrice').value),
            stockLevel:parseInt(document.getElementById('prodStock').value),
            category:document.getElementById('prodCategory').value,
            description:document.getElementById('prodDesc').value,
            image:document.getElementById('prodImage').value
        };
        
        fetch(API,{
            method:'POST',
            mode:'cors',
            headers:{'Content-Type':'text/plain;charset=utf-8'},
            body:JSON.stringify(data)
        })
        .then(function(res){return res.json();})
        .then(function(result){
            if(result.success){
                toast('Product saved!');
                closeModal('productModal');
                loadProducts().then(updateDashboard);
            }else{
                throw new Error(result.error||'Failed to save');
            }
        })
        .catch(function(e){alert('Error: '+e.message);});
    }
    
    function deleteProduct(id){
        if(!confirm('Delete this product?'))return;
        
        fetch(API,{
            method:'POST',
            mode:'cors',
            headers:{'Content-Type':'text/plain;charset=utf-8'},
            body:JSON.stringify({action:'deleteProduct',productId:id})
        })
        .then(function(res){return res.json();})
        .then(function(data){
            if(data.success){
                toast('Product deleted');
                loadProducts().then(updateDashboard);
            }else{
                throw new Error(data.error);
            }
        })
        .catch(function(e){alert('Error: '+e.message);});
    }
    
    // SERVICE FUNCTIONS
    function openServiceModal(){openModal('serviceModal');}
    
    function saveService(e){
        e.preventDefault();
        
        var data={
            action:'addService',
            merchantId:merchant.MerchantId,
            name:document.getElementById('svcName').value,
            price:parseFloat(document.getElementById('svcPrice').value),
            priceType:document.getElementById('svcPriceType').value,
            category:document.getElementById('svcCategory').value,
            duration:document.getElementById('svcDuration').value,
            serviceType:document.getElementById('svcType').value,
            description:document.getElementById('svcDesc').value
        };
        
        fetch(API,{
            method:'POST',
            mode:'cors',
            headers:{'Content-Type':'text/plain;charset=utf-8'},
            body:JSON.stringify(data)
        })
        .then(function(res){return res.json();})
        .then(function(result){
            if(result.success){
                toast('Service added!');
                closeModal('serviceModal');
                var priceLabel=data.priceType==='fixed'?'':'/ '+data.priceType.replace('per_','');
                document.getElementById('servicesGrid').innerHTML=
                    '<div class="item-card">'+
                    '<div class="item-img">üîß</div>'+
                    '<div class="item-body">'+
                    '<div class="item-name">'+data.name+'</div>'+
                    '<div class="item-meta">'+data.category+' ‚Ä¢ '+data.duration+'</div>'+
                    '<div class="item-price">‚Ç±'+data.price+' '+priceLabel+'</div>'+
                    '<div class="item-actions">'+
                    '<button class="btn btn-sm btn-outline">Edit</button>'+
                    '<button class="btn btn-sm btn-danger">Delete</button>'+
                    '</div></div></div>';
                document.getElementById('svcActive').textContent='1';
            }else{
                throw new Error(result.error);
            }
        })
        .catch(function(e){alert('Error: '+e.message);});
    }
    
    // PROPERTY FUNCTIONS
    function openPropertyModal(){openModal('propertyModal');}
    
    function saveProperty(e){
        e.preventDefault();
        
        var data={
            action:'addProperty',
            merchantId:merchant.MerchantId,
            name:document.getElementById('propName').value,
            type:document.getElementById('propType').value,
            location:document.getElementById('propLocation').value,
            weekdayRate:parseFloat(document.getElementById('propWeekday').value),
            weekendRate:parseFloat(document.getElementById('propWeekend').value),
            maxGuests:parseInt(document.getElementById('propGuests').value),
            bedrooms:parseInt(document.getElementById('propBeds').value)||0,
            bathrooms:parseInt(document.getElementById('propBaths').value)||0,
            cleaningFee:parseFloat(document.getElementById('propClean').value)||0,
            amenities:document.getElementById('propAmenities').value,
            description:document.getElementById('propDesc').value
        };
        
        fetch(API,{
            method:'POST',
            mode:'cors',
            headers:{'Content-Type':'text/plain;charset=utf-8'},
            body:JSON.stringify(data)
        })
        .then(function(res){return res.json();})
        .then(function(result){
            if(result.success){
                toast('Property added!');
                closeModal('propertyModal');
                var icons={'Private Pool':'üèä','Rest House':'üè°','Resort':'üè®','Farm Stay':'üåæ','Cabin':'üõñ','Venue':'üé™'};
                var icon=icons[data.type]||'üè†';
                document.getElementById('propertiesGrid').innerHTML=
                    '<div class="item-card">'+
                    '<div class="item-img">'+icon+'</div>'+
                    '<div class="item-body">'+
                    '<div class="item-name">'+data.name+'</div>'+
                    '<div class="item-meta">üìç '+data.location+' ‚Ä¢ üë• '+data.maxGuests+' guests</div>'+
                    '<div class="item-price">‚Ç±'+data.weekdayRate.toLocaleString()+' / night</div>'+
                    '<div class="item-actions">'+
                    '<button class="btn btn-sm btn-outline">Edit</button>'+
                    '<button class="btn btn-sm btn-danger">Delete</button>'+
                    '</div></div></div>';
                document.getElementById('propActive').textContent='1';
            }else{
                throw new Error(result.error);
            }
        })
        .catch(function(e){alert('Error: '+e.message);});
    }
    
    // SETTINGS
    function saveSettings(e){
        e.preventDefault();
        
        var updated={
            MerchantId:merchant.MerchantId,
            BusinessName:document.getElementById('setBizName').value,
            OwnerName:document.getElementById('setOwner').value,
            Phone:document.getElementById('setPhone').value,
            Email:document.getElementById('setEmail').value,
            Barangay:document.getElementById('setBrgy').value,
            Category:document.getElementById('setCategory').value,
            Description:document.getElementById('setDesc').value
        };
        
        fetch(API,{
            method:'POST',
            mode:'cors',
            headers:{'Content-Type':'text/plain;charset=utf-8'},
            body:JSON.stringify({action:'updateMerchant',merchantId:updated.MerchantId,data:updated})
        })
        .then(function(res){return res.json();})
        .then(function(data){
            if(data.success){
                for(var key in updated){merchant[key]=updated[key];}
                localStorage.setItem('amadeo_merchant',JSON.stringify(merchant));
                displayMerchant();
                toast('Settings saved!');
            }else{
                throw new Error(data.error);
            }
        })
        .catch(function(e){
            // Save locally anyway
            for(var key in updated){merchant[key]=updated[key];}
            localStorage.setItem('amadeo_merchant',JSON.stringify(merchant));
            displayMerchant();
            toast('Settings saved locally');
        });
    }
    
    function savePayoutSettings(){
        toast('Payout settings updated');
    }
    
    // UI FUNCTIONS
    function showSection(id){
        var sections=document.querySelectorAll('.section');
        for(var i=0;i<sections.length;i++){
            sections[i].classList.remove('active');
        }
        var navLinks=document.querySelectorAll('.nav a');
        for(var j=0;j<navLinks.length;j++){
            navLinks[j].classList.remove('active');
        }
        var targetSection=document.getElementById(id);
        if(targetSection)targetSection.classList.add('active');
        var targetNav=document.querySelector('.nav a[href="#'+id+'"]');
        if(targetNav)targetNav.classList.add('active');
        
        var titles={
            dashboard:'Dashboard',
            orders:'Orders',
            products:'Products',
            services:'Services',
            stays:'Properties',
            earnings:'Earnings',
            settings:'Settings'
        };
        document.getElementById('pageTitle').textContent=titles[id]||'Dashboard';
        window.location.hash=id;
        
        // Close sidebar on mobile
        document.getElementById('sidebar').classList.remove('open');
    }
    
    function toggleSidebar(){
        document.getElementById('sidebar').classList.toggle('open');
    }
    
    function openModal(id){
        document.getElementById(id).classList.add('open');
    }
    
    function closeModal(id){
        document.getElementById(id).classList.remove('open');
    }
    
    function logout(){
        if(confirm('Logout?')){
            localStorage.removeItem('amadeo_merchant');
            window.location.href='/';
        }
    }
    
    function toast(msg){
        var t=document.createElement('div');
        t.className='toast';
        t.textContent=msg;
        document.body.appendChild(t);
        setTimeout(function(){t.remove();},3000);
    }
    </script>
</body>
</html>
